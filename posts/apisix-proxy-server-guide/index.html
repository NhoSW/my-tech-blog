<!doctype html><html lang=en dir=ltr class=scroll-smooth data-default-appearance=dark data-auto-appearance=true><head><meta charset=utf-8><meta http-equiv=content-language content="en"><meta name=viewport content="width=device-width,initial-scale=1"><meta http-equiv=X-UA-Compatible content="ie=edge"><meta name=theme-color><title>Building a Proxy Server with Apache APISIX: De-identifying 1.3 Billion Daily Logs &#183; nanta - Data Engineering</title><meta name=title content="Building a Proxy Server with Apache APISIX: De-identifying 1.3 Billion Daily Logs &#183; nanta - Data Engineering"><meta name=description content="We needed to strip PII from app logs before sending them to an overseas tracking server. This post covers our journey from Fluent-bit to Kong to APISIX, custom Lua plugin development, 55K TPS load testing, and Kubernetes deployment."><meta name=keywords content="apisix,proxy,lua,kubernetes,privacy,kafka,"><link rel=canonical href=https://NhoSW.github.io/my-tech-blog/posts/apisix-proxy-server-guide/><meta name=author content="nanta"><link href=https://github.com/NhoSW rel=me><meta property="og:url" content="https://NhoSW.github.io/my-tech-blog/posts/apisix-proxy-server-guide/"><meta property="og:site_name" content="nanta - Data Engineering"><meta property="og:title" content="Building a Proxy Server with Apache APISIX: De-identifying 1.3 Billion Daily Logs"><meta property="og:description" content="We needed to strip PII from app logs before sending them to an overseas tracking server. This post covers our journey from Fluent-bit to Kong to APISIX, custom Lua plugin development, 55K TPS load testing, and Kubernetes deployment."><meta property="og:locale" content="en"><meta property="og:type" content="article"><meta property="article:section" content="posts"><meta property="article:published_time" content="2026-02-24T00:00:00+00:00"><meta property="article:modified_time" content="2026-02-24T00:00:00+00:00"><meta property="article:tag" content="Apisix"><meta property="article:tag" content="Proxy"><meta property="article:tag" content="Lua"><meta property="article:tag" content="Kubernetes"><meta property="article:tag" content="Privacy"><meta property="article:tag" content="Kafka"><meta name=twitter:card content="summary"><meta name=twitter:title content="Building a Proxy Server with Apache APISIX: De-identifying 1.3 Billion Daily Logs"><meta name=twitter:description content="We needed to strip PII from app logs before sending them to an overseas tracking server. This post covers our journey from Fluent-bit to Kong to APISIX, custom Lua plugin development, 55K TPS load testing, and Kubernetes deployment."><link type=text/css rel=stylesheet href=/my-tech-blog/css/main.bundle.min.c14e86e0d9a09802d254d2a15c05847ae65bfc2e98c2166fabc67369d2d7f2eae6c1da03bbba58cfd41a4af802147c75ce9fdc11dd724ac627ab2903942cbb79.css integrity="sha512-wU6G4NmgmALSVNKhXAWEeuZb/C6YwhZvq8ZzadLX8urmwdoDu7pYz9QaSvgCFHx1zp/cEd1ySsYnqykDlCy7eQ=="><script type=text/javascript src=/my-tech-blog/js/appearance.min.6f41174b3a05b680820fe08cadbfa5fb7a7ca347b76a0955cdc68b9d8aca1ce24f0547e138cea33bcc7904d551a90afcb1cc7f2d9fe8557075d501419046c08c.js integrity="sha512-b0EXSzoFtoCCD+CMrb+l+3p8o0e3aglVzcaLnYrKHOJPBUfhOM6jO8x5BNVRqQr8scx/LZ/oVXB11QFBkEbAjA=="></script><script src=/my-tech-blog/lib/zoom/zoom.min.umd.a527109b68c082a70f3697716dd72a9d5aa8b545cf800cecbbc7399f2ca6f6e0ce3e431f2062b48bbfa47c9ea42822714060bef309be073f49b9c0e30d318d7b.js integrity="sha512-pScQm2jAgqcPNpdxbdcqnVqotUXPgAzsu8c5nyym9uDOPkMfIGK0i7+kfJ6kKCJxQGC+8wm+Bz9JucDjDTGNew=="></script><script defer type=text/javascript id=script-bundle src=/my-tech-blog/js/main.bundle.min.bdda7dece6cbaf08deef7d254f7f842f3261c2524d247905127c9a20decc03f1011a2950048464c79272c1ce0705a49a41147f39f2b95163bb71d404b33263ef.js integrity="sha512-vdp97ObLrwje730lT3+ELzJhwlJNJHkFEnyaIN7MA/EBGilQBIRkx5Jywc4HBaSaQRR/OfK5UWO7cdQEszJj7w==" data-copy=Copy data-copied=Copied></script><link rel=apple-touch-icon sizes=180x180 href=/my-tech-blog/apple-touch-icon.png><link rel=icon type=image/png sizes=32x32 href=/my-tech-blog/favicon-32x32.png><link rel=icon type=image/png sizes=16x16 href=/my-tech-blog/favicon-16x16.png><link rel=manifest href=/my-tech-blog/site.webmanifest><script type=application/ld+json>[{"@context":"https://schema.org","@type":"Article","articleSection":"Posts","name":"Building a Proxy Server with Apache APISIX: De-identifying 1.3 Billion Daily Logs","headline":"Building a Proxy Server with Apache APISIX: De-identifying 1.3 Billion Daily Logs","inLanguage":"en","url":"https://NhoSW.github.io/my-tech-blog/posts/apisix-proxy-server-guide/","author":{"@type":"Person","name":"nanta"},"copyrightYear":"2026","dateCreated":"2026-02-24T00:00:00\u002b00:00","datePublished":"2026-02-24T00:00:00\u002b00:00","dateModified":"2026-02-24T00:00:00\u002b00:00","keywords":["apisix","proxy","lua","kubernetes","privacy","kafka"],"mainEntityOfPage":"true","wordCount":"1358"}]</script><link rel=preconnect href=https://cdn.jsdelivr.net crossorigin><link href=https://cdn.jsdelivr.net/npm/geist@1.3.1/dist/fonts/geist-sans/style.min.css rel=stylesheet><link href=https://cdn.jsdelivr.net/npm/geist@1.3.1/dist/fonts/geist-mono/style.min.css rel=stylesheet></head><body class="flex flex-col h-screen m-auto leading-7 max-w-7xl px-6 sm:px-14 md:px-24 lg:px-32 text-lg bg-neutral text-neutral-900 dark:bg-neutral-800 dark:text-neutral bf-scrollbar"><div id=the-top class="absolute flex self-center"><a class="px-3 py-1 text-sm -translate-y-8 rounded-b-lg bg-primary-200 focus:translate-y-0 dark:bg-neutral-600" href=#main-content><span class="font-bold text-primary-600 pe-2 dark:text-primary-400">&darr;</span>
Skip to main content</a></div><div class=min-h-[148px]></div><div class="fixed inset-x-0 z-100"><div id=menu-blur class="absolute opacity-0 inset-x-0 top-0 h-full single_hero_background nozoom backdrop-blur-2xl shadow-2xl bg-neutral/25 dark:bg-neutral-800/25"></div><div class="relative m-auto leading-7 max-w-7xl px-6 sm:px-14 md:px-24 lg:px-32"><div class="main-menu flex items-center w-full gap-2 p-1 pl-0"><a href=/my-tech-blog/ class="text-base font-medium truncate min-w-0 shrink">nanta - Data Engineering</a><div class="flex items-center ms-auto"><div class="hidden md:flex"><nav class="flex items-center gap-x-5 h-12"><a href=/my-tech-blog/posts/ class="flex items-center bf-icon-color-hover" aria-label=Posts title=Posts><span class="text-base font-medium break-normal">Posts
</span></a><a href=/my-tech-blog/categories/ class="flex items-center bf-icon-color-hover" aria-label=Categories title=Categories><span class="text-base font-medium break-normal">Categories
</span></a><a href=/my-tech-blog/tags/ class="flex items-center bf-icon-color-hover" aria-label=Tags title=Tags><span class="text-base font-medium break-normal">Tags
</span></a><a href=/my-tech-blog/about/ class="flex items-center bf-icon-color-hover" aria-label=About title=About><span class="text-base font-medium break-normal">About</span></a><div class="translation nested-menu"><button class="cursor-pointer flex items-center">
<span class=me-1><span class="relative block icon"><svg viewBox="0 0 640 512"><path fill="currentColor" d="M0 128C0 92.7 28.7 64 64 64H256h48 16H576c35.3.0 64 28.7 64 64V384c0 35.3-28.7 64-64 64H320 304 256 64c-35.3.0-64-28.7-64-64V128zm320 0V384H576V128H320zM178.3 175.9c-3.2-7.2-10.4-11.9-18.3-11.9s-15.1 4.7-18.3 11.9l-64 144c-4.5 10.1.1 21.9 10.2 26.4s21.9-.1 26.4-10.2l8.9-20.1h73.6l8.9 20.1c4.5 10.1 16.3 14.6 26.4 10.2s14.6-16.3 10.2-26.4l-64-144zM160 233.2 179 276H141l19-42.8zM448 164c11 0 20 9 20 20v4h44 16c11 0 20 9 20 20s-9 20-20 20h-2l-1.6 4.5c-8.9 24.4-22.4 46.6-39.6 65.4.9.6 1.8 1.1 2.7 1.6l18.9 11.3c9.5 5.7 12.5 18 6.9 27.4s-18 12.5-27.4 6.9L467 333.8c-4.5-2.7-8.8-5.5-13.1-8.5-10.6 7.5-21.9 14-34 19.4l-3.6 1.6c-10.1 4.5-21.9-.1-26.4-10.2s.1-21.9 10.2-26.4l3.6-1.6c6.4-2.9 12.6-6.1 18.5-9.8L410 286.1c-7.8-7.8-7.8-20.5.0-28.3s20.5-7.8 28.3.0l14.6 14.6.5.5c12.4-13.1 22.5-28.3 29.8-45H448 376c-11 0-20-9-20-20s9-20 20-20h52v-4c0-11 9-20 20-20z"/></svg></span>
</span><span class="text-sm font-medium bf-icon-color-hover" title="Building a Proxy Server with Apache APISIX: De-identifying 1.3 Billion Daily Logs">EN</span></button><ul class=menuhide><li class="rounded-xl backdrop-blur shadow-2xl p-2 flex flex-col gap-1"><a href=/my-tech-blog/posts/apisix-proxy-server-guide/ class="flex items-center bf-icon-color-hover px-3 py-1"><span class="text-sm font-sm" title="Building a Proxy Server with Apache APISIX: De-identifying 1.3 Billion Daily Logs">English
</span></a><a href=/my-tech-blog/ko/posts/apisix-proxy-server-guide/ class="flex items-center bf-icon-color-hover px-3 py-1"><span class="text-sm font-sm" title="Apache APISIX로 프록시 서버 구축하기: 일 13억 건 로그의 비식별화 처리">한국어</span></a></li></ul></div><button id=search-button aria-label=Search class="text-base bf-icon-color-hover" title="Search (/)">
<span class="relative block icon"><svg aria-hidden="true" focusable="false" data-prefix="fas" data-icon="search" class="svg-inline--fa fa-search fa-w-16" role="img" viewBox="0 0 512 512"><path fill="currentColor" d="M505 442.7 405.3 343c-4.5-4.5-10.6-7-17-7H372c27.6-35.3 44-79.7 44-128C416 93.1 322.9.0 208 0S0 93.1.0 208s93.1 208 208 208c48.3.0 92.7-16.4 128-44v16.3c0 6.4 2.5 12.5 7 17l99.7 99.7c9.4 9.4 24.6 9.4 33.9.0l28.3-28.3c9.4-9.4 9.4-24.6.1-34zM208 336c-70.7.0-128-57.2-128-128 0-70.7 57.2-128 128-128 70.7.0 128 57.2 128 128 0 70.7-57.2 128-128 128z"/></svg></span></button><div class="flex items-center"><button id=appearance-switcher aria-label="Dark mode switcher" type=button class="text-base bf-icon-color-hover"><div class="flex items-center justify-center dark:hidden"><span class="relative block icon"><svg viewBox="0 0 512 512"><path fill="currentColor" d="M32 256C32 132.2 132.3 32 255.8 32c11.36.0 29.7 1.668 40.9 3.746 9.616 1.777 11.75 14.63 3.279 19.44C245 86.5 211.2 144.6 211.2 207.8c0 109.7 99.71 193 208.3 172.3 9.561-1.805 16.28 9.324 10.11 16.95C387.9 448.6 324.8 480 255.8 480 132.1 480 32 379.6 32 256z"/></svg></span></div><div class="items-center justify-center hidden dark:flex"><span class="relative block icon"><svg viewBox="0 0 512 512"><path fill="currentColor" d="M256 159.1c-53.02.0-95.1 42.98-95.1 95.1s41.2 96.9 95.1 96.9 95.1-42.98 95.1-95.1S309 159.1 256 159.1zM509.3 347l-63.2-91.9 63.15-91.01c6.332-9.125 1.104-21.74-9.826-23.72l-109-19.7-19.7-109c-1.975-10.93-14.59-16.16-23.72-9.824L256 65.89 164.1 2.736c-9.125-6.332-21.74-1.107-23.72 9.824L121.6 121.6 12.56 141.3C1.633 143.2-3.596 155.9 2.736 164.1L65.89 256 2.74 347.01c-6.332 9.125-1.105 21.74 9.824 23.72l109 19.7 19.7 109c1.975 10.93 14.59 16.16 23.72 9.824L256 446.1l91.01 63.15c9.127 6.334 21.75 1.107 23.72-9.822l19.7-109 109-19.7C510.4 368.8 515.6 356.1 509.3 347zM256 383.1c-70.69.0-127.1-57.31-127.1-127.1.0-70.69 57.31-127.1 127.1-127.1S383.1 186.2 383.1 256c0 70.7-56.4 127.1-127.1 127.1z"/></svg></span></div></button></div></nav></div><div class="flex md:hidden"><div class="flex items-center h-14 gap-4"><button id=search-button-mobile aria-label=Search class="flex items-center justify-center bf-icon-color-hover" title="Search (/)">
<span class="relative block icon"><svg aria-hidden="true" focusable="false" data-prefix="fas" data-icon="search" class="svg-inline--fa fa-search fa-w-16" role="img" viewBox="0 0 512 512"><path fill="currentColor" d="M505 442.7 405.3 343c-4.5-4.5-10.6-7-17-7H372c27.6-35.3 44-79.7 44-128C416 93.1 322.9.0 208 0S0 93.1.0 208s93.1 208 208 208c48.3.0 92.7-16.4 128-44v16.3c0 6.4 2.5 12.5 7 17l99.7 99.7c9.4 9.4 24.6 9.4 33.9.0l28.3-28.3c9.4-9.4 9.4-24.6.1-34zM208 336c-70.7.0-128-57.2-128-128 0-70.7 57.2-128 128-128 70.7.0 128 57.2 128 128 0 70.7-57.2 128-128 128z"/></svg>
</span></button>
<button id=appearance-switcher-mobile type=button aria-label="Dark mode switcher" class="flex items-center justify-center text-neutral-900 hover:text-primary-600 dark:text-neutral-200 dark:hover:text-primary-400"><div class=dark:hidden><span class="relative block icon"><svg viewBox="0 0 512 512"><path fill="currentColor" d="M32 256C32 132.2 132.3 32 255.8 32c11.36.0 29.7 1.668 40.9 3.746 9.616 1.777 11.75 14.63 3.279 19.44C245 86.5 211.2 144.6 211.2 207.8c0 109.7 99.71 193 208.3 172.3 9.561-1.805 16.28 9.324 10.11 16.95C387.9 448.6 324.8 480 255.8 480 132.1 480 32 379.6 32 256z"/></svg></span></div><div class="hidden dark:block"><span class="relative block icon"><svg viewBox="0 0 512 512"><path fill="currentColor" d="M256 159.1c-53.02.0-95.1 42.98-95.1 95.1s41.2 96.9 95.1 96.9 95.1-42.98 95.1-95.1S309 159.1 256 159.1zM509.3 347l-63.2-91.9 63.15-91.01c6.332-9.125 1.104-21.74-9.826-23.72l-109-19.7-19.7-109c-1.975-10.93-14.59-16.16-23.72-9.824L256 65.89 164.1 2.736c-9.125-6.332-21.74-1.107-23.72 9.824L121.6 121.6 12.56 141.3C1.633 143.2-3.596 155.9 2.736 164.1L65.89 256 2.74 347.01c-6.332 9.125-1.105 21.74 9.824 23.72l109 19.7 19.7 109c1.975 10.93 14.59 16.16 23.72 9.824L256 446.1l91.01 63.15c9.127 6.334 21.75 1.107 23.72-9.822l19.7-109 109-19.7C510.4 368.8 515.6 356.1 509.3 347zM256 383.1c-70.69.0-127.1-57.31-127.1-127.1.0-70.69 57.31-127.1 127.1-127.1S383.1 186.2 383.1 256c0 70.7-56.4 127.1-127.1 127.1z"/></svg></span></div></button>
<input type=checkbox id=mobile-menu-toggle autocomplete=off class="hidden peer">
<label for=mobile-menu-toggle class="flex items-center justify-center cursor-pointer bf-icon-color-hover"><span class="relative block icon"><svg viewBox="0 0 448 512"><path fill="currentColor" d="M0 96C0 78.33 14.33 64 32 64H416c17.7.0 32 14.33 32 32 0 17.7-14.3 32-32 32H32C14.33 128 0 113.7.0 96zM0 256c0-17.7 14.33-32 32-32H416c17.7.0 32 14.3 32 32s-14.3 32-32 32H32c-17.67.0-32-14.3-32-32zM416 448H32c-17.67.0-32-14.3-32-32s14.33-32 32-32H416c17.7.0 32 14.3 32 32s-14.3 32-32 32z"/></svg></span></label><div role=dialog aria-modal=true style=scrollbar-gutter:stable class="fixed inset-0 z-50 invisible overflow-y-auto px-6 py-20 opacity-0 transition-[opacity,visibility] duration-300 peer-checked:visible peer-checked:opacity-100 bg-neutral-50/97 dark:bg-neutral-900/99
bf-scrollbar"><label for=mobile-menu-toggle class="fixed end-8 top-5 flex items-center justify-center z-50 h-12 w-12 cursor-pointer select-none rounded-full bf-icon-color-hover border bf-border-color bf-border-color-hover bg-neutral-50 dark:bg-neutral-900"><span class="relative block icon"><svg viewBox="0 0 320 512"><path fill="currentColor" d="M310.6 361.4c12.5 12.5 12.5 32.75.0 45.25C304.4 412.9 296.2 416 288 416s-16.38-3.125-22.62-9.375L160 301.3 54.63 406.6C48.38 412.9 40.19 416 32 416S15.63 412.9 9.375 406.6c-12.5-12.5-12.5-32.75.0-45.25l105.4-105.4L9.375 150.6c-12.5-12.5-12.5-32.75.0-45.25s32.75-12.5 45.25.0L160 210.8l105.4-105.4c12.5-12.5 32.75-12.5 45.25.0s12.5 32.75.0 45.25l-105.4 105.4L310.6 361.4z"/></svg></span></label><nav class="mx-auto max-w-md space-y-6"><div class=px-2><a href=/my-tech-blog/posts/ aria-label=Posts class="flex items-center gap-4 group bf-icon-color-hover text-neutral-700 dark:text-neutral-200"><span title=Posts class="text-2xl font-bold tracking-tight">Posts</span></a></div><div class=px-2><a href=/my-tech-blog/categories/ aria-label=Categories class="flex items-center gap-4 group bf-icon-color-hover text-neutral-700 dark:text-neutral-200"><span title=Categories class="text-2xl font-bold tracking-tight">Categories</span></a></div><div class=px-2><a href=/my-tech-blog/tags/ aria-label=Tags class="flex items-center gap-4 group bf-icon-color-hover text-neutral-700 dark:text-neutral-200"><span title=Tags class="text-2xl font-bold tracking-tight">Tags</span></a></div><div class=px-2><a href=/my-tech-blog/about/ aria-label=About class="flex items-center gap-4 group bf-icon-color-hover text-neutral-700 dark:text-neutral-200"><span title=About class="text-2xl font-bold tracking-tight">About</span></a></div><div class="flex flex-wrap items-center [&_span]:text-2xl [&_.translation_button_.icon]:text-4xl! [&_.translation_button_span]:text-base! [&_.translation_.menuhide_span]:text-sm! gap-x-6 ps-2 mt-8 pt-8 border-t bf-border-color"><div class="translation nested-menu"><button class="cursor-pointer flex items-center">
<span class=me-1><span class="relative block icon"><svg viewBox="0 0 640 512"><path fill="currentColor" d="M0 128C0 92.7 28.7 64 64 64H256h48 16H576c35.3.0 64 28.7 64 64V384c0 35.3-28.7 64-64 64H320 304 256 64c-35.3.0-64-28.7-64-64V128zm320 0V384H576V128H320zM178.3 175.9c-3.2-7.2-10.4-11.9-18.3-11.9s-15.1 4.7-18.3 11.9l-64 144c-4.5 10.1.1 21.9 10.2 26.4s21.9-.1 26.4-10.2l8.9-20.1h73.6l8.9 20.1c4.5 10.1 16.3 14.6 26.4 10.2s14.6-16.3 10.2-26.4l-64-144zM160 233.2 179 276H141l19-42.8zM448 164c11 0 20 9 20 20v4h44 16c11 0 20 9 20 20s-9 20-20 20h-2l-1.6 4.5c-8.9 24.4-22.4 46.6-39.6 65.4.9.6 1.8 1.1 2.7 1.6l18.9 11.3c9.5 5.7 12.5 18 6.9 27.4s-18 12.5-27.4 6.9L467 333.8c-4.5-2.7-8.8-5.5-13.1-8.5-10.6 7.5-21.9 14-34 19.4l-3.6 1.6c-10.1 4.5-21.9-.1-26.4-10.2s.1-21.9 10.2-26.4l3.6-1.6c6.4-2.9 12.6-6.1 18.5-9.8L410 286.1c-7.8-7.8-7.8-20.5.0-28.3s20.5-7.8 28.3.0l14.6 14.6.5.5c12.4-13.1 22.5-28.3 29.8-45H448 376c-11 0-20-9-20-20s9-20 20-20h52v-4c0-11 9-20 20-20z"/></svg></span>
</span><span class="text-sm font-medium bf-icon-color-hover" title="Building a Proxy Server with Apache APISIX: De-identifying 1.3 Billion Daily Logs">EN</span></button><ul class=menuhide><li class="rounded-xl backdrop-blur shadow-2xl p-2 flex flex-col gap-1"><a href=/my-tech-blog/posts/apisix-proxy-server-guide/ class="flex items-center bf-icon-color-hover px-3 py-1"><span class="text-sm font-sm" title="Building a Proxy Server with Apache APISIX: De-identifying 1.3 Billion Daily Logs">English
</span></a><a href=/my-tech-blog/ko/posts/apisix-proxy-server-guide/ class="flex items-center bf-icon-color-hover px-3 py-1"><span class="text-sm font-sm" title="Apache APISIX로 프록시 서버 구축하기: 일 13억 건 로그의 비식별화 처리">한국어</span></a></li></ul></div></div></nav></div></div></div></div></div></div></div><script type=text/javascript src=/my-tech-blog/js/background-blur.min.605b3b942818f0ab5a717ae446135ec46b8ee5a2ad12ae56fb90dc2a76ce30c388f9fec8bcc18db15bd47e3fa8a09d779fa12aa9c184cf614a315bc72c6c163d.js integrity="sha512-YFs7lCgY8KtacXrkRhNexGuO5aKtEq5W+5DcKnbOMMOI+f7IvMGNsVvUfj+ooJ13n6EqqcGEz2FKMVvHLGwWPQ==" data-blur-id=menu-blur></script><div class="relative flex flex-col grow"><main id=main-content class=grow><article><header id=single_header class="mt-5 max-w-prose"><ol class="text-sm text-neutral-500 dark:text-neutral-400 print:hidden"><li class=hidden><a class="hover:underline decoration-neutral-300 dark:underline-neutral-600" href=/my-tech-blog/>nanta - Data Engineering</a><span class="px-1 text-primary-500">/</span></li><li class=inline><a class="hover:underline decoration-neutral-300 dark:underline-neutral-600" href=/my-tech-blog/posts/>Posts</a><span class="px-1 text-primary-500">/</span></li><li class=hidden><a class="hover:underline decoration-neutral-300 dark:underline-neutral-600" href=/my-tech-blog/posts/apisix-proxy-server-guide/>Building a Proxy Server with Apache APISIX: De-identifying 1.3 Billion Daily Logs</a><span class="px-1 text-primary-500">/</span></li></ol><h1 class="mt-0 text-4xl font-extrabold text-neutral-900 dark:text-neutral">Building a Proxy Server with Apache APISIX: De-identifying 1.3 Billion Daily Logs</h1><div class="mt-1 mb-6 text-base text-neutral-500 dark:text-neutral-400 print:hidden"><div class="flex flex-row flex-wrap items-center"><time datetime=2026-02-24T00:00:00+00:00>24 February 2026</time><span class="px-2 text-primary-500">&#183;</span><span title="Reading time">7 mins</span></div></div><div class="flex author"><div class=place-self-center><div class="text-[0.6rem] uppercase leading-3 text-neutral-500 dark:text-neutral-400">Author</div><div class="font-semibold leading-6 text-neutral-800 dark:text-neutral-300">nanta</div><div class="text-sm text-neutral-700 dark:text-neutral-400">Data Engineering blog covering Apache Kafka, Airflow, Trino, StarRocks, and modern data infrastructure. Sharing practical lessons from production.</div><div class="text-2xl sm:text-lg"><div class="flex flex-wrap text-neutral-400 dark:text-neutral-500"><a class="px-1 hover:text-primary-700 dark:hover:text-primary-400" href=https://github.com/NhoSW target=_blank aria-label=Github title=Github rel="me noopener noreferrer"><span class="inline-block align-text-bottom"><span class="relative block icon"><svg viewBox="0 0 496 512"><path fill="currentColor" d="M165.9 397.4c0 2-2.3 3.6-5.2 3.6-3.3.3-5.6-1.3-5.6-3.6.0-2 2.3-3.6 5.2-3.6 3-.3 5.6 1.3 5.6 3.6zm-31.1-4.5c-.7 2 1.3 4.3 4.3 4.9 2.6 1 5.6.0 6.2-2s-1.3-4.3-4.3-5.2c-2.6-.7-5.5.3-6.2 2.3zm44.2-1.7c-2.9.7-4.9 2.6-4.6 4.9.3 2 2.9 3.3 5.9 2.6 2.9-.7 4.9-2.6 4.6-4.6-.3-1.9-3-3.2-5.9-2.9zM244.8 8C106.1 8 0 113.3.0 252c0 110.9 69.8 205.8 169.5 239.2 12.8 2.3 17.3-5.6 17.3-12.1.0-6.2-.3-40.4-.3-61.4.0.0-70 15-84.7-29.8.0.0-11.4-29.1-27.8-36.6.0.0-22.9-15.7 1.6-15.4.0.0 24.9 2 38.6 25.8 21.9 38.6 58.6 27.5 72.9 20.9 2.3-16 8.8-27.1 16-33.7-55.9-6.2-112.3-14.3-112.3-110.5.0-27.5 7.6-41.3 23.6-58.9-2.6-6.5-11.1-33.3 2.6-67.9 20.9-6.5 69 27 69 27 20-5.6 41.5-8.5 62.8-8.5s42.8 2.9 62.8 8.5c0 0 48.1-33.6 69-27 13.7 34.7 5.2 61.4 2.6 67.9 16 17.7 25.8 31.5 25.8 58.9.0 96.5-58.9 104.2-114.8 110.5 9.2 7.9 17 22.9 17 46.4.0 33.7-.3 75.4-.3 83.6.0 6.5 4.6 14.4 17.3 12.1C428.2 457.8 496 362.9 496 252 496 113.3 383.5 8 244.8 8zM97.2 352.9c-1.3 1-1 3.3.7 5.2 1.6 1.6 3.9 2.3 5.2 1 1.3-1 1-3.3-.7-5.2-1.6-1.6-3.9-2.3-5.2-1zm-10.8-8.1c-.7 1.3.3 2.9 2.3 3.9 1.6 1 3.6.7 4.3-.7.7-1.3-.3-2.9-2.3-3.9-2-.6-3.6-.3-4.3.7zm32.4 35.6c-1.6 1.3-1 4.3 1.3 6.2 2.3 2.3 5.2 2.6 6.5 1 1.3-1.3.7-4.3-1.3-6.2-2.2-2.3-5.2-2.6-6.5-1zm-11.4-14.7c-1.6 1-1.6 3.6.0 5.9 1.6 2.3 4.3 3.3 5.6 2.3 1.6-1.3 1.6-3.9.0-6.2-1.4-2.3-4-3.3-5.6-2z"/></svg></span></span></a></div></div></div></div><div class=mb-5></div></header><section class="flex flex-col max-w-full mt-0 prose dark:prose-invert lg:flex-row"><div class="order-first lg:ms-auto px-0 lg:order-last lg:ps-8 lg:max-w-2xs"><div class="toc ps-5 print:hidden lg:sticky lg:top-[140px]"><details open id=TOCView class="toc-right mt-0 overflow-y-auto overscroll-contain bf-scrollbar rounded-lg -ms-5 ps-5 pe-2 hidden lg:block"><summary class="block py-1 text-lg font-semibold cursor-pointer bg-neutral-100 text-neutral-800 -ms-5 ps-5 dark:bg-neutral-700 dark:text-neutral-100 lg:hidden">Table of Contents</summary><div class="min-w-[220px] py-2 border-dotted border-s-1 -ms-5 ps-5 dark:border-neutral-600"><nav id=TableOfContents><ul><li><a href=#why-apisix>Why APISIX</a><ul><li><a href=#we-started-with-fluent-bit>We Started with Fluent-bit</a></li><li><a href=#kong-vs-apisix>Kong vs APISIX</a></li></ul></li><li><a href=#custom-plugin-development>Custom Plugin Development</a><ul><li><a href=#why-built-in-plugins-werent-enough>Why Built-in Plugins Weren&rsquo;t Enough</a></li><li><a href=#pii-hashing-in-lua>PII Hashing in Lua</a></li><li><a href=#kafka-publishing>Kafka Publishing</a></li></ul></li><li><a href=#architecture-evolution>Architecture Evolution</a><ul><li><a href=#initial-design-proxy--kafka--flink--overseas>Initial Design: Proxy → Kafka → Flink → Overseas</a></li><li><a href=#final-design-proxy-does-everything>Final Design: Proxy Does Everything</a></li></ul></li><li><a href=#load-testing>Load Testing</a><ul><li><a href=#setup>Setup</a></li><li><a href=#throughput-per-core>Throughput Per Core</a></li><li><a href=#tuning-that-mattered>Tuning That Mattered</a></li><li><a href=#502-errors>502 Errors</a></li></ul></li><li><a href=#kubernetes-deployment>Kubernetes Deployment</a><ul><li><a href=#helm-chart>Helm Chart</a></li><li><a href=#autoscaling-keda>Autoscaling (KEDA)</a></li><li><a href=#security>Security</a></li></ul></li><li><a href=#monitoring>Monitoring</a></li><li><a href=#production-results>Production Results</a></li><li><a href=#takeaways>Takeaways</a></li></ul></nav></div></details><details class="toc-inside mt-0 overflow-hidden rounded-lg -ms-5 ps-5 lg:hidden"><summary class="py-1 text-lg font-semibold cursor-pointer bg-neutral-100 text-neutral-800 -ms-5 ps-5 dark:bg-neutral-700 dark:text-neutral-100 lg:hidden">Table of Contents</summary><div class="py-2 border-dotted border-neutral-300 border-s-1 -ms-5 ps-5 dark:border-neutral-600"><nav id=TableOfContents><ul><li><a href=#why-apisix>Why APISIX</a><ul><li><a href=#we-started-with-fluent-bit>We Started with Fluent-bit</a></li><li><a href=#kong-vs-apisix>Kong vs APISIX</a></li></ul></li><li><a href=#custom-plugin-development>Custom Plugin Development</a><ul><li><a href=#why-built-in-plugins-werent-enough>Why Built-in Plugins Weren&rsquo;t Enough</a></li><li><a href=#pii-hashing-in-lua>PII Hashing in Lua</a></li><li><a href=#kafka-publishing>Kafka Publishing</a></li></ul></li><li><a href=#architecture-evolution>Architecture Evolution</a><ul><li><a href=#initial-design-proxy--kafka--flink--overseas>Initial Design: Proxy → Kafka → Flink → Overseas</a></li><li><a href=#final-design-proxy-does-everything>Final Design: Proxy Does Everything</a></li></ul></li><li><a href=#load-testing>Load Testing</a><ul><li><a href=#setup>Setup</a></li><li><a href=#throughput-per-core>Throughput Per Core</a></li><li><a href=#tuning-that-mattered>Tuning That Mattered</a></li><li><a href=#502-errors>502 Errors</a></li></ul></li><li><a href=#kubernetes-deployment>Kubernetes Deployment</a><ul><li><a href=#helm-chart>Helm Chart</a></li><li><a href=#autoscaling-keda>Autoscaling (KEDA)</a></li><li><a href=#security>Security</a></li></ul></li><li><a href=#monitoring>Monitoring</a></li><li><a href=#production-results>Production Results</a></li><li><a href=#takeaways>Takeaways</a></li></ul></nav></div></details></div></div><div class="min-w-0 min-h-0 max-w-fit"><div class="article-content max-w-prose mb-20"><p>We had to send app logs to an overseas tracking server. Problem: the logs contained personally identifiable information — user IDs, device IDs, order numbers. Privacy law says you can&rsquo;t send that abroad in plaintext.</p><p>The fix: put a proxy in the middle. It receives logs from the app, hashes PII fields, forwards the sanitized data overseas. At the same time it publishes the original data to an internal Kafka cluster so teams like ads and recommendations can still use it.</p><p>This post documents how we built that proxy with Apache APISIX, handling 1.3 billion logs per day.</p><hr><h2 class="relative group">Why APISIX<div id=why-apisix class=anchor></div><span class="absolute top-0 w-6 transition-opacity opacity-0 -start-6 not-prose group-hover:opacity-100 select-none"><a class="text-primary-300 dark:text-neutral-700 !no-underline" href=#why-apisix aria-label=Anchor>#</a></span></h2><h3 class="relative group">We Started with Fluent-bit<div id=we-started-with-fluent-bit class=anchor></div><span class="absolute top-0 w-6 transition-opacity opacity-0 -start-6 not-prose group-hover:opacity-100 select-none"><a class="text-primary-300 dark:text-neutral-700 !no-underline" href=#we-started-with-fluent-bit aria-label=Anchor>#</a></span></h3><p>Log collection, so Fluent-bit felt natural. But once we listed the actual requirements, it was clear we needed an <strong>API gateway</strong>, not a log forwarder.</p><ul><li>Parse and modify HTTP request bodies (hash PII fields)</li><li>Pass the upstream server&rsquo;s responses (including 400 errors) back to the client</li><li>Publish original data to Kafka at the same time</li></ul><p>Fluent-bit can&rsquo;t do any of that cleanly.</p><h3 class="relative group">Kong vs APISIX<div id=kong-vs-apisix class=anchor></div><span class="absolute top-0 w-6 transition-opacity opacity-0 -start-6 not-prose group-hover:opacity-100 select-none"><a class="text-primary-300 dark:text-neutral-700 !no-underline" href=#kong-vs-apisix aria-label=Anchor>#</a></span></h3><p>Both are nginx-based and support Lua scripting. We tried Kong first. It failed at the Helm chart deployment stage due to a <a href=https://github.com/Kong/charts/issues/1198 target=_blank rel=noreferrer>known issue</a>.</p><p>APISIX won for three reasons:</p><ul><li><strong>Lightweight</strong>: Lower memory footprint and higher throughput per core than Kong</li><li><strong>Declarative routing</strong>: Send config via Admin API, it gets stored in etcd permanently</li><li><strong>Clean plugin pipeline</strong>: Requests flow through rewrite → access → header_filter → body_filter → log stages. Easy to inject logic at exactly the right point</li></ul><hr><h2 class="relative group">Custom Plugin Development<div id=custom-plugin-development class=anchor></div><span class="absolute top-0 w-6 transition-opacity opacity-0 -start-6 not-prose group-hover:opacity-100 select-none"><a class="text-primary-300 dark:text-neutral-700 !no-underline" href=#custom-plugin-development aria-label=Anchor>#</a></span></h2><h3 class="relative group">Why Built-in Plugins Weren&rsquo;t Enough<div id=why-built-in-plugins-werent-enough class=anchor></div><span class="absolute top-0 w-6 transition-opacity opacity-0 -start-6 not-prose group-hover:opacity-100 select-none"><a class="text-primary-300 dark:text-neutral-700 !no-underline" href=#why-built-in-plugins-werent-enough aria-label=Anchor>#</a></span></h3><p>APISIX ships with a <code>kafka-logger</code> plugin that sends request data to Kafka. The catch: if we run our de-identification plugin (<code>encrypt-pii</code>) first, kafka-logger sees the <strong>hashed data, not the original</strong>.</p><p>What we actually needed:</p><div class=highlight-wrapper><div class=highlight><pre tabindex=0 class=chroma><code class=language-text data-lang=text><span class=line><span class=cl>App → APISIX → (1) Publish original to Kafka
</span></span><span class=line><span class=cl>              → (2) Hash PII fields
</span></span><span class=line><span class=cl>              → (3) Forward hashed data to overseas server
</span></span><span class=line><span class=cl>              → (4) Return server&#39;s response to app</span></span></code></pre></div></div><p>Order matters. Original goes to Kafka first, then we hash. No existing plugin combo guarantees that ordering, so we built a <strong>single custom plugin</strong> combining kafka-logger and de-identification.</p><h3 class="relative group">PII Hashing in Lua<div id=pii-hashing-in-lua class=anchor></div><span class="absolute top-0 w-6 transition-opacity opacity-0 -start-6 not-prose group-hover:opacity-100 select-none"><a class="text-primary-300 dark:text-neutral-700 !no-underline" href=#pii-hashing-in-lua aria-label=Anchor>#</a></span></h3><p>APISIX runs on LuaJIT. We used <code>lua-resty-string</code> for SHA-256:</p><div class=highlight-wrapper><div class=highlight><pre tabindex=0 class=chroma><code class=language-lua data-lang=lua><span class=line><span class=cl><span class=kd>local</span> <span class=n>resty_sha256</span> <span class=o>=</span> <span class=n>require</span> <span class=s2>&#34;resty.sha256&#34;</span>
</span></span><span class=line><span class=cl><span class=kd>local</span> <span class=n>str</span> <span class=o>=</span> <span class=n>require</span> <span class=s2>&#34;resty.string&#34;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kd>local</span> <span class=kr>function</span> <span class=nf>hash_value</span><span class=p>(</span><span class=n>value</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=kd>local</span> <span class=n>sha256</span> <span class=o>=</span> <span class=n>resty_sha256</span><span class=p>:</span><span class=n>new</span><span class=p>()</span>
</span></span><span class=line><span class=cl>    <span class=n>sha256</span><span class=p>:</span><span class=n>update</span><span class=p>(</span><span class=n>value</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=kd>local</span> <span class=n>digest</span> <span class=o>=</span> <span class=n>sha256</span><span class=p>:</span><span class=n>final</span><span class=p>()</span>
</span></span><span class=line><span class=cl>    <span class=kr>return</span> <span class=n>str.to_hex</span><span class=p>(</span><span class=n>digest</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=kr>end</span></span></span></code></pre></div></div><p>Three fields get hashed: user ID, device ID, and order number. The plugin parses the JSON body, finds target fields, hashes them, and re-serializes.</p><h3 class="relative group">Kafka Publishing<div id=kafka-publishing class=anchor></div><span class="absolute top-0 w-6 transition-opacity opacity-0 -start-6 not-prose group-hover:opacity-100 select-none"><a class="text-primary-300 dark:text-neutral-700 !no-underline" href=#kafka-publishing aria-label=Anchor>#</a></span></h3><p>Same plugin uses <code>lua-resty-kafka</code> to send the original body to Kafka:</p><div class=highlight-wrapper><div class=highlight><pre tabindex=0 class=chroma><code class=language-lua data-lang=lua><span class=line><span class=cl><span class=kd>local</span> <span class=n>producer</span> <span class=o>=</span> <span class=n>require</span> <span class=s2>&#34;resty.kafka.producer&#34;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kd>local</span> <span class=n>broker_list</span> <span class=o>=</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=p>{</span> <span class=n>host</span> <span class=o>=</span> <span class=s2>&#34;kafka-broker-01&#34;</span><span class=p>,</span> <span class=n>port</span> <span class=o>=</span> <span class=mi>9092</span> <span class=p>},</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kd>local</span> <span class=n>p</span> <span class=o>=</span> <span class=n>producer</span><span class=p>:</span><span class=n>new</span><span class=p>(</span><span class=n>broker_list</span><span class=p>,</span> <span class=p>{</span> <span class=n>producer_type</span> <span class=o>=</span> <span class=s2>&#34;async&#34;</span> <span class=p>})</span>
</span></span><span class=line><span class=cl><span class=kd>local</span> <span class=n>ok</span><span class=p>,</span> <span class=n>err</span> <span class=o>=</span> <span class=n>p</span><span class=p>:</span><span class=n>send</span><span class=p>(</span><span class=s2>&#34;app-log-topic&#34;</span><span class=p>,</span> <span class=kc>nil</span><span class=p>,</span> <span class=n>original_body</span><span class=p>)</span></span></span></code></pre></div></div><p>Dependencies needed:</p><div class=highlight-wrapper><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>luarocks install lua-cjson
</span></span><span class=line><span class=cl>luarocks install penlight</span></span></code></pre></div></div><p>We hit two issues during development:</p><ol><li><strong>No timestamp in Kafka messages</strong>: Fixed by bumping Kafka API version from 1 to 2</li><li><strong>Metadata fetch failures</strong>: Happened on API version 2, so we dropped back to 1</li></ol><p>Ended up using API version 2 for message publishing and version 1 for metadata queries.</p><hr><h2 class="relative group">Architecture Evolution<div id=architecture-evolution class=anchor></div><span class="absolute top-0 w-6 transition-opacity opacity-0 -start-6 not-prose group-hover:opacity-100 select-none"><a class="text-primary-300 dark:text-neutral-700 !no-underline" href=#architecture-evolution aria-label=Anchor>#</a></span></h2><p>The final design looked nothing like our first sketch.</p><h3 class="relative group">Initial Design: Proxy → Kafka → Flink → Overseas<div id=initial-design-proxy--kafka--flink--overseas class=anchor></div><span class="absolute top-0 w-6 transition-opacity opacity-0 -start-6 not-prose group-hover:opacity-100 select-none"><a class="text-primary-300 dark:text-neutral-700 !no-underline" href=#initial-design-proxy--kafka--flink--overseas aria-label=Anchor>#</a></span></h3><div class=highlight-wrapper><div class=highlight><pre tabindex=0 class=chroma><code class=language-text data-lang=text><span class=line><span class=cl>App → APISIX → Kafka → Flink (de-identification) → Tracking Server</span></span></code></pre></div></div><p>Proxy just forwards to Kafka. Flink handles PII hashing and sends data onward. Clean separation, but one fatal flaw: when the tracking server returns HTTP 400 for a bad request, there&rsquo;s no way to pass that back to the client. Once you hand off to Kafka, the response path is gone.</p><h3 class="relative group">Final Design: Proxy Does Everything<div id=final-design-proxy-does-everything class=anchor></div><span class="absolute top-0 w-6 transition-opacity opacity-0 -start-6 not-prose group-hover:opacity-100 select-none"><a class="text-primary-300 dark:text-neutral-700 !no-underline" href=#final-design-proxy-does-everything aria-label=Anchor>#</a></span></h3><div class=highlight-wrapper><div class=highlight><pre tabindex=0 class=chroma><code class=language-text data-lang=text><span class=line><span class=cl>App → APISIX → (original → Kafka)
</span></span><span class=line><span class=cl>             → (hashed → Tracking Server → response → App)</span></span></code></pre></div></div><p>The proxy handles de-identification directly and forwards to the overseas server.</p><p><strong>Upside:</strong></p><ul><li>Client gets the tracking server&rsquo;s actual response, 400s included</li><li>No Flink application needed</li><li>Real-time processing</li></ul><p><strong>Downside:</strong></p><ul><li>All load concentrates on the proxy</li><li>Body parsing + hashing + Kafka publish happens in a single request</li></ul><p>The load concern was real, but APISIX handled it. Numbers below.</p><hr><h2 class="relative group">Load Testing<div id=load-testing class=anchor></div><span class="absolute top-0 w-6 transition-opacity opacity-0 -start-6 not-prose group-hover:opacity-100 select-none"><a class="text-primary-300 dark:text-neutral-700 !no-underline" href=#load-testing aria-label=Anchor>#</a></span></h2><h3 class="relative group">Setup<div id=setup class=anchor></div><span class="absolute top-0 w-6 transition-opacity opacity-0 -start-6 not-prose group-hover:opacity-100 select-none"><a class="text-primary-300 dark:text-neutral-700 !no-underline" href=#setup aria-label=Anchor>#</a></span></h3><p>We used nGrinder. Proxy pods ran on 2 cores, 4GiB memory each.</p><h3 class="relative group">Throughput Per Core<div id=throughput-per-core class=anchor></div><span class="absolute top-0 w-6 transition-opacity opacity-0 -start-6 not-prose group-hover:opacity-100 select-none"><a class="text-primary-300 dark:text-neutral-700 !no-underline" href=#throughput-per-core aria-label=Anchor>#</a></span></h3><p>APISIX docs claim 10,000 QPS per core. With our Lua scripting overhead (body parsing, hashing, Kafka publish), real numbers are lower.</p><p>Measured results (2 cores per pod, 90-second runs):</p><table><thead><tr><th>Vusers</th><th>Peak TPS</th><th>CPU Usage</th><th>Errors</th></tr></thead><tbody><tr><td>990</td><td>2,381</td><td>32%</td><td>0</td></tr><tr><td>1,980</td><td>4,907</td><td>48%</td><td>1</td></tr><tr><td>3,960</td><td>7,000</td><td>99%</td><td>0</td></tr></tbody></table><p><strong>Safe operating point: ~5,000 TPS on 2 cores.</strong> Our peak traffic hits 55,000 TPS, so 12 pods cover it.</p><h3 class="relative group">Tuning That Mattered<div id=tuning-that-mattered class=anchor></div><span class="absolute top-0 w-6 transition-opacity opacity-0 -start-6 not-prose group-hover:opacity-100 select-none"><a class="text-primary-300 dark:text-neutral-700 !no-underline" href=#tuning-that-mattered aria-label=Anchor>#</a></span></h3><p><strong>Keepalive</strong>: Before enabling it, p95 latency jumped around on every request. After: <strong>p95 under 10ms</strong>, often under 1ms after warm-up.</p><p><strong>nginx worker_connections</strong>: APISIX defaults to <code>auto</code>, which counts <strong>node cores, not pod cores</strong>. In containers this creates way too many workers and causes CPU contention. Set it manually to match your pod&rsquo;s core count. Small gain, but measurable — CPU dropped while TPS went up.</p><p><strong>Scale-out strategy</strong>: When traffic spikes hit, reactive scaling is too slow. CPU pegs at 100% before new pods come up, and errors start flying. Unlike stream processing, there&rsquo;s no backpressure here. We used two approaches:</p><ol><li><strong>KEDA with CPU threshold at 50%</strong> — aggressive, on purpose</li><li><strong>Schedule-based scaling</strong> — pre-scale before known peak times (lunch, dinner)</li></ol><h3 class="relative group">502 Errors<div id=502-errors class=anchor></div><span class="absolute top-0 w-6 transition-opacity opacity-0 -start-6 not-prose group-hover:opacity-100 select-none"><a class="text-primary-300 dark:text-neutral-700 !no-underline" href=#502-errors aria-label=Anchor>#</a></span></h3><p>Intermittent 502s showed up during testing. Root causes:</p><ul><li>The overseas server&rsquo;s staging environment ran on spot instances — responses were flaky</li><li>CPU saturation before scale-out kicked in</li><li>nGrinder artifact: too many vusers per agent causes client-side network bottlenecks that make server latency look worse than it is</li></ul><p>In production with conservative min-pod counts and schedule-based scaling, 502s disappeared.</p><hr><h2 class="relative group">Kubernetes Deployment<div id=kubernetes-deployment class=anchor></div><span class="absolute top-0 w-6 transition-opacity opacity-0 -start-6 not-prose group-hover:opacity-100 select-none"><a class="text-primary-300 dark:text-neutral-700 !no-underline" href=#kubernetes-deployment aria-label=Anchor>#</a></span></h2><h3 class="relative group">Helm Chart<div id=helm-chart class=anchor></div><span class="absolute top-0 w-6 transition-opacity opacity-0 -start-6 not-prose group-hover:opacity-100 select-none"><a class="text-primary-300 dark:text-neutral-700 !no-underline" href=#helm-chart aria-label=Anchor>#</a></span></h3><p>We deployed APISIX in <strong>decoupled mode</strong> — separate control-plane and data-plane.</p><ul><li><strong>Control-plane</strong> (apisix-control): Deploys with etcd. Manages routing config</li><li><strong>Data-plane</strong> (apisix-data): Handles actual traffic. Connects to control-plane&rsquo;s etcd via <code>externalEtcd</code> config</li></ul><p>etcd uses a PVC (gp3) for persistent storage. Standard EKS defaults to gp3, so no extra config needed.</p><h3 class="relative group">Autoscaling (KEDA)<div id=autoscaling-keda class=anchor></div><span class="absolute top-0 w-6 transition-opacity opacity-0 -start-6 not-prose group-hover:opacity-100 select-none"><a class="text-primary-300 dark:text-neutral-700 !no-underline" href=#autoscaling-keda aria-label=Anchor>#</a></span></h3><div class=highlight-wrapper><div class=highlight><pre tabindex=0 class=chroma><code class=language-yaml data-lang=yaml><span class=line><span class=cl><span class=c># KEDA ScaledObject (simplified)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=nt>triggers</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span>- <span class=nt>type</span><span class=p>:</span><span class=w> </span><span class=l>prometheus</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>metadata</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>query</span><span class=p>:</span><span class=w> </span><span class=l>avg(rate(container_cpu_usage_seconds_total{...}[1m])) * 100</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>threshold</span><span class=p>:</span><span class=w> </span><span class=s2>&#34;50&#34;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span>- <span class=nt>type</span><span class=p>:</span><span class=w> </span><span class=l>memory</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>metadata</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>value</span><span class=p>:</span><span class=w> </span><span class=s2>&#34;80&#34;</span></span></span></code></pre></div></div><p>Scale out at 50% CPU or 80% memory. Combined with schedule-based scaling for peak hours.</p><h3 class="relative group">Security<div id=security class=anchor></div><span class="absolute top-0 w-6 transition-opacity opacity-0 -start-6 not-prose group-hover:opacity-100 select-none"><a class="text-primary-300 dark:text-neutral-700 !no-underline" href=#security aria-label=Anchor>#</a></span></h3><p>The public-facing reverse proxy ALB got <strong>AWS WAF</strong> attached. Our security team reviewed it and confirmed WAF alone was sufficient for client-facing protection.</p><hr><h2 class="relative group">Monitoring<div id=monitoring class=anchor></div><span class="absolute top-0 w-6 transition-opacity opacity-0 -start-6 not-prose group-hover:opacity-100 select-none"><a class="text-primary-300 dark:text-neutral-700 !no-underline" href=#monitoring aria-label=Anchor>#</a></span></h2><p>We built a Grafana dashboard tracking:</p><ul><li><strong>System</strong>: CPU and memory utilization per pod</li><li><strong>Nginx</strong>: Total requests, accepted/handled connections, connection state</li><li><strong>HTTP</strong>: RPS by status code, RPS per service/route</li><li><strong>Latency</strong>: APISIX latency, upstream latency, total request latency</li><li><strong>Bandwidth</strong>: Ingress/egress per service and route</li><li><strong>etcd</strong>: Modify indexes, reachability</li></ul><p>One gotcha: you need to add the <code>prometheus</code> plugin to your route config for per-request metrics. Without it you only get system-level metrics and all the HTTP dashboards stay empty.</p><p>Alerts flow through Grafana → OpsGenie → Slack.</p><hr><h2 class="relative group">Production Results<div id=production-results class=anchor></div><span class="absolute top-0 w-6 transition-opacity opacity-0 -start-6 not-prose group-hover:opacity-100 select-none"><a class="text-primary-300 dark:text-neutral-700 !no-underline" href=#production-results aria-label=Anchor>#</a></span></h2><p>After three months of operation:</p><table><thead><tr><th>Metric</th><th>Target</th><th>Actual</th></tr></thead><tbody><tr><td>Cost reduction</td><td>20% vs. previous</td><td><strong>29.8% reduction</strong></td></tr><tr><td>Latency (p95)</td><td>40ms</td><td><strong>25ms</strong></td></tr><tr><td>Availability</td><td>99.99%</td><td><strong>100%</strong></td></tr><tr><td>PII de-identification</td><td>100%</td><td><strong>100%</strong></td></tr></tbody></table><p>Cost beat the target because cutting Flink out of the pipeline eliminated stream processing costs entirely.</p><p>Early on we saw some 499 errors (client dropped connection) and 408 errors (server timeout). The SDK retries everything except 400s, so no data was lost.</p><hr><h2 class="relative group">Takeaways<div id=takeaways class=anchor></div><span class="absolute top-0 w-6 transition-opacity opacity-0 -start-6 not-prose group-hover:opacity-100 select-none"><a class="text-primary-300 dark:text-neutral-700 !no-underline" href=#takeaways aria-label=Anchor>#</a></span></h2><ol><li><strong>Sometimes an API gateway is the right proxy.</strong> If you need to modify request bodies and relay HTTP responses, a log forwarder won&rsquo;t cut it. Reach for an API gateway.</li><li><strong>Build the custom plugin early.</strong> Don&rsquo;t waste time trying to chain existing plugins into doing something they weren&rsquo;t designed for. APISIX&rsquo;s plugin structure makes custom development straightforward.</li><li><strong>Pre-scale beats reactive scaling.</strong> For bursty HTTP traffic with no backpressure, schedule-based scaling before peak hours is more reliable than waiting for KEDA to react.</li><li><strong>Check your nginx worker count.</strong> APISIX&rsquo;s <code>auto</code> setting looks at node cores, not pod cores. In containers, set it manually or you&rsquo;ll get CPU contention from too many workers.</li></ol><p><strong>References:</strong></p><ul><li><a href=https://apisix.apache.org/docs/ target=_blank rel=noreferrer>Apache APISIX Documentation</a></li><li><a href=https://github.com/doujiang24/lua-resty-kafka target=_blank rel=noreferrer>lua-resty-kafka (GitHub)</a></li><li><a href=https://apisix.apache.org/docs/apisix/plugin-develop/ target=_blank rel=noreferrer>APISIX Custom Plugin Development</a></li><li><a href=https://grafana.com/grafana/dashboards/11719-apache-apisix/ target=_blank rel=noreferrer>Apache APISIX Grafana Dashboard</a></li></ul></div><section class="flex flex-row flex-wrap justify-center pt-4 text-xl"><a target=_blank class="m-1 rounded bg-neutral-300 p-1.5 text-neutral-700 hover:bg-primary-500 hover:text-neutral dark:bg-neutral-700 dark:text-neutral-300 dark:hover:bg-primary-400 dark:hover:text-neutral-800" href="https://www.linkedin.com/shareArticle?mini=true&amp;url=https://NhoSW.github.io/my-tech-blog/posts/apisix-proxy-server-guide/&amp;title=Building%20a%20Proxy%20Server%20with%20Apache%20APISIX:%20De-identifying%201.3%20Billion%20Daily%20Logs" title="Share on LinkedIn" aria-label="Share on LinkedIn"><span class="relative block icon"><svg viewBox="0 0 448 512"><path fill="currentColor" d="M416 32H31.9C14.3 32 0 46.5.0 64.3v383.4C0 465.5 14.3 480 31.9 480H416c17.6.0 32-14.5 32-32.3V64.3c0-17.8-14.4-32.3-32-32.3zM135.4 416H69V202.2h66.5V416zm-33.2-243c-21.3.0-38.5-17.3-38.5-38.5S80.9 96 102.2 96c21.2.0 38.5 17.3 38.5 38.5.0 21.3-17.2 38.5-38.5 38.5zm282.1 243h-66.4V312c0-24.8-.5-56.7-34.5-56.7-34.6.0-39.9 27-39.9 54.9V416h-66.4V202.2h63.7v29.2h.9c8.9-16.8 30.6-34.5 62.9-34.5 67.2.0 79.7 44.3 79.7 101.9V416z"/></svg>
</span></a><a target=_blank class="m-1 rounded bg-neutral-300 p-1.5 text-neutral-700 hover:bg-primary-500 hover:text-neutral dark:bg-neutral-700 dark:text-neutral-300 dark:hover:bg-primary-400 dark:hover:text-neutral-800" href="https://reddit.com/submit/?url=https://NhoSW.github.io/my-tech-blog/posts/apisix-proxy-server-guide/&amp;resubmit=true&amp;title=Building%20a%20Proxy%20Server%20with%20Apache%20APISIX:%20De-identifying%201.3%20Billion%20Daily%20Logs" title="Submit to Reddit" aria-label="Submit to Reddit"><span class="relative block icon"><svg viewBox="0 0 512 512"><path fill="currentColor" d="M201.5 305.5c-13.8.0-24.9-11.1-24.9-24.6.0-13.8 11.1-24.9 24.9-24.9 13.6.0 24.6 11.1 24.6 24.9.0 13.6-11.1 24.6-24.6 24.6zM504 256c0 137-111 248-248 248S8 393 8 256 119 8 256 8s248 111 248 248zm-132.3-41.2c-9.4.0-17.7 3.9-23.8 10-22.4-15.5-52.6-25.5-86.1-26.6l17.4-78.3 55.4 12.5c0 13.6 11.1 24.6 24.6 24.6 13.8.0 24.9-11.3 24.9-24.9s-11.1-24.9-24.9-24.9c-9.7.0-18 5.8-22.1 13.8l-61.2-13.6c-3-.8-6.1 1.4-6.9 4.4l-19.1 86.4c-33.2 1.4-63.1 11.3-85.5 26.8-6.1-6.4-14.7-10.2-24.1-10.2-34.9.0-46.3 46.9-14.4 62.8-1.1 5-1.7 10.2-1.7 15.5.0 52.6 59.2 95.2 132 95.2 73.1.0 132.3-42.6 132.3-95.2.0-5.3-.6-10.8-1.9-15.8 31.3-16 19.8-62.5-14.9-62.5zM302.8 331c-18.2 18.2-76.1 17.9-93.6.0-2.2-2.2-6.1-2.2-8.3.0-2.5 2.5-2.5 6.4.0 8.6 22.8 22.8 87.3 22.8 110.2.0 2.5-2.2 2.5-6.1.0-8.6-2.2-2.2-6.1-2.2-8.3.0zm7.7-75c-13.6.0-24.6 11.1-24.6 24.9.0 13.6 11.1 24.6 24.6 24.6 13.8.0 24.9-11.1 24.9-24.6.0-13.8-11-24.9-24.9-24.9z"/></svg>
</span></a><a target=_blank class="m-1 rounded bg-neutral-300 p-1.5 text-neutral-700 hover:bg-primary-500 hover:text-neutral dark:bg-neutral-700 dark:text-neutral-300 dark:hover:bg-primary-400 dark:hover:text-neutral-800" href="mailto:?body=https://NhoSW.github.io/my-tech-blog/posts/apisix-proxy-server-guide/&amp;subject=Building%20a%20Proxy%20Server%20with%20Apache%20APISIX:%20De-identifying%201.3%20Billion%20Daily%20Logs" title="Send via email" aria-label="Send via email"><span class="relative block icon"><svg viewBox="0 0 512 512"><path fill="currentColor" d="M207.8 20.73c-93.45 18.32-168.7 93.66-187 187.1-27.64 140.9 68.65 266.2 199.1 285.1 19.01 2.888 36.17-12.26 36.17-31.49l1e-4-.6631c0-15.74-11.44-28.88-26.84-31.24-84.35-12.98-149.2-86.13-149.2-174.2.0-102.9 88.61-185.5 193.4-175.4 91.54 8.869 158.6 91.25 158.6 183.2v16.16c0 22.09-17.94 40.05-40 40.05s-40.01-17.96-40.01-40.05v-120.1c0-8.847-7.161-16.02-16.01-16.02l-31.98.0036c-7.299.0-13.2 4.992-15.12 11.68-24.85-12.15-54.24-16.38-86.06-5.106-38.75 13.73-68.12 48.91-73.72 89.64-9.483 69.01 43.81 128 110.9 128 26.44.0 50.43-9.544 69.59-24.88 24 31.3 65.23 48.69 109.4 37.49C465.2 369.3 496 324.1 495.1 277.2V256.3c0-149.2-133.9-265.632-287.3-235.57zM239.1 304.3c-26.47.0-48-21.56-48-48.05s21.53-48.05 48-48.05 48 21.56 48 48.05-20.6 48.05-48 48.05z"/></svg></span></a></section></div></section><footer class="pt-8 max-w-prose print:hidden"><div class=pt-8><hr class="border-dotted border-neutral-300 dark:border-neutral-600"><div class="flex justify-between pt-3"><span class="flex flex-col"><a class="flex text-neutral-700 hover:text-primary-600 dark:text-neutral dark:hover:text-primary-400" href=/my-tech-blog/posts/2026-data-engineering-trends/><span class=leading-6><span class="inline-block rtl:rotate-180">&larr;</span>&ensp;2026 Data Engineering Trends and Where Large-Scale Platforms Stand
</span></a><span class="ms-6 mt-1 text-xs text-neutral-500 dark:text-neutral-400"><time datetime=2026-02-23T00:00:00+00:00>23 February 2026</time>
</span></span><span class="flex flex-col items-end"></span></div></div></footer></article><div id=scroll-to-top class="fixed bottom-6 end-6 z-50 transform translate-y-4 opacity-0 duration-200"><a href=#the-top class="pointer-events-auto flex h-12 w-12 items-center justify-center rounded-full bg-neutral/50 text-xl text-neutral-700 hover:text-primary-600 dark:bg-neutral-800/50 dark:text-neutral dark:hover:text-primary-400" aria-label="Scroll to top" title="Scroll to top">&uarr;</a></div></main><footer id=site-footer class="py-10 print:hidden"><nav class="flex flex-row pb-4 text-base font-medium text-neutral-500 dark:text-neutral-400"><ul class="flex list-none flex-col sm:flex-row"><li class="flex mb-1 text-end sm:mb-0 sm:me-7 sm:last:me-0"><a class="decoration-primary-500 hover:underline hover:decoration-2 hover:underline-offset-2 flex items-center" href=/my-tech-blog/privacy-policy/ title="Privacy Policy">Privacy Policy</a></li></ul></nav><div class="flex items-center justify-between"><p class="text-sm text-neutral-500 dark:text-neutral-400">&copy;
2026
nanta</p></div><script>mediumZoom(document.querySelectorAll("img:not(.nozoom)"),{margin:24,background:"rgba(0,0,0,0.5)",scrollOffset:0})</script></footer><div id=search-wrapper class="invisible fixed inset-0 flex h-screen w-screen cursor-default flex-col bg-neutral-500/50 p-4 backdrop-blur-sm dark:bg-neutral-900/50 sm:p-6 md:p-[10vh] lg:p-[12vh] z-500" data-url=https://NhoSW.github.io/my-tech-blog/><div id=search-modal class="flex flex-col w-full max-w-3xl min-h-0 mx-auto border rounded-md shadow-lg top-20 border-neutral-200 bg-neutral dark:border-neutral-700 dark:bg-neutral-800"><header class="relative z-10 flex items-center justify-between flex-none px-2"><form class="flex items-center flex-auto min-w-0"><div class="flex items-center justify-center w-8 h-8 text-neutral-400"><span class="relative block icon"><svg aria-hidden="true" focusable="false" data-prefix="fas" data-icon="search" class="svg-inline--fa fa-search fa-w-16" role="img" viewBox="0 0 512 512"><path fill="currentColor" d="M505 442.7 405.3 343c-4.5-4.5-10.6-7-17-7H372c27.6-35.3 44-79.7 44-128C416 93.1 322.9.0 208 0S0 93.1.0 208s93.1 208 208 208c48.3.0 92.7-16.4 128-44v16.3c0 6.4 2.5 12.5 7 17l99.7 99.7c9.4 9.4 24.6 9.4 33.9.0l28.3-28.3c9.4-9.4 9.4-24.6.1-34zM208 336c-70.7.0-128-57.2-128-128 0-70.7 57.2-128 128-128 70.7.0 128 57.2 128 128 0 70.7-57.2 128-128 128z"/></svg></span></div><input type=search id=search-query class="flex flex-auto h-12 mx-1 bg-transparent appearance-none focus:outline-dotted focus:outline-2 focus:outline-transparent" placeholder=Search tabindex=0></form><button id=close-search-button class="flex items-center justify-center w-8 h-8 text-neutral-700 hover:text-primary-600 dark:text-neutral dark:hover:text-primary-400" title="Close (Esc)">
<span class="relative block icon"><svg viewBox="0 0 320 512"><path fill="currentColor" d="M310.6 361.4c12.5 12.5 12.5 32.75.0 45.25C304.4 412.9 296.2 416 288 416s-16.38-3.125-22.62-9.375L160 301.3 54.63 406.6C48.38 412.9 40.19 416 32 416S15.63 412.9 9.375 406.6c-12.5-12.5-12.5-32.75.0-45.25l105.4-105.4L9.375 150.6c-12.5-12.5-12.5-32.75.0-45.25s32.75-12.5 45.25.0L160 210.8l105.4-105.4c12.5-12.5 32.75-12.5 45.25.0s12.5 32.75.0 45.25l-105.4 105.4L310.6 361.4z"/></svg></span></button></header><section class="flex-auto px-2 overflow-auto"><ul id=search-results></ul></section></div></div></div></body></html>