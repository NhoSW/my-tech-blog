<!doctype html><html lang=en dir=auto data-theme=auto><head><meta charset=utf-8><meta http-equiv=X-UA-Compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no"><meta name=robots content="index, follow"><title>StarRocks Compression Guide: Optimizing Performance and Storage | OTL - Data Engineering</title><meta name=keywords content="starrocks,compression,optimization"><meta name=description content="A practical guide to optimizing compression settings in StarRocks. Covers algorithm comparison, per-workload recommendations, benchmark results, and operational tips from production experience."><meta name=author content="Seungwoo Noh"><link rel=canonical href=https://NhoSW.github.io/my-tech-blog/posts/starrocks-compression-guide/><link crossorigin=anonymous href=/my-tech-blog/assets/css/stylesheet.da3211e5ef867bf2b75fd5a6515cfed7195c011e8ab735694e203810a827097b.css integrity="sha256-2jIR5e+Ge/K3X9WmUVz+1xlcAR6KtzVpTiA4EKgnCXs=" rel="preload stylesheet" as=style><link rel=icon href=https://NhoSW.github.io/my-tech-blog/favicon.ico><link rel=icon type=image/png sizes=16x16 href=https://NhoSW.github.io/my-tech-blog/favicon-16x16.png><link rel=icon type=image/png sizes=32x32 href=https://NhoSW.github.io/my-tech-blog/favicon-32x32.png><link rel=apple-touch-icon href=https://NhoSW.github.io/my-tech-blog/apple-touch-icon.png><link rel=mask-icon href=https://NhoSW.github.io/my-tech-blog/safari-pinned-tab.svg><meta name=theme-color content="#2e2e33"><meta name=msapplication-TileColor content="#2e2e33"><link rel=alternate hreflang=en href=https://NhoSW.github.io/my-tech-blog/posts/starrocks-compression-guide/><link rel=alternate hreflang=ko href=https://NhoSW.github.io/my-tech-blog/ko/posts/starrocks-compression-guide/><noscript><style>#theme-toggle,.top-link{display:none}</style><style>@media(prefers-color-scheme:dark){:root{--theme:rgb(29, 30, 32);--entry:rgb(46, 46, 51);--primary:rgb(218, 218, 219);--secondary:rgb(155, 156, 157);--tertiary:rgb(65, 66, 68);--content:rgb(196, 196, 197);--code-block-bg:rgb(46, 46, 51);--code-bg:rgb(55, 56, 62);--border:rgb(51, 51, 51);color-scheme:dark}.list{background:var(--theme)}.toc{background:var(--entry)}}@media(prefers-color-scheme:light){.list::-webkit-scrollbar-thumb{border-color:var(--code-bg)}}</style></noscript><script>localStorage.getItem("pref-theme")==="dark"?document.querySelector("html").dataset.theme="dark":localStorage.getItem("pref-theme")==="light"?document.querySelector("html").dataset.theme="light":window.matchMedia("(prefers-color-scheme: dark)").matches?document.querySelector("html").dataset.theme="dark":document.querySelector("html").dataset.theme="light"</script><script async src="https://www.googletagmanager.com/gtag/js?id=G-XXXXXXXXXX"></script><script>var doNotTrack=!1,dnt=navigator.doNotTrack||window.doNotTrack||navigator.msDoNotTrack,doNotTrack=dnt=="1"||dnt=="yes";if(!doNotTrack){window.dataLayer=window.dataLayer||[];function gtag(){dataLayer.push(arguments)}gtag("js",new Date),gtag("config","G-XXXXXXXXXX")}</script><meta property="og:url" content="https://NhoSW.github.io/my-tech-blog/posts/starrocks-compression-guide/"><meta property="og:site_name" content="OTL - Data Engineering"><meta property="og:title" content="StarRocks Compression Guide: Optimizing Performance and Storage"><meta property="og:description" content="A practical guide to optimizing compression settings in StarRocks. Covers algorithm comparison, per-workload recommendations, benchmark results, and operational tips from production experience."><meta property="og:locale" content="en"><meta property="og:type" content="article"><meta property="article:section" content="posts"><meta property="article:published_time" content="2026-02-23T00:00:00+00:00"><meta property="article:modified_time" content="2026-02-23T00:00:00+00:00"><meta property="article:tag" content="Starrocks"><meta property="article:tag" content="Compression"><meta property="article:tag" content="Optimization"><meta name=twitter:card content="summary"><meta name=twitter:title content="StarRocks Compression Guide: Optimizing Performance and Storage"><meta name=twitter:description content="A practical guide to optimizing compression settings in StarRocks. Covers algorithm comparison, per-workload recommendations, benchmark results, and operational tips from production experience."><script type=application/ld+json>{"@context":"https://schema.org","@type":"BreadcrumbList","itemListElement":[{"@type":"ListItem","position":1,"name":"Posts","item":"https://NhoSW.github.io/my-tech-blog/posts/"},{"@type":"ListItem","position":2,"name":"StarRocks Compression Guide: Optimizing Performance and Storage","item":"https://NhoSW.github.io/my-tech-blog/posts/starrocks-compression-guide/"}]}</script><script type=application/ld+json>{"@context":"https://schema.org","@type":"BlogPosting","headline":"StarRocks Compression Guide: Optimizing Performance and Storage","name":"StarRocks Compression Guide: Optimizing Performance and Storage","description":"A practical guide to optimizing compression settings in StarRocks. Covers algorithm comparison, per-workload recommendations, benchmark results, and operational tips from production experience.","keywords":["starrocks","compression","optimization"],"articleBody":"Why Compression Settings Matter When you operate StarRocks long enough, there will inevitably come a point where your data grows to tens of terabytes. I have seen, time and again, cases where a single compression setting made a 30 to 50 percent difference in storage costs. But this is not just about disk space. Higher compression ratios reduce disk I/O and improve scan performance, while overly aggressive compression burns CPU and increases latency. Ultimately, choosing the right compression algorithm for your workload is one of the most important tuning decisions in StarRocks operations.\nComparing Supported Compression Algorithms StarRocks supports several compression algorithms. Here is a comparison of the three most commonly used in practice.\nAlgorithm Compression Ratio Compression Speed Decompression Speed Best-fit Workload LZ4 Moderate (2-3x) Very fast Very fast Real-time analytics, low-latency queries ZSTD High (4-6x) Moderate Fast Batch analytics, cold data Snappy Low (1.5-2x) Fast Fast General purpose, legacy compatibility ZLIB High (4-5x) Slow Moderate Archiving, infrequently accessed data Personally, the combination I use most often is LZ4 for hot data and ZSTD for cold data. I occasionally use Snappy when dealing with data migrated from the Hadoop ecosystem, but I do not recommend it for new tables.\nSetting Compression When Creating a Table You can specify the compression algorithm via the compression property in PROPERTIES when creating a table. If no value is set, StarRocks defaults to LZ4.\nReal-time Analytics Table (LZ4) CREATE TABLE analytics.realtime_events ( event_id BIGINT, user_id BIGINT, event_type VARCHAR(64), event_time DATETIME, properties JSON ) ENGINE = OLAP DUPLICATE KEY(event_id) DISTRIBUTED BY HASH(user_id) BUCKETS 32 PROPERTIES ( \"replication_num\" = \"3\", \"compression\" = \"LZ4\" ); LZ4 has overwhelmingly fast decompression speed, making it ideal for tables that need to serve dashboard queries with sub-second response times.\nBatch Analytics Table (ZSTD) CREATE TABLE warehouse.order_history ( order_id BIGINT, customer_id BIGINT, order_date DATE, total_amount DECIMAL(18, 2), status VARCHAR(32), items ARRAY\u003cSTRUCT\u003csku STRING, qty INT, price DECIMAL(10,2)\u003e\u003e ) ENGINE = OLAP DUPLICATE KEY(order_id) PARTITION BY RANGE(order_date) ( PARTITION p2025 VALUES LESS THAN ('2026-01-01'), PARTITION p2026 VALUES LESS THAN ('2027-01-01') ) DISTRIBUTED BY HASH(customer_id) BUCKETS 16 PROPERTIES ( \"replication_num\" = \"2\", \"compression\" = \"ZSTD\" ); ZSTD achieves 1.5 to 2 times higher compression ratios than LZ4, which translates into significant storage savings on history tables where hundreds of millions of rows accumulate per partition.\nChanging Compression on an Existing Table If you want to change the compression algorithm on a table that is already in production, you can use ALTER TABLE. Keep in mind, however, that the new setting only applies to data loaded after the change. Existing segments will not be recompressed until a compaction cycle runs against them.\nALTER TABLE warehouse.order_history SET (\"compression\" = \"ZSTD\"); Recommended Compression Settings by Workload The following recommendations are based on patterns I have validated repeatedly in production environments.\nReal-time dashboards / Ad-hoc queries: Use LZ4. Its CPU overhead is negligible, minimizing the impact on P99 latency. Nightly batch reports / ETL result tables: Use ZSTD. When query frequency is low and data volume is high, the storage savings translate directly into cost reductions. High-volume log ingestion: Use ZSTD, but lower zstd_compression_level to 3 or below. This strikes a good balance between compression speed and compression ratio. Benchmark Results: Compression Ratio vs. Performance Tradeoffs The following benchmark was run against an event log table containing approximately 5 billion rows (roughly 800 GB uncompressed).\nMetric LZ4 ZSTD (level 3) ZSTD (level 9) Compressed size 320 GB 195 GB 170 GB Compression ratio 2.5x 4.1x 4.7x Simple scan query (Avg) 1.2 s 1.5 s 1.8 s Aggregation query (Avg) 3.4 s 3.8 s 4.5 s Data ingestion throughput 120 MB/s 95 MB/s 60 MB/s Compared to LZ4, ZSTD level 3 reduced storage by approximately 39% while only increasing query latency by about 10 to 15 percent. ZSTD level 9, on the other hand, offered diminishing compression gains at the cost of a steep drop in ingestion throughput, making level 3 the optimal choice in most environments.\nOperational Tips and Monitoring Here are three tips from production experience:\nAlways monitor compaction. Keep an eye on the compaction_score metric. When compression settings change or data volumes spike, compaction can fall behind, leading to degraded query performance from an excessive number of small segments. Separate compression strategies at the table level. Do not apply a single compression algorithm across your entire cluster. Match the algorithm to each table’s access pattern – LZ4 for frequently queried tables, ZSTD for archival ones. Track disk usage trends over time. Use SHOW DATA to monitor how each table’s storage footprint evolves after compression changes. SHOW DATA FROM warehouse.order_history; Compression is not a set-it-and-forget-it decision. As data volumes grow and query patterns shift, it is worth revisiting your compression settings periodically. Even a small adjustment can yield meaningful improvements in both performance and infrastructure costs over time.\n","wordCount":"802","inLanguage":"en","datePublished":"2026-02-23T00:00:00Z","dateModified":"2026-02-23T00:00:00Z","author":{"@type":"Person","name":"Seungwoo Noh"},"mainEntityOfPage":{"@type":"WebPage","@id":"https://NhoSW.github.io/my-tech-blog/posts/starrocks-compression-guide/"},"publisher":{"@type":"Organization","name":"OTL - Data Engineering","logo":{"@type":"ImageObject","url":"https://NhoSW.github.io/my-tech-blog/favicon.ico"}}}</script></head><body id=top><header class=header><nav class=nav><div class=logo><a href=https://NhoSW.github.io/my-tech-blog/ accesskey=h title="OTL - Data Engineering (Alt + H)">OTL - Data Engineering</a><div class=logo-switches><button id=theme-toggle accesskey=t title="(Alt + T)" aria-label="Toggle theme">
<svg id="moon" width="24" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 12.79A9 9 0 1111.21 3 7 7 0 0021 12.79z"/></svg>
<svg id="sun" width="24" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="5"/><line x1="12" y1="1" x2="12" y2="3"/><line x1="12" y1="21" x2="12" y2="23"/><line x1="4.22" y1="4.22" x2="5.64" y2="5.64"/><line x1="18.36" y1="18.36" x2="19.78" y2="19.78"/><line x1="1" y1="12" x2="3" y2="12"/><line x1="21" y1="12" x2="23" y2="12"/><line x1="4.22" y1="19.78" x2="5.64" y2="18.36"/><line x1="18.36" y1="5.64" x2="19.78" y2="4.22"/></svg></button><ul class=lang-switch><li>|</li><li><a href=https://NhoSW.github.io/my-tech-blog/ko/ title=한국어 aria-label=한국어>Ko</a></li></ul></div></div><ul id=menu><li><a href=https://NhoSW.github.io/my-tech-blog/ title=Home><span>Home</span></a></li><li><a href=https://NhoSW.github.io/my-tech-blog/categories/ title=Categories><span>Categories</span></a></li><li><a href=https://NhoSW.github.io/my-tech-blog/tags/ title=Tags><span>Tags</span></a></li><li><a href=https://NhoSW.github.io/my-tech-blog/archives/ title=Archive><span>Archive</span></a></li><li><a href=https://NhoSW.github.io/my-tech-blog/search/ title="Search (Alt + /)" accesskey=/><span>Search</span></a></li><li><a href=https://NhoSW.github.io/my-tech-blog/about/ title=About><span>About</span></a></li></ul></nav></header><main class=main><article class=post-single><header class=post-header><div class=breadcrumbs><a href=https://NhoSW.github.io/my-tech-blog/>Home</a>&nbsp;»&nbsp;<a href=https://NhoSW.github.io/my-tech-blog/posts/>Posts</a></div><h1 class="post-title entry-hint-parent">StarRocks Compression Guide: Optimizing Performance and Storage</h1><div class=post-meta><span title='2026-02-23 00:00:00 +0000 UTC'>February 23, 2026</span>&nbsp;·&nbsp;<span>4 min</span>&nbsp;·&nbsp;<span>Seungwoo Noh</span>&nbsp;|&nbsp;<span>Translations:</span><ul class=i18n_list><li><a href=https://NhoSW.github.io/my-tech-blog/ko/posts/starrocks-compression-guide/>Ko</a></li></ul>&nbsp;|&nbsp;<span>
<a href=https://github.com/NhoSW/my-tech-blog/tree/main/content/posts/starrocks-compression-guide.md rel="noopener noreferrer edit" target=_blank>Suggest Changes</a></span></div></header><div class=toc><details><summary accesskey=c title="(Alt + C)"><span class=details>Table of Contents</span></summary><div class=inner><ul><li><a href=#why-compression-settings-matter aria-label="Why Compression Settings Matter">Why Compression Settings Matter</a></li><li><a href=#comparing-supported-compression-algorithms aria-label="Comparing Supported Compression Algorithms">Comparing Supported Compression Algorithms</a></li><li><a href=#setting-compression-when-creating-a-table aria-label="Setting Compression When Creating a Table">Setting Compression When Creating a Table</a><ul><li><a href=#real-time-analytics-table-lz4 aria-label="Real-time Analytics Table (LZ4)">Real-time Analytics Table (LZ4)</a></li><li><a href=#batch-analytics-table-zstd aria-label="Batch Analytics Table (ZSTD)">Batch Analytics Table (ZSTD)</a></li><li><a href=#changing-compression-on-an-existing-table aria-label="Changing Compression on an Existing Table">Changing Compression on an Existing Table</a></li></ul></li><li><a href=#recommended-compression-settings-by-workload aria-label="Recommended Compression Settings by Workload">Recommended Compression Settings by Workload</a></li><li><a href=#benchmark-results-compression-ratio-vs-performance-tradeoffs aria-label="Benchmark Results: Compression Ratio vs. Performance Tradeoffs">Benchmark Results: Compression Ratio vs. Performance Tradeoffs</a></li><li><a href=#operational-tips-and-monitoring aria-label="Operational Tips and Monitoring">Operational Tips and Monitoring</a></li></ul></div></details></div><div class=post-content><h2 id=why-compression-settings-matter>Why Compression Settings Matter<a hidden class=anchor aria-hidden=true href=#why-compression-settings-matter>#</a></h2><p>When you operate StarRocks long enough, there will inevitably come a point where your data grows to tens of terabytes. I have seen, time and again, cases where a single compression setting made a 30 to 50 percent difference in storage costs. But this is not just about disk space. Higher compression ratios reduce disk I/O and improve scan performance, while overly aggressive compression burns CPU and increases latency. Ultimately, choosing the right compression algorithm for your workload is one of the most important tuning decisions in StarRocks operations.</p><h2 id=comparing-supported-compression-algorithms>Comparing Supported Compression Algorithms<a hidden class=anchor aria-hidden=true href=#comparing-supported-compression-algorithms>#</a></h2><p>StarRocks supports several compression algorithms. Here is a comparison of the three most commonly used in practice.</p><table><thead><tr><th>Algorithm</th><th>Compression Ratio</th><th>Compression Speed</th><th>Decompression Speed</th><th>Best-fit Workload</th></tr></thead><tbody><tr><td>LZ4</td><td>Moderate (2-3x)</td><td>Very fast</td><td>Very fast</td><td>Real-time analytics, low-latency queries</td></tr><tr><td>ZSTD</td><td>High (4-6x)</td><td>Moderate</td><td>Fast</td><td>Batch analytics, cold data</td></tr><tr><td>Snappy</td><td>Low (1.5-2x)</td><td>Fast</td><td>Fast</td><td>General purpose, legacy compatibility</td></tr><tr><td>ZLIB</td><td>High (4-5x)</td><td>Slow</td><td>Moderate</td><td>Archiving, infrequently accessed data</td></tr></tbody></table><p>Personally, the combination I use most often is LZ4 for hot data and ZSTD for cold data. I occasionally use Snappy when dealing with data migrated from the Hadoop ecosystem, but I do not recommend it for new tables.</p><h2 id=setting-compression-when-creating-a-table>Setting Compression When Creating a Table<a hidden class=anchor aria-hidden=true href=#setting-compression-when-creating-a-table>#</a></h2><p>You can specify the compression algorithm via the <code>compression</code> property in <code>PROPERTIES</code> when creating a table. If no value is set, StarRocks defaults to LZ4.</p><h3 id=real-time-analytics-table-lz4>Real-time Analytics Table (LZ4)<a hidden class=anchor aria-hidden=true href=#real-time-analytics-table-lz4>#</a></h3><div class=highlight><pre tabindex=0 class=chroma><code class=language-sql data-lang=sql><span class=line><span class=cl><span class=k>CREATE</span><span class=w> </span><span class=k>TABLE</span><span class=w> </span><span class=n>analytics</span><span class=p>.</span><span class=n>realtime_events</span><span class=w> </span><span class=p>(</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=n>event_id</span><span class=w>       </span><span class=nb>BIGINT</span><span class=p>,</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=n>user_id</span><span class=w>        </span><span class=nb>BIGINT</span><span class=p>,</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=n>event_type</span><span class=w>     </span><span class=nb>VARCHAR</span><span class=p>(</span><span class=mi>64</span><span class=p>),</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=n>event_time</span><span class=w>     </span><span class=n>DATETIME</span><span class=p>,</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=n>properties</span><span class=w>     </span><span class=n>JSON</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=p>)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=n>ENGINE</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>OLAP</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=n>DUPLICATE</span><span class=w> </span><span class=k>KEY</span><span class=p>(</span><span class=n>event_id</span><span class=p>)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=n>DISTRIBUTED</span><span class=w> </span><span class=k>BY</span><span class=w> </span><span class=n>HASH</span><span class=p>(</span><span class=n>user_id</span><span class=p>)</span><span class=w> </span><span class=n>BUCKETS</span><span class=w> </span><span class=mi>32</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=n>PROPERTIES</span><span class=w> </span><span class=p>(</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=s2>&#34;replication_num&#34;</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=s2>&#34;3&#34;</span><span class=p>,</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=s2>&#34;compression&#34;</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=s2>&#34;LZ4&#34;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=p>);</span><span class=w>
</span></span></span></code></pre></div><p>LZ4 has overwhelmingly fast decompression speed, making it ideal for tables that need to serve dashboard queries with sub-second response times.</p><h3 id=batch-analytics-table-zstd>Batch Analytics Table (ZSTD)<a hidden class=anchor aria-hidden=true href=#batch-analytics-table-zstd>#</a></h3><div class=highlight><pre tabindex=0 class=chroma><code class=language-sql data-lang=sql><span class=line><span class=cl><span class=k>CREATE</span><span class=w> </span><span class=k>TABLE</span><span class=w> </span><span class=n>warehouse</span><span class=p>.</span><span class=n>order_history</span><span class=w> </span><span class=p>(</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=n>order_id</span><span class=w>       </span><span class=nb>BIGINT</span><span class=p>,</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=n>customer_id</span><span class=w>    </span><span class=nb>BIGINT</span><span class=p>,</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=n>order_date</span><span class=w>     </span><span class=nb>DATE</span><span class=p>,</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=n>total_amount</span><span class=w>   </span><span class=nb>DECIMAL</span><span class=p>(</span><span class=mi>18</span><span class=p>,</span><span class=w> </span><span class=mi>2</span><span class=p>),</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=n>status</span><span class=w>         </span><span class=nb>VARCHAR</span><span class=p>(</span><span class=mi>32</span><span class=p>),</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=n>items</span><span class=w>          </span><span class=nb>ARRAY</span><span class=o>&lt;</span><span class=n>STRUCT</span><span class=o>&lt;</span><span class=n>sku</span><span class=w> </span><span class=n>STRING</span><span class=p>,</span><span class=w> </span><span class=n>qty</span><span class=w> </span><span class=nb>INT</span><span class=p>,</span><span class=w> </span><span class=n>price</span><span class=w> </span><span class=nb>DECIMAL</span><span class=p>(</span><span class=mi>10</span><span class=p>,</span><span class=mi>2</span><span class=p>)</span><span class=o>&gt;&gt;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=p>)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=n>ENGINE</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>OLAP</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=n>DUPLICATE</span><span class=w> </span><span class=k>KEY</span><span class=p>(</span><span class=n>order_id</span><span class=p>)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=n>PARTITION</span><span class=w> </span><span class=k>BY</span><span class=w> </span><span class=n>RANGE</span><span class=p>(</span><span class=n>order_date</span><span class=p>)</span><span class=w> </span><span class=p>(</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=n>PARTITION</span><span class=w> </span><span class=n>p2025</span><span class=w> </span><span class=k>VALUES</span><span class=w> </span><span class=k>LESS</span><span class=w> </span><span class=k>THAN</span><span class=w> </span><span class=p>(</span><span class=s1>&#39;2026-01-01&#39;</span><span class=p>),</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=n>PARTITION</span><span class=w> </span><span class=n>p2026</span><span class=w> </span><span class=k>VALUES</span><span class=w> </span><span class=k>LESS</span><span class=w> </span><span class=k>THAN</span><span class=w> </span><span class=p>(</span><span class=s1>&#39;2027-01-01&#39;</span><span class=p>)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=p>)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=n>DISTRIBUTED</span><span class=w> </span><span class=k>BY</span><span class=w> </span><span class=n>HASH</span><span class=p>(</span><span class=n>customer_id</span><span class=p>)</span><span class=w> </span><span class=n>BUCKETS</span><span class=w> </span><span class=mi>16</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=n>PROPERTIES</span><span class=w> </span><span class=p>(</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=s2>&#34;replication_num&#34;</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=s2>&#34;2&#34;</span><span class=p>,</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=s2>&#34;compression&#34;</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=s2>&#34;ZSTD&#34;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=p>);</span><span class=w>
</span></span></span></code></pre></div><p>ZSTD achieves 1.5 to 2 times higher compression ratios than LZ4, which translates into significant storage savings on history tables where hundreds of millions of rows accumulate per partition.</p><h3 id=changing-compression-on-an-existing-table>Changing Compression on an Existing Table<a hidden class=anchor aria-hidden=true href=#changing-compression-on-an-existing-table>#</a></h3><p>If you want to change the compression algorithm on a table that is already in production, you can use <code>ALTER TABLE</code>. Keep in mind, however, that the new setting only applies to data loaded after the change. Existing segments will not be recompressed until a compaction cycle runs against them.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-sql data-lang=sql><span class=line><span class=cl><span class=k>ALTER</span><span class=w> </span><span class=k>TABLE</span><span class=w> </span><span class=n>warehouse</span><span class=p>.</span><span class=n>order_history</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=k>SET</span><span class=w> </span><span class=p>(</span><span class=s2>&#34;compression&#34;</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=s2>&#34;ZSTD&#34;</span><span class=p>);</span><span class=w>
</span></span></span></code></pre></div><h2 id=recommended-compression-settings-by-workload>Recommended Compression Settings by Workload<a hidden class=anchor aria-hidden=true href=#recommended-compression-settings-by-workload>#</a></h2><p>The following recommendations are based on patterns I have validated repeatedly in production environments.</p><ul><li><strong>Real-time dashboards / Ad-hoc queries:</strong> Use LZ4. Its CPU overhead is negligible, minimizing the impact on P99 latency.</li><li><strong>Nightly batch reports / ETL result tables:</strong> Use ZSTD. When query frequency is low and data volume is high, the storage savings translate directly into cost reductions.</li><li><strong>High-volume log ingestion:</strong> Use ZSTD, but lower <code>zstd_compression_level</code> to 3 or below. This strikes a good balance between compression speed and compression ratio.</li></ul><h2 id=benchmark-results-compression-ratio-vs-performance-tradeoffs>Benchmark Results: Compression Ratio vs. Performance Tradeoffs<a hidden class=anchor aria-hidden=true href=#benchmark-results-compression-ratio-vs-performance-tradeoffs>#</a></h2><p>The following benchmark was run against an event log table containing approximately 5 billion rows (roughly 800 GB uncompressed).</p><table><thead><tr><th>Metric</th><th>LZ4</th><th>ZSTD (level 3)</th><th>ZSTD (level 9)</th></tr></thead><tbody><tr><td>Compressed size</td><td>320 GB</td><td>195 GB</td><td>170 GB</td></tr><tr><td>Compression ratio</td><td>2.5x</td><td>4.1x</td><td>4.7x</td></tr><tr><td>Simple scan query (Avg)</td><td>1.2 s</td><td>1.5 s</td><td>1.8 s</td></tr><tr><td>Aggregation query (Avg)</td><td>3.4 s</td><td>3.8 s</td><td>4.5 s</td></tr><tr><td>Data ingestion throughput</td><td>120 MB/s</td><td>95 MB/s</td><td>60 MB/s</td></tr></tbody></table><p>Compared to LZ4, ZSTD level 3 reduced storage by approximately 39% while only increasing query latency by about 10 to 15 percent. ZSTD level 9, on the other hand, offered diminishing compression gains at the cost of a steep drop in ingestion throughput, making level 3 the optimal choice in most environments.</p><h2 id=operational-tips-and-monitoring>Operational Tips and Monitoring<a hidden class=anchor aria-hidden=true href=#operational-tips-and-monitoring>#</a></h2><p>Here are three tips from production experience:</p><ol><li><strong>Always monitor compaction.</strong> Keep an eye on the <code>compaction_score</code> metric. When compression settings change or data volumes spike, compaction can fall behind, leading to degraded query performance from an excessive number of small segments.</li><li><strong>Separate compression strategies at the table level.</strong> Do not apply a single compression algorithm across your entire cluster. Match the algorithm to each table&rsquo;s access pattern &ndash; LZ4 for frequently queried tables, ZSTD for archival ones.</li><li><strong>Track disk usage trends over time.</strong> Use <code>SHOW DATA</code> to monitor how each table&rsquo;s storage footprint evolves after compression changes.</li></ol><div class=highlight><pre tabindex=0 class=chroma><code class=language-sql data-lang=sql><span class=line><span class=cl><span class=k>SHOW</span><span class=w> </span><span class=k>DATA</span><span class=w> </span><span class=k>FROM</span><span class=w> </span><span class=n>warehouse</span><span class=p>.</span><span class=n>order_history</span><span class=p>;</span><span class=w>
</span></span></span></code></pre></div><p>Compression is not a set-it-and-forget-it decision. As data volumes grow and query patterns shift, it is worth revisiting your compression settings periodically. Even a small adjustment can yield meaningful improvements in both performance and infrastructure costs over time.</p></div><footer class=post-footer><ul class=post-tags><li><a href=https://NhoSW.github.io/my-tech-blog/tags/starrocks/>Starrocks</a></li><li><a href=https://NhoSW.github.io/my-tech-blog/tags/compression/>Compression</a></li><li><a href=https://NhoSW.github.io/my-tech-blog/tags/optimization/>Optimization</a></li></ul><nav class=paginav><a class=prev href=https://NhoSW.github.io/my-tech-blog/posts/starrocks-adoption-guide/><span class=title>« Prev</span><br><span>StarRocks Adoption Story: Revolutionizing Data Pipelines with Real-time OLAP</span></a></nav><ul class=share-buttons><li><a target=_blank rel="noopener noreferrer" aria-label="share StarRocks Compression Guide: Optimizing Performance and Storage on x" href="https://x.com/intent/tweet/?text=StarRocks%20Compression%20Guide%3a%20Optimizing%20Performance%20and%20Storage&amp;url=https%3a%2f%2fNhoSW.github.io%2fmy-tech-blog%2fposts%2fstarrocks-compression-guide%2f&amp;hashtags=starrocks%2ccompression%2coptimization"><svg viewBox="0 0 512 512" height="30" width="30" fill="currentColor"><path d="M512 62.554V449.446C512 483.97 483.97 512 449.446 512H62.554C28.03 512 0 483.97.0 449.446V62.554C0 28.03 28.029.0 62.554.0H449.446C483.971.0 512 28.03 512 62.554zM269.951 190.75 182.567 75.216H56L207.216 272.95 63.9 436.783h61.366L235.9 310.383l96.667 126.4H456L298.367 228.367l134-153.151H371.033zM127.633 110h36.468l219.38 290.065H349.5z"/></svg></a></li><li><a target=_blank rel="noopener noreferrer" aria-label="share StarRocks Compression Guide: Optimizing Performance and Storage on linkedin" href="https://www.linkedin.com/shareArticle?mini=true&amp;url=https%3a%2f%2fNhoSW.github.io%2fmy-tech-blog%2fposts%2fstarrocks-compression-guide%2f&amp;title=StarRocks%20Compression%20Guide%3a%20Optimizing%20Performance%20and%20Storage&amp;summary=StarRocks%20Compression%20Guide%3a%20Optimizing%20Performance%20and%20Storage&amp;source=https%3a%2f%2fNhoSW.github.io%2fmy-tech-blog%2fposts%2fstarrocks-compression-guide%2f"><svg viewBox="0 0 512 512" height="30" width="30" fill="currentColor"><path d="M449.446.0C483.971.0 512 28.03 512 62.554v386.892C512 483.97 483.97 512 449.446 512H62.554c-34.524.0-62.554-28.03-62.554-62.554V62.554c0-34.524 28.029-62.554 62.554-62.554h386.892zM160.461 423.278V197.561h-75.04v225.717h75.04zm270.539.0V293.839c0-69.333-37.018-101.586-86.381-101.586-39.804.0-57.634 21.891-67.617 37.266v-31.958h-75.021c.995 21.181.0 225.717.0 225.717h75.02V297.222c0-6.748.486-13.492 2.474-18.315 5.414-13.475 17.767-27.434 38.494-27.434 27.135.0 38.007 20.707 38.007 51.037v120.768H431zM123.448 88.722C97.774 88.722 81 105.601 81 127.724c0 21.658 16.264 39.002 41.455 39.002h.484c26.165.0 42.452-17.344 42.452-39.002-.485-22.092-16.241-38.954-41.943-39.002z"/></svg></a></li><li><a target=_blank rel="noopener noreferrer" aria-label="share StarRocks Compression Guide: Optimizing Performance and Storage on reddit" href="https://reddit.com/submit?url=https%3a%2f%2fNhoSW.github.io%2fmy-tech-blog%2fposts%2fstarrocks-compression-guide%2f&title=StarRocks%20Compression%20Guide%3a%20Optimizing%20Performance%20and%20Storage"><svg viewBox="0 0 512 512" height="30" width="30" fill="currentColor"><path d="M449.446.0C483.971.0 512 28.03 512 62.554v386.892C512 483.97 483.97 512 449.446 512H62.554c-34.524.0-62.554-28.03-62.554-62.554V62.554c0-34.524 28.029-62.554 62.554-62.554h386.892zM446 265.638c0-22.964-18.616-41.58-41.58-41.58-11.211.0-21.361 4.457-28.841 11.666-28.424-20.508-67.586-33.757-111.204-35.278l18.941-89.121 61.884 13.157c.756 15.734 13.642 28.29 29.56 28.29 16.407.0 29.706-13.299 29.706-29.701.0-16.403-13.299-29.702-29.706-29.702-11.666.0-21.657 6.792-26.515 16.578l-69.105-14.69c-1.922-.418-3.939-.042-5.585 1.036-1.658 1.073-2.811 2.761-3.224 4.686l-21.152 99.438c-44.258 1.228-84.046 14.494-112.837 35.232-7.468-7.164-17.589-11.591-28.757-11.591-22.965.0-41.585 18.616-41.585 41.58.0 16.896 10.095 31.41 24.568 37.918-.639 4.135-.99 8.328-.99 12.576.0 63.977 74.469 115.836 166.33 115.836s166.334-51.859 166.334-115.836c0-4.218-.347-8.387-.977-12.493 14.564-6.47 24.735-21.034 24.735-38.001zM326.526 373.831c-20.27 20.241-59.115 21.816-70.534 21.816-11.428.0-50.277-1.575-70.522-21.82-3.007-3.008-3.007-7.882.0-10.889 3.003-2.999 7.882-3.003 10.885.0 12.777 12.781 40.11 17.317 59.637 17.317 19.522.0 46.86-4.536 59.657-17.321 3.016-2.999 7.886-2.995 10.885.008 3.008 3.011 3.003 7.882-.008 10.889zm-5.23-48.781c-16.373.0-29.701-13.324-29.701-29.698.0-16.381 13.328-29.714 29.701-29.714 16.378.0 29.706 13.333 29.706 29.714.0 16.374-13.328 29.698-29.706 29.698zM160.91 295.348c0-16.381 13.328-29.71 29.714-29.71 16.369.0 29.689 13.329 29.689 29.71.0 16.373-13.32 29.693-29.689 29.693-16.386.0-29.714-13.32-29.714-29.693z"/></svg></a></li><li><a target=_blank rel="noopener noreferrer" aria-label="share StarRocks Compression Guide: Optimizing Performance and Storage on facebook" href="https://facebook.com/sharer/sharer.php?u=https%3a%2f%2fNhoSW.github.io%2fmy-tech-blog%2fposts%2fstarrocks-compression-guide%2f"><svg viewBox="0 0 512 512" height="30" width="30" fill="currentColor"><path d="M449.446.0C483.971.0 512 28.03 512 62.554v386.892C512 483.97 483.97 512 449.446 512H342.978V319.085h66.6l12.672-82.621h-79.272v-53.617c0-22.603 11.073-44.636 46.58-44.636H425.6v-70.34s-32.71-5.582-63.982-5.582c-65.288.0-107.96 39.569-107.96 111.204v62.971h-72.573v82.621h72.573V512h-191.104c-34.524.0-62.554-28.03-62.554-62.554V62.554c0-34.524 28.029-62.554 62.554-62.554h386.892z"/></svg></a></li><li><a target=_blank rel="noopener noreferrer" aria-label="share StarRocks Compression Guide: Optimizing Performance and Storage on whatsapp" href="https://api.whatsapp.com/send?text=StarRocks%20Compression%20Guide%3a%20Optimizing%20Performance%20and%20Storage%20-%20https%3a%2f%2fNhoSW.github.io%2fmy-tech-blog%2fposts%2fstarrocks-compression-guide%2f"><svg viewBox="0 0 512 512" height="30" width="30" fill="currentColor"><path d="M449.446.0C483.971.0 512 28.03 512 62.554v386.892C512 483.97 483.97 512 449.446 512H62.554c-34.524.0-62.554-28.03-62.554-62.554V62.554c0-34.524 28.029-62.554 62.554-62.554h386.892zm-58.673 127.703c-33.842-33.881-78.847-52.548-126.798-52.568-98.799.0-179.21 80.405-179.249 179.234-.013 31.593 8.241 62.428 23.927 89.612l-25.429 92.884 95.021-24.925c26.181 14.28 55.659 21.807 85.658 21.816h.074c98.789.0 179.206-80.413 179.247-179.243.018-47.895-18.61-92.93-52.451-126.81zM263.976 403.485h-.06c-26.734-.01-52.954-7.193-75.828-20.767l-5.441-3.229-56.386 14.792 15.05-54.977-3.542-5.637c-14.913-23.72-22.791-51.136-22.779-79.287.033-82.142 66.867-148.971 149.046-148.971 39.793.014 77.199 15.531 105.329 43.692 28.128 28.16 43.609 65.592 43.594 105.4-.034 82.149-66.866 148.983-148.983 148.984zm81.721-111.581c-4.479-2.242-26.499-13.075-30.604-14.571-4.105-1.495-7.091-2.241-10.077 2.241-2.986 4.483-11.569 14.572-14.182 17.562-2.612 2.988-5.225 3.364-9.703 1.12-4.479-2.241-18.91-6.97-36.017-22.23C231.8 264.15 222.81 249.484 220.198 245s-.279-6.908 1.963-9.14c2.016-2.007 4.48-5.232 6.719-7.847 2.24-2.615 2.986-4.484 4.479-7.472 1.493-2.99.747-5.604-.374-7.846-1.119-2.241-10.077-24.288-13.809-33.256-3.635-8.733-7.327-7.55-10.077-7.688-2.609-.13-5.598-.158-8.583-.158-2.986.0-7.839 1.121-11.944 5.604-4.105 4.484-15.675 15.32-15.675 37.364.0 22.046 16.048 43.342 18.287 46.332 2.24 2.99 31.582 48.227 76.511 67.627 10.685 4.615 19.028 7.371 25.533 9.434 10.728 3.41 20.492 2.929 28.209 1.775 8.605-1.285 26.499-10.833 30.231-21.295 3.732-10.464 3.732-19.431 2.612-21.298-1.119-1.869-4.105-2.99-8.583-5.232z"/></svg></a></li><li><a target=_blank rel="noopener noreferrer" aria-label="share StarRocks Compression Guide: Optimizing Performance and Storage on telegram" href="https://telegram.me/share/url?text=StarRocks%20Compression%20Guide%3a%20Optimizing%20Performance%20and%20Storage&amp;url=https%3a%2f%2fNhoSW.github.io%2fmy-tech-blog%2fposts%2fstarrocks-compression-guide%2f"><svg viewBox="2 2 28 28" height="30" width="30" fill="currentColor"><path d="M26.49 29.86H5.5a3.37 3.37.0 01-2.47-1 3.35 3.35.0 01-1-2.47V5.48A3.36 3.36.0 013 3 3.37 3.37.0 015.5 2h21A3.38 3.38.0 0129 3a3.36 3.36.0 011 2.46V26.37a3.35 3.35.0 01-1 2.47 3.38 3.38.0 01-2.51 1.02zm-5.38-6.71a.79.79.0 00.85-.66L24.73 9.24a.55.55.0 00-.18-.46.62.62.0 00-.41-.17q-.08.0-16.53 6.11a.59.59.0 00-.41.59.57.57.0 00.43.52l4 1.24 1.61 4.83a.62.62.0 00.63.43.56.56.0 00.4-.17L16.54 20l4.09 3A.9.9.0 0021.11 23.15zM13.8 20.71l-1.21-4q8.72-5.55 8.78-5.55c.15.0.23.0.23.16a.18.18.0 010 .06s-2.51 2.3-7.52 6.8z"/></svg></a></li><li><a target=_blank rel="noopener noreferrer" aria-label="share StarRocks Compression Guide: Optimizing Performance and Storage on ycombinator" href="https://news.ycombinator.com/submitlink?t=StarRocks%20Compression%20Guide%3a%20Optimizing%20Performance%20and%20Storage&u=https%3a%2f%2fNhoSW.github.io%2fmy-tech-blog%2fposts%2fstarrocks-compression-guide%2f"><svg width="30" height="30" viewBox="0 0 512 512" fill="currentColor"><path d="M449.446.0C483.971.0 512 28.03 512 62.554V449.446C512 483.97 483.97 512 449.446 512H62.554C28.03 512 0 483.97.0 449.446V62.554C0 28.03 28.029.0 62.554.0H449.446zM183.8767 87.9921h-62.034L230.6673 292.4508V424.0079h50.6655V292.4508L390.1575 87.9921H328.1233L256 238.2489z"/></svg></a></li></ul></footer></article></main><footer class=footer><span>&copy; 2026 <a href=https://NhoSW.github.io/my-tech-blog/>OTL - Data Engineering</a></span> ·
<span>Powered by
<a href=https://gohugo.io/ rel="noopener noreferrer" target=_blank>Hugo</a> &
<a href=https://github.com/adityatelange/hugo-PaperMod/ rel=noopener target=_blank>PaperMod</a></span></footer><a href=#top aria-label="go to top" title="Go to Top (Alt + G)" class=top-link id=top-link accesskey=g><svg viewBox="0 0 12 6" fill="currentColor"><path d="M12 6H0l6-6z"/></svg>
</a><script>let menu=document.getElementById("menu");if(menu){const e=localStorage.getItem("menu-scroll-position");e&&(menu.scrollLeft=parseInt(e,10)),menu.onscroll=function(){localStorage.setItem("menu-scroll-position",menu.scrollLeft)}}document.querySelectorAll('a[href^="#"]').forEach(e=>{e.addEventListener("click",function(e){e.preventDefault();var t=this.getAttribute("href").substr(1);window.matchMedia("(prefers-reduced-motion: reduce)").matches?document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView():document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView({behavior:"smooth"}),t==="top"?history.replaceState(null,null," "):history.pushState(null,null,`#${t}`)})})</script><script>var mybutton=document.getElementById("top-link");window.onscroll=function(){document.body.scrollTop>800||document.documentElement.scrollTop>800?(mybutton.style.visibility="visible",mybutton.style.opacity="1"):(mybutton.style.visibility="hidden",mybutton.style.opacity="0")}</script><script>document.getElementById("theme-toggle").addEventListener("click",()=>{const e=document.querySelector("html");e.dataset.theme==="dark"?(e.dataset.theme="light",localStorage.setItem("pref-theme","light")):(e.dataset.theme="dark",localStorage.setItem("pref-theme","dark"))})</script><script>document.querySelectorAll("pre > code").forEach(e=>{const n=e.parentNode.parentNode,t=document.createElement("button");t.classList.add("copy-code"),t.innerHTML="copy";function s(){t.innerHTML="copied!",setTimeout(()=>{t.innerHTML="copy"},2e3)}t.addEventListener("click",t=>{if("clipboard"in navigator){navigator.clipboard.writeText(e.textContent),s();return}const n=document.createRange();n.selectNodeContents(e);const o=window.getSelection();o.removeAllRanges(),o.addRange(n);try{document.execCommand("copy"),s()}catch{}o.removeRange(n)}),n.classList.contains("highlight")?n.appendChild(t):n.parentNode.firstChild==n||(e.parentNode.parentNode.parentNode.parentNode.parentNode.nodeName=="TABLE"?e.parentNode.parentNode.parentNode.parentNode.parentNode.appendChild(t):e.parentNode.appendChild(t))})</script></body></html>