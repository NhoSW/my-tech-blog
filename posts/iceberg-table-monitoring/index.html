<!doctype html><html lang=ko dir=ltr class=scroll-smooth data-default-appearance=dark data-auto-appearance=true><head><meta charset=utf-8><meta http-equiv=content-language content="ko"><meta name=viewport content="width=device-width,initial-scale=1"><meta http-equiv=X-UA-Compatible content="ie=edge"><meta name=theme-color><title>Iceberg 테이블 모니터링 구축: Trino 메타테이블과 Prometheus Pushgateway &#183; nanta - 데이터 엔지니어링</title><meta name=title content="Iceberg 테이블 모니터링 구축: Trino 메타테이블과 Prometheus Pushgateway &#183; nanta - 데이터 엔지니어링"><meta name=description content="Iceberg 테이블 수가 늘어나면서 파일 상태를 체계적으로 모니터링할 필요가 생겼다. Trino 메타테이블을 활용해 파일 수, 크기, 파티션 분포를 추적하고 Prometheus Pushgateway와 Grafana로 대시보드를 구성했다. 과정에서 만난 Trino 버그와 성능 이슈도 정리했다."><meta name=keywords content="iceberg,trino,monitoring,grafana,prometheus,pushgateway,airflow,"><link rel=canonical href=https://nanta-data.dev/posts/iceberg-table-monitoring/><meta name=author content="nanta"><link href=https://github.com/NhoSW rel=me><meta property="og:url" content="https://nanta-data.dev/posts/iceberg-table-monitoring/"><meta property="og:site_name" content="nanta - 데이터 엔지니어링"><meta property="og:title" content="Iceberg 테이블 모니터링 구축: Trino 메타테이블과 Prometheus Pushgateway"><meta property="og:description" content="Iceberg 테이블 수가 늘어나면서 파일 상태를 체계적으로 모니터링할 필요가 생겼다. Trino 메타테이블을 활용해 파일 수, 크기, 파티션 분포를 추적하고 Prometheus Pushgateway와 Grafana로 대시보드를 구성했다. 과정에서 만난 Trino 버그와 성능 이슈도 정리했다."><meta property="og:locale" content="ko"><meta property="og:type" content="article"><meta property="article:section" content="posts"><meta property="article:published_time" content="2026-02-27T00:00:00+00:00"><meta property="article:modified_time" content="2026-02-27T00:00:00+00:00"><meta property="article:tag" content="Iceberg"><meta property="article:tag" content="Trino"><meta property="article:tag" content="Monitoring"><meta property="article:tag" content="Grafana"><meta property="article:tag" content="Prometheus"><meta property="article:tag" content="Pushgateway"><meta name=twitter:card content="summary"><meta name=twitter:title content="Iceberg 테이블 모니터링 구축: Trino 메타테이블과 Prometheus Pushgateway"><meta name=twitter:description content="Iceberg 테이블 수가 늘어나면서 파일 상태를 체계적으로 모니터링할 필요가 생겼다. Trino 메타테이블을 활용해 파일 수, 크기, 파티션 분포를 추적하고 Prometheus Pushgateway와 Grafana로 대시보드를 구성했다. 과정에서 만난 Trino 버그와 성능 이슈도 정리했다."><link type=text/css rel=stylesheet href=/css/main.bundle.min.c14e86e0d9a09802d254d2a15c05847ae65bfc2e98c2166fabc67369d2d7f2eae6c1da03bbba58cfd41a4af802147c75ce9fdc11dd724ac627ab2903942cbb79.css integrity="sha512-wU6G4NmgmALSVNKhXAWEeuZb/C6YwhZvq8ZzadLX8urmwdoDu7pYz9QaSvgCFHx1zp/cEd1ySsYnqykDlCy7eQ=="><script type=text/javascript src=/js/appearance.min.6f41174b3a05b680820fe08cadbfa5fb7a7ca347b76a0955cdc68b9d8aca1ce24f0547e138cea33bcc7904d551a90afcb1cc7f2d9fe8557075d501419046c08c.js integrity="sha512-b0EXSzoFtoCCD+CMrb+l+3p8o0e3aglVzcaLnYrKHOJPBUfhOM6jO8x5BNVRqQr8scx/LZ/oVXB11QFBkEbAjA=="></script><script src=/lib/zoom/zoom.min.umd.a527109b68c082a70f3697716dd72a9d5aa8b545cf800cecbbc7399f2ca6f6e0ce3e431f2062b48bbfa47c9ea42822714060bef309be073f49b9c0e30d318d7b.js integrity="sha512-pScQm2jAgqcPNpdxbdcqnVqotUXPgAzsu8c5nyym9uDOPkMfIGK0i7+kfJ6kKCJxQGC+8wm+Bz9JucDjDTGNew=="></script><script defer type=text/javascript id=script-bundle src=/js/main.bundle.min.bdda7dece6cbaf08deef7d254f7f842f3261c2524d247905127c9a20decc03f1011a2950048464c79272c1ce0705a49a41147f39f2b95163bb71d404b33263ef.js integrity="sha512-vdp97ObLrwje730lT3+ELzJhwlJNJHkFEnyaIN7MA/EBGilQBIRkx5Jywc4HBaSaQRR/OfK5UWO7cdQEszJj7w==" data-copy=복사 data-copied=복사되었습니다></script><link rel=apple-touch-icon sizes=180x180 href=/apple-touch-icon.png><link rel=icon type=image/png sizes=32x32 href=/favicon-32x32.png><link rel=icon type=image/png sizes=16x16 href=/favicon-16x16.png><link rel=manifest href=/site.webmanifest><script type=application/ld+json>[{"@context":"https://schema.org","@type":"Article","articleSection":"글 목록","name":"Iceberg 테이블 모니터링 구축: Trino 메타테이블과 Prometheus Pushgateway","headline":"Iceberg 테이블 모니터링 구축: Trino 메타테이블과 Prometheus Pushgateway","inLanguage":"ko","url":"https://nanta-data.dev/posts/iceberg-table-monitoring/","author":{"@type":"Person","name":"nanta"},"copyrightYear":"2026","dateCreated":"2026-02-27T00:00:00\u002b00:00","datePublished":"2026-02-27T00:00:00\u002b00:00","dateModified":"2026-02-27T00:00:00\u002b00:00","keywords":["iceberg","trino","monitoring","grafana","prometheus","pushgateway","airflow"],"mainEntityOfPage":"true","wordCount":"1153"}]</script><link rel=preconnect href=https://cdn.jsdelivr.net crossorigin><link href=https://cdn.jsdelivr.net/npm/geist@1.3.1/dist/fonts/geist-sans/style.min.css rel=stylesheet><link href=https://cdn.jsdelivr.net/npm/geist@1.3.1/dist/fonts/geist-mono/style.min.css rel=stylesheet></head><body class="flex flex-col h-screen m-auto leading-7 max-w-7xl px-6 sm:px-14 md:px-24 lg:px-32 text-lg bg-neutral text-neutral-900 dark:bg-neutral-800 dark:text-neutral bf-scrollbar"><div id=the-top class="absolute flex self-center"><a class="px-3 py-1 text-sm -translate-y-8 rounded-b-lg bg-primary-200 focus:translate-y-0 dark:bg-neutral-600" href=#main-content><span class="font-bold text-primary-600 pe-2 dark:text-primary-400">&darr;</span>
본문으로 건너뛰기</a></div><div class=min-h-[148px]></div><div class="fixed inset-x-0 z-100"><div id=menu-blur class="absolute opacity-0 inset-x-0 top-0 h-full single_hero_background nozoom backdrop-blur-2xl shadow-2xl bg-neutral/25 dark:bg-neutral-800/25"></div><div class="relative m-auto leading-7 max-w-7xl px-6 sm:px-14 md:px-24 lg:px-32"><div class="main-menu flex items-center w-full gap-2 p-1 pl-0"><a href=/ class="text-base font-medium truncate min-w-0 shrink">nanta - 데이터 엔지니어링</a><div class="flex items-center ms-auto"><div class="hidden md:flex"><nav class="flex items-center gap-x-5 h-12"><a href=/posts/ class="flex items-center bf-icon-color-hover" aria-label="글 목록" title="글 목록"><span class="text-base font-medium break-normal">글 목록
</span></a><a href=/categories/ class="flex items-center bf-icon-color-hover" aria-label=카테고리 title=Categories><span class="text-base font-medium break-normal">카테고리
</span></a><a href=/tags/ class="flex items-center bf-icon-color-hover" aria-label=태그 title=Tags><span class="text-base font-medium break-normal">태그
</span></a><a href=/about/ class="flex items-center bf-icon-color-hover" aria-label=소개 title=소개><span class="text-base font-medium break-normal">소개</span></a><div class="translation nested-menu"><button class="cursor-pointer flex items-center">
<span class=me-1><span class="relative block icon"><svg viewBox="0 0 640 512"><path fill="currentColor" d="M0 128C0 92.7 28.7 64 64 64H256h48 16H576c35.3.0 64 28.7 64 64V384c0 35.3-28.7 64-64 64H320 304 256 64c-35.3.0-64-28.7-64-64V128zm320 0V384H576V128H320zM178.3 175.9c-3.2-7.2-10.4-11.9-18.3-11.9s-15.1 4.7-18.3 11.9l-64 144c-4.5 10.1.1 21.9 10.2 26.4s21.9-.1 26.4-10.2l8.9-20.1h73.6l8.9 20.1c4.5 10.1 16.3 14.6 26.4 10.2s14.6-16.3 10.2-26.4l-64-144zM160 233.2 179 276H141l19-42.8zM448 164c11 0 20 9 20 20v4h44 16c11 0 20 9 20 20s-9 20-20 20h-2l-1.6 4.5c-8.9 24.4-22.4 46.6-39.6 65.4.9.6 1.8 1.1 2.7 1.6l18.9 11.3c9.5 5.7 12.5 18 6.9 27.4s-18 12.5-27.4 6.9L467 333.8c-4.5-2.7-8.8-5.5-13.1-8.5-10.6 7.5-21.9 14-34 19.4l-3.6 1.6c-10.1 4.5-21.9-.1-26.4-10.2s.1-21.9 10.2-26.4l3.6-1.6c6.4-2.9 12.6-6.1 18.5-9.8L410 286.1c-7.8-7.8-7.8-20.5.0-28.3s20.5-7.8 28.3.0l14.6 14.6.5.5c12.4-13.1 22.5-28.3 29.8-45H448 376c-11 0-20-9-20-20s9-20 20-20h52v-4c0-11 9-20 20-20z"/></svg></span>
</span><span class="text-sm font-medium bf-icon-color-hover" title="Iceberg 테이블 모니터링 구축: Trino 메타테이블과 Prometheus Pushgateway">KO</span></button><ul class=menuhide><li class="rounded-xl backdrop-blur shadow-2xl p-2 flex flex-col gap-1"><a href=/posts/iceberg-table-monitoring/ class="flex items-center bf-icon-color-hover px-3 py-1"><span class="text-sm font-sm" title="Iceberg 테이블 모니터링 구축: Trino 메타테이블과 Prometheus Pushgateway">한국어
</span></a><a href=/en/posts/iceberg-table-monitoring/ class="flex items-center bf-icon-color-hover px-3 py-1"><span class="text-sm font-sm" title="Building Iceberg Table Monitoring with Trino Meta-Tables and Prometheus Pushgateway">English</span></a></li></ul></div><button id=search-button aria-label=Search class="text-base bf-icon-color-hover" title="검색하기 (/)">
<span class="relative block icon"><svg aria-hidden="true" focusable="false" data-prefix="fas" data-icon="search" class="svg-inline--fa fa-search fa-w-16" role="img" viewBox="0 0 512 512"><path fill="currentColor" d="M505 442.7 405.3 343c-4.5-4.5-10.6-7-17-7H372c27.6-35.3 44-79.7 44-128C416 93.1 322.9.0 208 0S0 93.1.0 208s93.1 208 208 208c48.3.0 92.7-16.4 128-44v16.3c0 6.4 2.5 12.5 7 17l99.7 99.7c9.4 9.4 24.6 9.4 33.9.0l28.3-28.3c9.4-9.4 9.4-24.6.1-34zM208 336c-70.7.0-128-57.2-128-128 0-70.7 57.2-128 128-128 70.7.0 128 57.2 128 128 0 70.7-57.2 128-128 128z"/></svg></span></button><div class="flex items-center"><button id=appearance-switcher aria-label="Dark mode switcher" type=button class="text-base bf-icon-color-hover"><div class="flex items-center justify-center dark:hidden"><span class="relative block icon"><svg viewBox="0 0 512 512"><path fill="currentColor" d="M32 256C32 132.2 132.3 32 255.8 32c11.36.0 29.7 1.668 40.9 3.746 9.616 1.777 11.75 14.63 3.279 19.44C245 86.5 211.2 144.6 211.2 207.8c0 109.7 99.71 193 208.3 172.3 9.561-1.805 16.28 9.324 10.11 16.95C387.9 448.6 324.8 480 255.8 480 132.1 480 32 379.6 32 256z"/></svg></span></div><div class="items-center justify-center hidden dark:flex"><span class="relative block icon"><svg viewBox="0 0 512 512"><path fill="currentColor" d="M256 159.1c-53.02.0-95.1 42.98-95.1 95.1s41.2 96.9 95.1 96.9 95.1-42.98 95.1-95.1S309 159.1 256 159.1zM509.3 347l-63.2-91.9 63.15-91.01c6.332-9.125 1.104-21.74-9.826-23.72l-109-19.7-19.7-109c-1.975-10.93-14.59-16.16-23.72-9.824L256 65.89 164.1 2.736c-9.125-6.332-21.74-1.107-23.72 9.824L121.6 121.6 12.56 141.3C1.633 143.2-3.596 155.9 2.736 164.1L65.89 256 2.74 347.01c-6.332 9.125-1.105 21.74 9.824 23.72l109 19.7 19.7 109c1.975 10.93 14.59 16.16 23.72 9.824L256 446.1l91.01 63.15c9.127 6.334 21.75 1.107 23.72-9.822l19.7-109 109-19.7C510.4 368.8 515.6 356.1 509.3 347zM256 383.1c-70.69.0-127.1-57.31-127.1-127.1.0-70.69 57.31-127.1 127.1-127.1S383.1 186.2 383.1 256c0 70.7-56.4 127.1-127.1 127.1z"/></svg></span></div></button></div></nav></div><div class="flex md:hidden"><div class="flex items-center h-14 gap-4"><button id=search-button-mobile aria-label=Search class="flex items-center justify-center bf-icon-color-hover" title="검색하기 (/)">
<span class="relative block icon"><svg aria-hidden="true" focusable="false" data-prefix="fas" data-icon="search" class="svg-inline--fa fa-search fa-w-16" role="img" viewBox="0 0 512 512"><path fill="currentColor" d="M505 442.7 405.3 343c-4.5-4.5-10.6-7-17-7H372c27.6-35.3 44-79.7 44-128C416 93.1 322.9.0 208 0S0 93.1.0 208s93.1 208 208 208c48.3.0 92.7-16.4 128-44v16.3c0 6.4 2.5 12.5 7 17l99.7 99.7c9.4 9.4 24.6 9.4 33.9.0l28.3-28.3c9.4-9.4 9.4-24.6.1-34zM208 336c-70.7.0-128-57.2-128-128 0-70.7 57.2-128 128-128 70.7.0 128 57.2 128 128 0 70.7-57.2 128-128 128z"/></svg>
</span></button>
<button id=appearance-switcher-mobile type=button aria-label="Dark mode switcher" class="flex items-center justify-center text-neutral-900 hover:text-primary-600 dark:text-neutral-200 dark:hover:text-primary-400"><div class=dark:hidden><span class="relative block icon"><svg viewBox="0 0 512 512"><path fill="currentColor" d="M32 256C32 132.2 132.3 32 255.8 32c11.36.0 29.7 1.668 40.9 3.746 9.616 1.777 11.75 14.63 3.279 19.44C245 86.5 211.2 144.6 211.2 207.8c0 109.7 99.71 193 208.3 172.3 9.561-1.805 16.28 9.324 10.11 16.95C387.9 448.6 324.8 480 255.8 480 132.1 480 32 379.6 32 256z"/></svg></span></div><div class="hidden dark:block"><span class="relative block icon"><svg viewBox="0 0 512 512"><path fill="currentColor" d="M256 159.1c-53.02.0-95.1 42.98-95.1 95.1s41.2 96.9 95.1 96.9 95.1-42.98 95.1-95.1S309 159.1 256 159.1zM509.3 347l-63.2-91.9 63.15-91.01c6.332-9.125 1.104-21.74-9.826-23.72l-109-19.7-19.7-109c-1.975-10.93-14.59-16.16-23.72-9.824L256 65.89 164.1 2.736c-9.125-6.332-21.74-1.107-23.72 9.824L121.6 121.6 12.56 141.3C1.633 143.2-3.596 155.9 2.736 164.1L65.89 256 2.74 347.01c-6.332 9.125-1.105 21.74 9.824 23.72l109 19.7 19.7 109c1.975 10.93 14.59 16.16 23.72 9.824L256 446.1l91.01 63.15c9.127 6.334 21.75 1.107 23.72-9.822l19.7-109 109-19.7C510.4 368.8 515.6 356.1 509.3 347zM256 383.1c-70.69.0-127.1-57.31-127.1-127.1.0-70.69 57.31-127.1 127.1-127.1S383.1 186.2 383.1 256c0 70.7-56.4 127.1-127.1 127.1z"/></svg></span></div></button>
<input type=checkbox id=mobile-menu-toggle autocomplete=off class="hidden peer">
<label for=mobile-menu-toggle class="flex items-center justify-center cursor-pointer bf-icon-color-hover"><span class="relative block icon"><svg viewBox="0 0 448 512"><path fill="currentColor" d="M0 96C0 78.33 14.33 64 32 64H416c17.7.0 32 14.33 32 32 0 17.7-14.3 32-32 32H32C14.33 128 0 113.7.0 96zM0 256c0-17.7 14.33-32 32-32H416c17.7.0 32 14.3 32 32s-14.3 32-32 32H32c-17.67.0-32-14.3-32-32zM416 448H32c-17.67.0-32-14.3-32-32s14.33-32 32-32H416c17.7.0 32 14.3 32 32s-14.3 32-32 32z"/></svg></span></label><div role=dialog aria-modal=true style=scrollbar-gutter:stable class="fixed inset-0 z-50 invisible overflow-y-auto px-6 py-20 opacity-0 transition-[opacity,visibility] duration-300 peer-checked:visible peer-checked:opacity-100 bg-neutral-50/97 dark:bg-neutral-900/99
bf-scrollbar"><label for=mobile-menu-toggle class="fixed end-8 top-5 flex items-center justify-center z-50 h-12 w-12 cursor-pointer select-none rounded-full bf-icon-color-hover border bf-border-color bf-border-color-hover bg-neutral-50 dark:bg-neutral-900"><span class="relative block icon"><svg viewBox="0 0 320 512"><path fill="currentColor" d="M310.6 361.4c12.5 12.5 12.5 32.75.0 45.25C304.4 412.9 296.2 416 288 416s-16.38-3.125-22.62-9.375L160 301.3 54.63 406.6C48.38 412.9 40.19 416 32 416S15.63 412.9 9.375 406.6c-12.5-12.5-12.5-32.75.0-45.25l105.4-105.4L9.375 150.6c-12.5-12.5-12.5-32.75.0-45.25s32.75-12.5 45.25.0L160 210.8l105.4-105.4c12.5-12.5 32.75-12.5 45.25.0s12.5 32.75.0 45.25l-105.4 105.4L310.6 361.4z"/></svg></span></label><nav class="mx-auto max-w-md space-y-6"><div class=px-2><a href=/posts/ aria-label="글 목록" class="flex items-center gap-4 group bf-icon-color-hover text-neutral-700 dark:text-neutral-200"><span title="글 목록" class="text-2xl font-bold tracking-tight">글 목록</span></a></div><div class=px-2><a href=/categories/ aria-label=카테고리 class="flex items-center gap-4 group bf-icon-color-hover text-neutral-700 dark:text-neutral-200"><span title=Categories class="text-2xl font-bold tracking-tight">카테고리</span></a></div><div class=px-2><a href=/tags/ aria-label=태그 class="flex items-center gap-4 group bf-icon-color-hover text-neutral-700 dark:text-neutral-200"><span title=Tags class="text-2xl font-bold tracking-tight">태그</span></a></div><div class=px-2><a href=/about/ aria-label=소개 class="flex items-center gap-4 group bf-icon-color-hover text-neutral-700 dark:text-neutral-200"><span title=소개 class="text-2xl font-bold tracking-tight">소개</span></a></div><div class="flex flex-wrap items-center [&_span]:text-2xl [&_.translation_button_.icon]:text-4xl! [&_.translation_button_span]:text-base! [&_.translation_.menuhide_span]:text-sm! gap-x-6 ps-2 mt-8 pt-8 border-t bf-border-color"><div class="translation nested-menu"><button class="cursor-pointer flex items-center">
<span class=me-1><span class="relative block icon"><svg viewBox="0 0 640 512"><path fill="currentColor" d="M0 128C0 92.7 28.7 64 64 64H256h48 16H576c35.3.0 64 28.7 64 64V384c0 35.3-28.7 64-64 64H320 304 256 64c-35.3.0-64-28.7-64-64V128zm320 0V384H576V128H320zM178.3 175.9c-3.2-7.2-10.4-11.9-18.3-11.9s-15.1 4.7-18.3 11.9l-64 144c-4.5 10.1.1 21.9 10.2 26.4s21.9-.1 26.4-10.2l8.9-20.1h73.6l8.9 20.1c4.5 10.1 16.3 14.6 26.4 10.2s14.6-16.3 10.2-26.4l-64-144zM160 233.2 179 276H141l19-42.8zM448 164c11 0 20 9 20 20v4h44 16c11 0 20 9 20 20s-9 20-20 20h-2l-1.6 4.5c-8.9 24.4-22.4 46.6-39.6 65.4.9.6 1.8 1.1 2.7 1.6l18.9 11.3c9.5 5.7 12.5 18 6.9 27.4s-18 12.5-27.4 6.9L467 333.8c-4.5-2.7-8.8-5.5-13.1-8.5-10.6 7.5-21.9 14-34 19.4l-3.6 1.6c-10.1 4.5-21.9-.1-26.4-10.2s.1-21.9 10.2-26.4l3.6-1.6c6.4-2.9 12.6-6.1 18.5-9.8L410 286.1c-7.8-7.8-7.8-20.5.0-28.3s20.5-7.8 28.3.0l14.6 14.6.5.5c12.4-13.1 22.5-28.3 29.8-45H448 376c-11 0-20-9-20-20s9-20 20-20h52v-4c0-11 9-20 20-20z"/></svg></span>
</span><span class="text-sm font-medium bf-icon-color-hover" title="Iceberg 테이블 모니터링 구축: Trino 메타테이블과 Prometheus Pushgateway">KO</span></button><ul class=menuhide><li class="rounded-xl backdrop-blur shadow-2xl p-2 flex flex-col gap-1"><a href=/posts/iceberg-table-monitoring/ class="flex items-center bf-icon-color-hover px-3 py-1"><span class="text-sm font-sm" title="Iceberg 테이블 모니터링 구축: Trino 메타테이블과 Prometheus Pushgateway">한국어
</span></a><a href=/en/posts/iceberg-table-monitoring/ class="flex items-center bf-icon-color-hover px-3 py-1"><span class="text-sm font-sm" title="Building Iceberg Table Monitoring with Trino Meta-Tables and Prometheus Pushgateway">English</span></a></li></ul></div></div></nav></div></div></div></div></div></div></div><script type=text/javascript src=/js/background-blur.min.605b3b942818f0ab5a717ae446135ec46b8ee5a2ad12ae56fb90dc2a76ce30c388f9fec8bcc18db15bd47e3fa8a09d779fa12aa9c184cf614a315bc72c6c163d.js integrity="sha512-YFs7lCgY8KtacXrkRhNexGuO5aKtEq5W+5DcKnbOMMOI+f7IvMGNsVvUfj+ooJ13n6EqqcGEz2FKMVvHLGwWPQ==" data-blur-id=menu-blur></script><div class="relative flex flex-col grow"><main id=main-content class=grow><article><header id=single_header class="mt-5 max-w-prose"><ol class="text-sm text-neutral-500 dark:text-neutral-400 print:hidden"><li class=hidden><a class="hover:underline decoration-neutral-300 dark:underline-neutral-600" href=/>nanta - 데이터 엔지니어링</a><span class="px-1 text-primary-500">/</span></li><li class=inline><a class="hover:underline decoration-neutral-300 dark:underline-neutral-600" href=/posts/>글 목록</a><span class="px-1 text-primary-500">/</span></li><li class=hidden><a class="hover:underline decoration-neutral-300 dark:underline-neutral-600" href=/posts/iceberg-table-monitoring/>Iceberg 테이블 모니터링 구축: Trino 메타테이블과 Prometheus Pushgateway</a><span class="px-1 text-primary-500">/</span></li></ol><h1 class="mt-0 text-4xl font-extrabold text-neutral-900 dark:text-neutral">Iceberg 테이블 모니터링 구축: Trino 메타테이블과 Prometheus Pushgateway</h1><div class="mt-1 mb-6 text-base text-neutral-500 dark:text-neutral-400 print:hidden"><div class="flex flex-row flex-wrap items-center"><time datetime=2026-02-27T00:00:00+00:00>2026년 2월 27일</time><span class="px-2 text-primary-500">&#183;</span><span title="읽는 시간">6 분</span></div></div><div class="flex author"><div class=place-self-center><div class="text-[0.6rem] uppercase leading-3 text-neutral-500 dark:text-neutral-400">작성자</div><div class="font-semibold leading-6 text-neutral-800 dark:text-neutral-300">nanta</div><div class="text-sm text-neutral-700 dark:text-neutral-400">Apache Kafka, Airflow, Trino, StarRocks 등 데이터 엔지니어링과 모던 데이터 인프라에 대한 실무 경험을 공유하는 블로그입니다.</div><div class="text-2xl sm:text-lg"><div class="flex flex-wrap text-neutral-400 dark:text-neutral-500"><a class="px-1 hover:text-primary-700 dark:hover:text-primary-400" href=https://github.com/NhoSW target=_blank aria-label=Github title=Github rel="me noopener noreferrer"><span class="inline-block align-text-bottom"><span class="relative block icon"><svg viewBox="0 0 496 512"><path fill="currentColor" d="M165.9 397.4c0 2-2.3 3.6-5.2 3.6-3.3.3-5.6-1.3-5.6-3.6.0-2 2.3-3.6 5.2-3.6 3-.3 5.6 1.3 5.6 3.6zm-31.1-4.5c-.7 2 1.3 4.3 4.3 4.9 2.6 1 5.6.0 6.2-2s-1.3-4.3-4.3-5.2c-2.6-.7-5.5.3-6.2 2.3zm44.2-1.7c-2.9.7-4.9 2.6-4.6 4.9.3 2 2.9 3.3 5.9 2.6 2.9-.7 4.9-2.6 4.6-4.6-.3-1.9-3-3.2-5.9-2.9zM244.8 8C106.1 8 0 113.3.0 252c0 110.9 69.8 205.8 169.5 239.2 12.8 2.3 17.3-5.6 17.3-12.1.0-6.2-.3-40.4-.3-61.4.0.0-70 15-84.7-29.8.0.0-11.4-29.1-27.8-36.6.0.0-22.9-15.7 1.6-15.4.0.0 24.9 2 38.6 25.8 21.9 38.6 58.6 27.5 72.9 20.9 2.3-16 8.8-27.1 16-33.7-55.9-6.2-112.3-14.3-112.3-110.5.0-27.5 7.6-41.3 23.6-58.9-2.6-6.5-11.1-33.3 2.6-67.9 20.9-6.5 69 27 69 27 20-5.6 41.5-8.5 62.8-8.5s42.8 2.9 62.8 8.5c0 0 48.1-33.6 69-27 13.7 34.7 5.2 61.4 2.6 67.9 16 17.7 25.8 31.5 25.8 58.9.0 96.5-58.9 104.2-114.8 110.5 9.2 7.9 17 22.9 17 46.4.0 33.7-.3 75.4-.3 83.6.0 6.5 4.6 14.4 17.3 12.1C428.2 457.8 496 362.9 496 252 496 113.3 383.5 8 244.8 8zM97.2 352.9c-1.3 1-1 3.3.7 5.2 1.6 1.6 3.9 2.3 5.2 1 1.3-1 1-3.3-.7-5.2-1.6-1.6-3.9-2.3-5.2-1zm-10.8-8.1c-.7 1.3.3 2.9 2.3 3.9 1.6 1 3.6.7 4.3-.7.7-1.3-.3-2.9-2.3-3.9-2-.6-3.6-.3-4.3.7zm32.4 35.6c-1.6 1.3-1 4.3 1.3 6.2 2.3 2.3 5.2 2.6 6.5 1 1.3-1.3.7-4.3-1.3-6.2-2.2-2.3-5.2-2.6-6.5-1zm-11.4-14.7c-1.6 1-1.6 3.6.0 5.9 1.6 2.3 4.3 3.3 5.6 2.3 1.6-1.3 1.6-3.9.0-6.2-1.4-2.3-4-3.3-5.6-2z"/></svg></span></span></a></div></div></div></div><div class=mb-5></div></header><section class="flex flex-col max-w-full mt-0 prose dark:prose-invert lg:flex-row"><div class="order-first lg:ms-auto px-0 lg:order-last lg:ps-8 lg:max-w-2xs"><div class="toc ps-5 print:hidden lg:sticky lg:top-[140px]"><details open id=TOCView class="toc-right mt-0 overflow-y-auto overscroll-contain bf-scrollbar rounded-lg -ms-5 ps-5 pe-2 hidden lg:block"><summary class="block py-1 text-lg font-semibold cursor-pointer bg-neutral-100 text-neutral-800 -ms-5 ps-5 dark:bg-neutral-700 dark:text-neutral-100 lg:hidden">목차</summary><div class="min-w-[220px] py-2 border-dotted border-s-1 -ms-5 ps-5 dark:border-neutral-600"><nav id=TableOfContents><ul><li><a href=#모니터링-대상>모니터링 대상</a></li><li><a href=#아키텍처-두-가지-접근>아키텍처: 두 가지 접근</a><ul><li><a href=#1안-grafana에서-trino-직접-조회>1안: Grafana에서 Trino 직접 조회</a></li><li><a href=#2안-prometheus-pushgateway-기반>2안: Prometheus Pushgateway 기반</a></li></ul></li><li><a href=#대시보드-구성>대시보드 구성</a><ul><li><a href=#전체-테이블-헬스-모니터링>전체 테이블 헬스 모니터링</a></li><li><a href=#특정-테이블-상세-탐색>특정 테이블 상세 탐색</a></li></ul></li><li><a href=#trino-메타테이블-버그와-체리피킹>Trino 메타테이블 버그와 체리피킹</a><ul><li><a href=#files-메타테이블의-delete-file-누락>$files 메타테이블의 delete file 누락</a></li><li><a href=#files-메타테이블에-partition-필드-없음>$files 메타테이블에 partition 필드 없음</a></li></ul></li><li><a href=#grafana-trino-플러그인의-한계>grafana-trino 플러그인의 한계</a></li><li><a href=#무거운-테이블의-메타-쿼리-성능>무거운 테이블의 메타 쿼리 성능</a><ul><li><a href=#spark-vs-trino-메타테이블-쿼리-성능>Spark vs Trino 메타테이블 쿼리 성능</a></li></ul></li><li><a href=#메트릭-파이프라인>메트릭 파이프라인</a><ul><li><a href=#pushgateway-배포>Pushgateway 배포</a></li><li><a href=#airflow-배치-파이프라인>Airflow 배치 파이프라인</a></li><li><a href=#iceberg-테이블-목록-자동-추출의-한계>Iceberg 테이블 목록 자동 추출의 한계</a></li></ul></li><li><a href=#delete-file-현황-파악>DELETE FILE 현황 파악</a></li><li><a href=#v451에서-v476까지-모니터링-관련-개선-사항>v451에서 v476까지: 모니터링 관련 개선 사항</a></li><li><a href=#배운-것>배운 것</a></li></ul></nav></div></details><details class="toc-inside mt-0 overflow-hidden rounded-lg -ms-5 ps-5 lg:hidden"><summary class="py-1 text-lg font-semibold cursor-pointer bg-neutral-100 text-neutral-800 -ms-5 ps-5 dark:bg-neutral-700 dark:text-neutral-100 lg:hidden">목차</summary><div class="py-2 border-dotted border-neutral-300 border-s-1 -ms-5 ps-5 dark:border-neutral-600"><nav id=TableOfContents><ul><li><a href=#모니터링-대상>모니터링 대상</a></li><li><a href=#아키텍처-두-가지-접근>아키텍처: 두 가지 접근</a><ul><li><a href=#1안-grafana에서-trino-직접-조회>1안: Grafana에서 Trino 직접 조회</a></li><li><a href=#2안-prometheus-pushgateway-기반>2안: Prometheus Pushgateway 기반</a></li></ul></li><li><a href=#대시보드-구성>대시보드 구성</a><ul><li><a href=#전체-테이블-헬스-모니터링>전체 테이블 헬스 모니터링</a></li><li><a href=#특정-테이블-상세-탐색>특정 테이블 상세 탐색</a></li></ul></li><li><a href=#trino-메타테이블-버그와-체리피킹>Trino 메타테이블 버그와 체리피킹</a><ul><li><a href=#files-메타테이블의-delete-file-누락>$files 메타테이블의 delete file 누락</a></li><li><a href=#files-메타테이블에-partition-필드-없음>$files 메타테이블에 partition 필드 없음</a></li></ul></li><li><a href=#grafana-trino-플러그인의-한계>grafana-trino 플러그인의 한계</a></li><li><a href=#무거운-테이블의-메타-쿼리-성능>무거운 테이블의 메타 쿼리 성능</a><ul><li><a href=#spark-vs-trino-메타테이블-쿼리-성능>Spark vs Trino 메타테이블 쿼리 성능</a></li></ul></li><li><a href=#메트릭-파이프라인>메트릭 파이프라인</a><ul><li><a href=#pushgateway-배포>Pushgateway 배포</a></li><li><a href=#airflow-배치-파이프라인>Airflow 배치 파이프라인</a></li><li><a href=#iceberg-테이블-목록-자동-추출의-한계>Iceberg 테이블 목록 자동 추출의 한계</a></li></ul></li><li><a href=#delete-file-현황-파악>DELETE FILE 현황 파악</a></li><li><a href=#v451에서-v476까지-모니터링-관련-개선-사항>v451에서 v476까지: 모니터링 관련 개선 사항</a></li><li><a href=#배운-것>배운 것</a></li></ul></nav></div></details></div></div><div class="min-w-0 min-h-0 max-w-fit"><div class="article-content max-w-prose mb-20"><p>Iceberg 테이블을 운영하다 보면 눈에 보이지 않는 곳에서 문제가 쌓인다. 작은 파일이 계속 늘어나는지, 컴팩션이 제대로 돌고 있는지, 특정 파티션에 데이터가 몰리고 있는지. 테이블 수가 적을 때는 수동으로 확인해도 되지만, 수십 개를 넘어가면 체계적인 모니터링이 필요하다.</p><p>카카오의 <a href=https://tech.kakao.com/posts/694 target=_blank rel=noreferrer>로그 유형별 Iceberg 테이블 적재 및 운영 전략</a> 글을 보고 본격적으로 모니터링 체계 구축에 착수했다.</p><hr><h2 class="relative group">모니터링 대상<div id=모니터링-대상 class=anchor></div><span class="absolute top-0 w-6 transition-opacity opacity-0 -start-6 not-prose group-hover:opacity-100 select-none"><a class="text-primary-300 dark:text-neutral-700 !no-underline" href=#%eb%aa%a8%eb%8b%88%ed%84%b0%eb%a7%81-%eb%8c%80%ec%83%81 aria-label=앵커>#</a></span></h2><p>Iceberg 메타테이블을 통해 확인해야 할 핵심 항목은 세 가지다.</p><ul><li><strong>작은 파일 증가 여부</strong>: 작은 파일이 계속 쌓이면 쿼리 성능이 떨어진다. 스캔해야 할 파일 수 자체가 늘어나기 때문이다.</li><li><strong>최적화 작업 상태</strong>: 컴팩션이 정상적으로 수행되고 있는지. 파일 수와 평균 파일 크기의 추이를 보면 알 수 있다.</li><li><strong>파티션 분포</strong>: 특정 파티션에 데이터가 몰리는 현상이 있는지. 파티션별 파일 수와 크기를 비교하면 확인할 수 있다.</li></ul><p>최신 스냅샷이 참조하는 데이터 파일의 개수, 평균 크기, 파티션별 분포를 주기적으로 수집하면 이 항목들을 모두 커버할 수 있다.</p><hr><h2 class="relative group">아키텍처: 두 가지 접근<div id=아키텍처-두-가지-접근 class=anchor></div><span class="absolute top-0 w-6 transition-opacity opacity-0 -start-6 not-prose group-hover:opacity-100 select-none"><a class="text-primary-300 dark:text-neutral-700 !no-underline" href=#%ec%95%84%ed%82%a4%ed%85%8d%ec%b2%98-%eb%91%90-%ea%b0%80%ec%a7%80-%ec%a0%91%ea%b7%bc aria-label=앵커>#</a></span></h2><p>모니터링 데이터 소스를 어떻게 구성할지 두 가지 방안을 검토했다.</p><h3 class="relative group">1안: Grafana에서 Trino 직접 조회<div id=1안-grafana에서-trino-직접-조회 class=anchor></div><span class="absolute top-0 w-6 transition-opacity opacity-0 -start-6 not-prose group-hover:opacity-100 select-none"><a class="text-primary-300 dark:text-neutral-700 !no-underline" href=#1%ec%95%88-grafana%ec%97%90%ec%84%9c-trino-%ec%a7%81%ec%a0%91-%ec%a1%b0%ed%9a%8c aria-label=앵커>#</a></span></h3><p>Grafana에 Trino 데이터소스를 연결하고 대시보드 조회 시마다 메타테이블 쿼리를 직접 제출하는 방식이다.</p><p>장점은 구현이 간단하다는 거다. 단점이 많았다.</p><ul><li>대시보드를 열 때마다 Trino에 쿼리가 제출된다. 거의 같은 결과를 매번 다시 계산하는 셈이다.</li><li>무거운 테이블의 메타 쿼리는 수 분이 걸린다. 대시보드 로딩이 실용적이지 않다.</li><li>Trino 자체의 제약으로 메트릭 계산 로직을 커스터마이징하기 어렵다.</li><li>Grafana의 Trino 플러그인이 ROW 타입 같은 nested type을 인식하지 못한다.</li></ul><h3 class="relative group">2안: Prometheus Pushgateway 기반<div id=2안-prometheus-pushgateway-기반 class=anchor></div><span class="absolute top-0 w-6 transition-opacity opacity-0 -start-6 not-prose group-hover:opacity-100 select-none"><a class="text-primary-300 dark:text-neutral-700 !no-underline" href=#2%ec%95%88-prometheus-pushgateway-%ea%b8%b0%eb%b0%98 aria-label=앵커>#</a></span></h3><p>카카오의 사례처럼 Prometheus Pushgateway를 통해 간접 연동하는 방식이다. 메타테이블 쿼리를 배치로 실행하고 결과를 Pushgateway에 밀어넣으면 Prometheus가 주기적으로 가져간다.</p><p>장점이 확실했다.</p><ul><li>Trino에 대한 불필요한 중복 쿼리가 없다.</li><li>메트릭 계산 로직을 자유롭게 커스터마이징할 수 있다.</li><li>Trino의 제약을 우회하기 위해 Spark를 쓰거나 Glue Catalog API를 직접 활용할 수도 있다.</li><li>Airflow의 컴팩션 작업 후행으로 메트릭 푸시를 붙이면 자연스럽게 파이프라인이 구성된다.</li></ul><p>결론은 1안으로 빠르게 시작하되 2안으로 점진적으로 전환하는 방향이었다. 최종적으로 두 가지를 병행해서 용도에 따라 사용한다.</p><hr><h2 class="relative group">대시보드 구성<div id=대시보드-구성 class=anchor></div><span class="absolute top-0 w-6 transition-opacity opacity-0 -start-6 not-prose group-hover:opacity-100 select-none"><a class="text-primary-300 dark:text-neutral-700 !no-underline" href=#%eb%8c%80%ec%8b%9c%eb%b3%b4%eb%93%9c-%ea%b5%ac%ec%84%b1 aria-label=앵커>#</a></span></h2><h3 class="relative group">전체 테이블 헬스 모니터링<div id=전체-테이블-헬스-모니터링 class=anchor></div><span class="absolute top-0 w-6 transition-opacity opacity-0 -start-6 not-prose group-hover:opacity-100 select-none"><a class="text-primary-300 dark:text-neutral-700 !no-underline" href=#%ec%a0%84%ec%b2%b4-%ed%85%8c%ec%9d%b4%eb%b8%94-%ed%97%ac%ec%8a%a4-%eb%aa%a8%eb%8b%88%ed%84%b0%eb%a7%81 aria-label=앵커>#</a></span></h3><p>Pushgateway 기반 대시보드다. 모든 Iceberg 테이블의 상태를 시간 흐름에 따라 추적한다.</p><p><code>$files</code> 메타테이블은 가장 최신 스냅샷이 참조하는 파일만 보여준다. 과거 스냅샷의 파일 정보까지 포함한 히스토리는 제공하지 않는다. 하지만 메타테이블 쿼리 결과를 주기적으로 Pushgateway에 밀어넣고 Prometheus에서 가져가면, 특정 시점의 스냅샷 상태가 시계열 메트릭으로 쌓인다. 시간에 따른 변동 추이를 볼 수 있게 되는 거다.</p><p>테이블 수가 많아지면 각 테이블의 지표 스케일이 달라서 한 화면에서 직관적으로 보기 어렵다. 정규식 텍스트 검색 옵션을 추가해서 특정 테이블만 필터링할 수 있도록 했다.</p><h3 class="relative group">특정 테이블 상세 탐색<div id=특정-테이블-상세-탐색 class=anchor></div><span class="absolute top-0 w-6 transition-opacity opacity-0 -start-6 not-prose group-hover:opacity-100 select-none"><a class="text-primary-300 dark:text-neutral-700 !no-underline" href=#%ed%8a%b9%ec%a0%95-%ed%85%8c%ec%9d%b4%eb%b8%94-%ec%83%81%ec%84%b8-%ed%83%90%ec%83%89 aria-label=앵커>#</a></span></h3><p>Grafana의 Trino 데이터소스를 직접 활용하는 대시보드다. 특정 테이블을 선택하면 현 시점 기준으로 <code>$partitions</code> 메타테이블을 조회해서 각 날짜 파티션의 파일 수와 파일 크기를 보여준다.</p><p>전체 테이블 대시보드는 시간 흐름에 따른 추이를 보는 용도고, 이 대시보드는 특정 시점의 파티션별 분포를 보는 용도다.</p><hr><h2 class="relative group">Trino 메타테이블 버그와 체리피킹<div id=trino-메타테이블-버그와-체리피킹 class=anchor></div><span class="absolute top-0 w-6 transition-opacity opacity-0 -start-6 not-prose group-hover:opacity-100 select-none"><a class="text-primary-300 dark:text-neutral-700 !no-underline" href=#trino-%eb%a9%94%ed%83%80%ed%85%8c%ec%9d%b4%eb%b8%94-%eb%b2%84%ea%b7%b8%ec%99%80-%ec%b2%b4%eb%a6%ac%ed%94%bc%ed%82%b9 aria-label=앵커>#</a></span></h2><p>모니터링 구축 당시 Trino v451을 운영하고 있었다. 두 가지 문제를 발견해서 상위 버전의 픽스를 체리피킹했다. 이후 v476으로 업그레이드하면서 이 픽스들은 자연스럽게 포함됐다.</p><h3 class="relative group">$files 메타테이블의 delete file 누락<div id=files-메타테이블의-delete-file-누락 class=anchor></div><span class="absolute top-0 w-6 transition-opacity opacity-0 -start-6 not-prose group-hover:opacity-100 select-none"><a class="text-primary-300 dark:text-neutral-700 !no-underline" href=#files-%eb%a9%94%ed%83%80%ed%85%8c%ec%9d%b4%eb%b8%94%ec%9d%98-delete-file-%eb%88%84%eb%9d%bd aria-label=앵커>#</a></span></h3><p>Iceberg v2의 delete file(positional, equality)을 <code>$files</code> 메타테이블이 인식하지 못하는 버그가 있었다. v455에서 수정됐다. 포크 레포의 stage 브랜치에 해당 커밋을 체리피킹해서 적용했고, 정상적으로 delete file 통계가 조회되는 것을 확인했다.</p><h3 class="relative group">$files 메타테이블에 partition 필드 없음<div id=files-메타테이블에-partition-필드-없음 class=anchor></div><span class="absolute top-0 w-6 transition-opacity opacity-0 -start-6 not-prose group-hover:opacity-100 select-none"><a class="text-primary-300 dark:text-neutral-700 !no-underline" href=#files-%eb%a9%94%ed%83%80%ed%85%8c%ec%9d%b4%eb%b8%94%ec%97%90-partition-%ed%95%84%eb%93%9c-%ec%97%86%ec%9d%8c aria-label=앵커>#</a></span></h3><p>v451까지는 <code>$files</code> 메타테이블에 각 파일이 속한 파티션 정보가 없었다. 파티션별 파일 통계를 수집하려면 이 필드가 필수적이다. v465에서 <code>partition</code>, <code>spec_id</code>, <code>sort_order_id</code>, <code>readable_metrics</code> 컬럼이 추가됐다. 이것도 체리피킹해서 적용했다.</p><hr><h2 class="relative group">grafana-trino 플러그인의 한계<div id=grafana-trino-플러그인의-한계 class=anchor></div><span class="absolute top-0 w-6 transition-opacity opacity-0 -start-6 not-prose group-hover:opacity-100 select-none"><a class="text-primary-300 dark:text-neutral-700 !no-underline" href=#grafana-trino-%ed%94%8c%eb%9f%ac%ea%b7%b8%ec%9d%b8%ec%9d%98-%ed%95%9c%ea%b3%84 aria-label=앵커>#</a></span></h2><p>Grafana의 Trino 플러그인은 nested type과 ROW 타입 필드를 인식하지 못한다. <code>$partitions</code> 메타테이블의 ROW 타입 <code>partition</code> 필드가 대표적인 예다. <code>partition.log_ts_day</code>처럼 명시적으로 지정해줘야 한다.</p><p>이 때문에 시간 파티션 외에 추가 파티션이 있는 테이블이나 day 단위가 아닌 파티션을 가진 테이블을 범용적으로 커버하기 어렵다. 플러그인 자체의 근본적인 제약이다.</p><hr><h2 class="relative group">무거운 테이블의 메타 쿼리 성능<div id=무거운-테이블의-메타-쿼리-성능 class=anchor></div><span class="absolute top-0 w-6 transition-opacity opacity-0 -start-6 not-prose group-hover:opacity-100 select-none"><a class="text-primary-300 dark:text-neutral-700 !no-underline" href=#%eb%ac%b4%ea%b1%b0%ec%9a%b4-%ed%85%8c%ec%9d%b4%eb%b8%94%ec%9d%98-%eb%a9%94%ed%83%80-%ec%bf%bc%eb%a6%ac-%ec%84%b1%eb%8a%a5 aria-label=앵커>#</a></span></h2><p>앱 로그나 웹 로그 같은 대용량 테이블의 메타테이블 쿼리는 매우 느렸다. 현업 적용이 불가능할 정도였다. 해당 테이블들은 모니터링 대상에서 일단 제외했다.</p><p>이 테이블들은 규모도 크지만 <code>rewrite_manifests()</code> 최적화가 제대로 수행되지 않고 있는 상태이기도 했다. 매니페스트 최적화가 되면 스캔 플래닝이 빨라져서 메타 쿼리 성능도 개선될 것으로 기대했다. 그런데 <code>rewrite_manifests()</code>를 정상화해도 메타 쿼리 성능에 유의미한 개선은 없었다.</p><h3 class="relative group">Spark vs Trino 메타테이블 쿼리 성능<div id=spark-vs-trino-메타테이블-쿼리-성능 class=anchor></div><span class="absolute top-0 w-6 transition-opacity opacity-0 -start-6 not-prose group-hover:opacity-100 select-none"><a class="text-primary-300 dark:text-neutral-700 !no-underline" href=#spark-vs-trino-%eb%a9%94%ed%83%80%ed%85%8c%ec%9d%b4%eb%b8%94-%ec%bf%bc%eb%a6%ac-%ec%84%b1%eb%8a%a5 aria-label=앵커>#</a></span></h3><p>Spark의 메타테이블 쿼리 성능이 Trino보다 월등히 좋다. 특히 무거운 테이블일수록 차이가 크다.</p><p>이유가 있다. Spark는 iceberg-core의 Table API를 통해 Snapshot에서 ManifestList로 필요한 DataFile만 조립한다. Trino는 메타데이터 파일들을 읽고 JOIN하는 방식이라 스캔 오버헤드가 크다.</p><p>배치성으로 Pushgateway에 메트릭을 밀어넣는 구성이라면 Trino 대신 Spark 엔진을 사용하는 것도 방법이다. Spark는 <code>all_files</code> 같은 메타테이블도 추가로 제공하니까 활용 범위가 더 넓다.</p><hr><h2 class="relative group">메트릭 파이프라인<div id=메트릭-파이프라인 class=anchor></div><span class="absolute top-0 w-6 transition-opacity opacity-0 -start-6 not-prose group-hover:opacity-100 select-none"><a class="text-primary-300 dark:text-neutral-700 !no-underline" href=#%eb%a9%94%ed%8a%b8%eb%a6%ad-%ed%8c%8c%ec%9d%b4%ed%94%84%eb%9d%bc%ec%9d%b8 aria-label=앵커>#</a></span></h2><h3 class="relative group">Pushgateway 배포<div id=pushgateway-배포 class=anchor></div><span class="absolute top-0 w-6 transition-opacity opacity-0 -start-6 not-prose group-hover:opacity-100 select-none"><a class="text-primary-300 dark:text-neutral-700 !no-underline" href=#pushgateway-%eb%b0%b0%ed%8f%ac aria-label=앵커>#</a></span></h3><p>Prometheus Pushgateway를 Helm 차트로 EKS에 배포했다. Prometheus 서버에 Pushgateway 스크래퍼를 추가해서 메트릭을 수집하도록 구성했다.</p><h3 class="relative group">Airflow 배치 파이프라인<div id=airflow-배치-파이프라인 class=anchor></div><span class="absolute top-0 w-6 transition-opacity opacity-0 -start-6 not-prose group-hover:opacity-100 select-none"><a class="text-primary-300 dark:text-neutral-700 !no-underline" href=#airflow-%eb%b0%b0%ec%b9%98-%ed%8c%8c%ec%9d%b4%ed%94%84%eb%9d%bc%ec%9d%b8 aria-label=앵커>#</a></span></h3><p>Airflow DAG으로 Iceberg 테이블 메트릭 푸시 파이프라인을 구성했다.</p><ol><li><strong>대상 테이블 추출</strong>: Glue API를 통해 Iceberg 포맷 테이블을 자동 추출한다. temp 스키마의 사용자 테이블은 제외하기 위해 스캔 대상 스키마 목록은 DAG 코드에서 관리한다.</li><li><strong>Dynamic task mapping</strong>: 추출된 각 테이블에 대해 메타 쿼리를 수행하고 메트릭을 Pushgateway에 푸시하는 태스크가 동적으로 생성된다.</li><li><strong>메트릭 정의</strong>: <code>iceberg_data_file_count</code> 같은 메트릭을 <code>env</code>, <code>partition</code>, <code>table</code> 라벨로 구분해서 수집한다.</li></ol><p>컴팩션 작업의 후행으로 메트릭 푸시 로직을 붙이는 것도 가능하다. 기존 컴팩션 태스크 그룹 구현체에 후행 로직을 추가하는 방식이다.</p><h3 class="relative group">Iceberg 테이블 목록 자동 추출의 한계<div id=iceberg-테이블-목록-자동-추출의-한계 class=anchor></div><span class="absolute top-0 w-6 transition-opacity opacity-0 -start-6 not-prose group-hover:opacity-100 select-none"><a class="text-primary-300 dark:text-neutral-700 !no-underline" href=#iceberg-%ed%85%8c%ec%9d%b4%eb%b8%94-%eb%aa%a9%eb%a1%9d-%ec%9e%90%eb%8f%99-%ec%b6%94%ec%b6%9c%ec%9d%98-%ed%95%9c%ea%b3%84 aria-label=앵커>#</a></span></h3><p>모니터링 구축 초기(v451)에는 Trino에서 특정 스키마 내 Iceberg 포맷 테이블만 선별하는 것이 불가능했다. <code>SHOW TABLES</code> 쿼리나 <code>information_schema.tables</code> 조회 모두 Glue Catalog에 등록된 모든 테이블을 가져왔다. 테이블 리디렉션 비활성화 상태에서도 마찬가지였다. 그래서 Glue API를 통해 Iceberg 테이블을 추출하는 방식을 택했다.</p><p>v475에 추가된 <code>system.iceberg_tables</code> 테이블을 쓰면 Iceberg 테이블만 리스팅할 수 있다. 현재 운영 중인 v476에서 사용 가능하다.</p><hr><h2 class="relative group">DELETE FILE 현황 파악<div id=delete-file-현황-파악 class=anchor></div><span class="absolute top-0 w-6 transition-opacity opacity-0 -start-6 not-prose group-hover:opacity-100 select-none"><a class="text-primary-300 dark:text-neutral-700 !no-underline" href=#delete-file-%ed%98%84%ed%99%a9-%ed%8c%8c%ec%95%85 aria-label=앵커>#</a></span></h2><p>모니터링 구축 과정에서 CDC 테이블들의 delete file 생성 현황도 파악했다.</p><p>대부분의 CDC 싱크 테이블은 소스 RDB 자체가 히스토리성 테이블이라 사실상 append-only로 쌓이고 있다. 기존 레코드의 update가 드물게 발생하고 후행 컴팩션으로 정리되므로 delete file은 거의 쌓이지 않는다.</p><p>다만 직전에 추가된 레코드에 대해 바로 update/delete가 발생하는 일부 테이블에서는 positional delete file도 생성되고 있었다. 이런 테이블은 컴팩션 주기나 전략을 따로 검토할 필요가 있다.</p><hr><h2 class="relative group">v451에서 v476까지: 모니터링 관련 개선 사항<div id=v451에서-v476까지-모니터링-관련-개선-사항 class=anchor></div><span class="absolute top-0 w-6 transition-opacity opacity-0 -start-6 not-prose group-hover:opacity-100 select-none"><a class="text-primary-300 dark:text-neutral-700 !no-underline" href=#v451%ec%97%90%ec%84%9c-v476%ea%b9%8c%ec%a7%80-%eb%aa%a8%eb%8b%88%ed%84%b0%eb%a7%81-%ea%b4%80%eb%a0%a8-%ea%b0%9c%ec%84%a0-%ec%82%ac%ed%95%ad aria-label=앵커>#</a></span></h2><p>모니터링 구축은 v451에서 시작했고, 이후 v476으로 업그레이드했다. 그 사이에 Iceberg 모니터링에 직접적으로 도움이 되는 개선 사항이 많았다.</p><table><thead><tr><th>버전</th><th>개선 내용</th><th>적용 방식</th></tr></thead><tbody><tr><td>v455</td><td><code>$files</code> 메타테이블에서 delete file 인식 버그 수정</td><td>v451에 체리피킹</td></tr><tr><td>v465</td><td><code>$files</code> 메타테이블에 <code>partition</code> 필드 추가</td><td>v451에 체리피킹</td></tr><tr><td>v466</td><td>Glue Catalog 조회 병렬화로 성능 개선</td><td>v476 업그레이드 시 반영</td></tr><tr><td>v469</td><td><code>$all_entries</code> 메타테이블 추가 (Spark의 <code>all_entries</code>에 대응)</td><td>v476 업그레이드 시 반영</td></tr><tr><td>v470</td><td><code>$all_entries</code> 버그 수정, <code>optimize_manifests</code> 프로시저 추가</td><td>v476 업그레이드 시 반영</td></tr><tr><td>v475</td><td><code>system.iceberg_tables</code> 테이블 추가 (Iceberg 테이블만 리스팅)</td><td>v476 업그레이드 시 반영</td></tr></tbody></table><p>v455와 v465는 모니터링 구축에 필수적이어서 v451 시절에 체리피킹으로 먼저 적용했다. 나머지는 v476 업그레이드와 함께 자연스럽게 사용 가능해졌다.</p><hr><h2 class="relative group">배운 것<div id=배운-것 class=anchor></div><span class="absolute top-0 w-6 transition-opacity opacity-0 -start-6 not-prose group-hover:opacity-100 select-none"><a class="text-primary-300 dark:text-neutral-700 !no-underline" href=#%eb%b0%b0%ec%9a%b4-%ea%b2%83 aria-label=앵커>#</a></span></h2><p><strong>메타테이블의 한계를 이해해야 한다.</strong> <code>$files</code>는 최신 스냅샷만 보여준다. 히스토리를 보려면 주기적으로 결과를 외부에 저장하는 방법밖에 없다. Pushgateway가 딱 맞는 구성이다.</p><p><strong>Trino의 메타 쿼리는 무거운 테이블에서 느리다.</strong> Spark가 훨씬 빠르다. 구현 방식 차이 때문이다. 배치 파이프라인이라면 Spark를 쓰는 것도 합리적이다.</p><p><strong>직접 조회와 배치 수집을 병행하자.</strong> 전체 테이블 추이는 Pushgateway 기반 배치로, 특정 테이블 심층 분석은 직접 쿼리로. 두 가지를 용도에 맞게 나누니까 효과적이었다.</p><p><strong>Trino 포크를 운영한다면 체리피킹은 피할 수 없다.</strong> 필요한 버그 수정이 상위 버전에만 있으면 가져와서 적용해야 한다. 특히 모니터링처럼 신뢰성이 중요한 영역에서는 부정확한 데이터가 더 위험하다.</p><p><strong>참고 자료:</strong></p><ul><li><a href=https://tech.kakao.com/posts/694 target=_blank rel=noreferrer>로그 유형별 Iceberg 테이블 적재 및 운영 전략 - kakao tech</a></li><li><a href=https://trino.io/docs/current/connector/iceberg.html target=_blank rel=noreferrer>Iceberg Connector - Trino Documentation</a></li><li><a href=https://github.com/trinodb/trino/pull/23142 target=_blank rel=noreferrer>$files delete file bug fix (v455)</a></li><li><a href=https://github.com/trinodb/trino/pull/24102 target=_blank rel=noreferrer>$files partition field (v465)</a></li><li><a href=https://github.com/trinodb/trino/pull/24110 target=_blank rel=noreferrer>Glue catalog query parallelization (v466)</a></li><li><a href=https://github.com/trinodb/trino/pull/24543 target=_blank rel=noreferrer>$all_entries metadata table (v469)</a></li><li><a href=https://github.com/trinodb/trino/pull/24678 target=_blank rel=noreferrer>optimize_manifests procedure (v470)</a></li><li><a href=https://github.com/trinodb/trino/pull/25136 target=_blank rel=noreferrer>system.iceberg_tables (v475)</a></li><li><a href=https://github.com/prometheus/pushgateway target=_blank rel=noreferrer>Prometheus Pushgateway</a></li><li><a href=https://github.com/trinodb/grafana-trino target=_blank rel=noreferrer>grafana-trino plugin</a></li></ul></div><section class="flex flex-row flex-wrap justify-center pt-4 text-xl"><a target=_blank class="m-1 rounded bg-neutral-300 p-1.5 text-neutral-700 hover:bg-primary-500 hover:text-neutral dark:bg-neutral-700 dark:text-neutral-300 dark:hover:bg-primary-400 dark:hover:text-neutral-800" href="https://www.linkedin.com/shareArticle?mini=true&amp;url=https://nanta-data.dev/posts/iceberg-table-monitoring/&amp;title=Iceberg%20%ed%85%8c%ec%9d%b4%eb%b8%94%20%eb%aa%a8%eb%8b%88%ed%84%b0%eb%a7%81%20%ea%b5%ac%ec%b6%95:%20Trino%20%eb%a9%94%ed%83%80%ed%85%8c%ec%9d%b4%eb%b8%94%ea%b3%bc%20Prometheus%20Pushgateway" title="LinkedIn에서 공유" aria-label="LinkedIn에서 공유"><span class="relative block icon"><svg viewBox="0 0 448 512"><path fill="currentColor" d="M416 32H31.9C14.3 32 0 46.5.0 64.3v383.4C0 465.5 14.3 480 31.9 480H416c17.6.0 32-14.5 32-32.3V64.3c0-17.8-14.4-32.3-32-32.3zM135.4 416H69V202.2h66.5V416zm-33.2-243c-21.3.0-38.5-17.3-38.5-38.5S80.9 96 102.2 96c21.2.0 38.5 17.3 38.5 38.5.0 21.3-17.2 38.5-38.5 38.5zm282.1 243h-66.4V312c0-24.8-.5-56.7-34.5-56.7-34.6.0-39.9 27-39.9 54.9V416h-66.4V202.2h63.7v29.2h.9c8.9-16.8 30.6-34.5 62.9-34.5 67.2.0 79.7 44.3 79.7 101.9V416z"/></svg>
</span></a><a target=_blank class="m-1 rounded bg-neutral-300 p-1.5 text-neutral-700 hover:bg-primary-500 hover:text-neutral dark:bg-neutral-700 dark:text-neutral-300 dark:hover:bg-primary-400 dark:hover:text-neutral-800" href="https://reddit.com/submit/?url=https://nanta-data.dev/posts/iceberg-table-monitoring/&amp;resubmit=true&amp;title=Iceberg%20%ed%85%8c%ec%9d%b4%eb%b8%94%20%eb%aa%a8%eb%8b%88%ed%84%b0%eb%a7%81%20%ea%b5%ac%ec%b6%95:%20Trino%20%eb%a9%94%ed%83%80%ed%85%8c%ec%9d%b4%eb%b8%94%ea%b3%bc%20Prometheus%20Pushgateway" title="Reddit에 게시" aria-label="Reddit에 게시"><span class="relative block icon"><svg viewBox="0 0 512 512"><path fill="currentColor" d="M201.5 305.5c-13.8.0-24.9-11.1-24.9-24.6.0-13.8 11.1-24.9 24.9-24.9 13.6.0 24.6 11.1 24.6 24.9.0 13.6-11.1 24.6-24.6 24.6zM504 256c0 137-111 248-248 248S8 393 8 256 119 8 256 8s248 111 248 248zm-132.3-41.2c-9.4.0-17.7 3.9-23.8 10-22.4-15.5-52.6-25.5-86.1-26.6l17.4-78.3 55.4 12.5c0 13.6 11.1 24.6 24.6 24.6 13.8.0 24.9-11.3 24.9-24.9s-11.1-24.9-24.9-24.9c-9.7.0-18 5.8-22.1 13.8l-61.2-13.6c-3-.8-6.1 1.4-6.9 4.4l-19.1 86.4c-33.2 1.4-63.1 11.3-85.5 26.8-6.1-6.4-14.7-10.2-24.1-10.2-34.9.0-46.3 46.9-14.4 62.8-1.1 5-1.7 10.2-1.7 15.5.0 52.6 59.2 95.2 132 95.2 73.1.0 132.3-42.6 132.3-95.2.0-5.3-.6-10.8-1.9-15.8 31.3-16 19.8-62.5-14.9-62.5zM302.8 331c-18.2 18.2-76.1 17.9-93.6.0-2.2-2.2-6.1-2.2-8.3.0-2.5 2.5-2.5 6.4.0 8.6 22.8 22.8 87.3 22.8 110.2.0 2.5-2.2 2.5-6.1.0-8.6-2.2-2.2-6.1-2.2-8.3.0zm7.7-75c-13.6.0-24.6 11.1-24.6 24.9.0 13.6 11.1 24.6 24.6 24.6 13.8.0 24.9-11.1 24.9-24.6.0-13.8-11-24.9-24.9-24.9z"/></svg>
</span></a><a target=_blank class="m-1 rounded bg-neutral-300 p-1.5 text-neutral-700 hover:bg-primary-500 hover:text-neutral dark:bg-neutral-700 dark:text-neutral-300 dark:hover:bg-primary-400 dark:hover:text-neutral-800" href="mailto:?body=https://nanta-data.dev/posts/iceberg-table-monitoring/&amp;subject=Iceberg%20%ed%85%8c%ec%9d%b4%eb%b8%94%20%eb%aa%a8%eb%8b%88%ed%84%b0%eb%a7%81%20%ea%b5%ac%ec%b6%95:%20Trino%20%eb%a9%94%ed%83%80%ed%85%8c%ec%9d%b4%eb%b8%94%ea%b3%bc%20Prometheus%20Pushgateway" title="이메일로 전송" aria-label="이메일로 전송"><span class="relative block icon"><svg viewBox="0 0 512 512"><path fill="currentColor" d="M207.8 20.73c-93.45 18.32-168.7 93.66-187 187.1-27.64 140.9 68.65 266.2 199.1 285.1 19.01 2.888 36.17-12.26 36.17-31.49l1e-4-.6631c0-15.74-11.44-28.88-26.84-31.24-84.35-12.98-149.2-86.13-149.2-174.2.0-102.9 88.61-185.5 193.4-175.4 91.54 8.869 158.6 91.25 158.6 183.2v16.16c0 22.09-17.94 40.05-40 40.05s-40.01-17.96-40.01-40.05v-120.1c0-8.847-7.161-16.02-16.01-16.02l-31.98.0036c-7.299.0-13.2 4.992-15.12 11.68-24.85-12.15-54.24-16.38-86.06-5.106-38.75 13.73-68.12 48.91-73.72 89.64-9.483 69.01 43.81 128 110.9 128 26.44.0 50.43-9.544 69.59-24.88 24 31.3 65.23 48.69 109.4 37.49C465.2 369.3 496 324.1 495.1 277.2V256.3c0-149.2-133.9-265.632-287.3-235.57zM239.1 304.3c-26.47.0-48-21.56-48-48.05s21.53-48.05 48-48.05 48 21.56 48 48.05-20.6 48.05-48 48.05z"/></svg></span></a></section></div></section><footer class="pt-8 max-w-prose print:hidden"><div class=pt-8><hr class="border-dotted border-neutral-300 dark:border-neutral-600"><div class="flex justify-between pt-3"><span class="flex flex-col"><a class="flex text-neutral-700 hover:text-primary-600 dark:text-neutral dark:hover:text-primary-400" href=/posts/kafka-rack-awareness-spark/><span class=leading-6><span class="inline-block rtl:rotate-180">&larr;</span>&ensp;Kafka Rack Awareness와 Spark: 현재 지원하지 않는다
</span></a><span class="ms-6 mt-1 text-xs text-neutral-500 dark:text-neutral-400"><time datetime=2026-02-27T00:00:00+00:00>2026년 2월 27일</time>
</span></span><span class="flex flex-col items-end"><a class="flex text-right text-neutral-700 hover:text-primary-600 dark:text-neutral dark:hover:text-primary-400" href=/posts/emr-on-eks-vpa-review/><span class=leading-6>EMR on EKS VPA 검토기: AWS 공식 기능이 동작하지 않을 때&ensp;<span class="inline-block rtl:rotate-180">&rarr;</span>
</span></a><span class="me-6 mt-1 text-xs text-neutral-500 dark:text-neutral-400"><time datetime=2026-02-27T00:00:00+00:00>2026년 2월 27일</time></span></span></div></div></footer></article><div id=scroll-to-top class="fixed bottom-6 end-6 z-50 transform translate-y-4 opacity-0 duration-200"><a href=#the-top class="pointer-events-auto flex h-12 w-12 items-center justify-center rounded-full bg-neutral/50 text-xl text-neutral-700 hover:text-primary-600 dark:bg-neutral-800/50 dark:text-neutral dark:hover:text-primary-400" aria-label="맨 위로 스크롤" title="맨 위로 스크롤">&uarr;</a></div></main><footer id=site-footer class="py-10 print:hidden"><div class="flex items-center justify-between text-sm text-neutral-500 dark:text-neutral-400"><nav><ul class="flex list-none flex-row"><li class="me-4 last:me-0"><a class="decoration-primary-500 hover:underline hover:decoration-2 hover:underline-offset-2 flex items-center" href=/privacy-policy/ title=개인정보처리방침>개인정보처리방침</a></li></ul></nav><p>&copy;
2026
nanta</p></div><script>mediumZoom(document.querySelectorAll("img:not(.nozoom)"),{margin:24,background:"rgba(0,0,0,0.5)",scrollOffset:0})</script></footer><div id=search-wrapper class="invisible fixed inset-0 flex h-screen w-screen cursor-default flex-col bg-neutral-500/50 p-4 backdrop-blur-sm dark:bg-neutral-900/50 sm:p-6 md:p-[10vh] lg:p-[12vh] z-500" data-url=https://nanta-data.dev/><div id=search-modal class="flex flex-col w-full max-w-3xl min-h-0 mx-auto border rounded-md shadow-lg top-20 border-neutral-200 bg-neutral dark:border-neutral-700 dark:bg-neutral-800"><header class="relative z-10 flex items-center justify-between flex-none px-2"><form class="flex items-center flex-auto min-w-0"><div class="flex items-center justify-center w-8 h-8 text-neutral-400"><span class="relative block icon"><svg aria-hidden="true" focusable="false" data-prefix="fas" data-icon="search" class="svg-inline--fa fa-search fa-w-16" role="img" viewBox="0 0 512 512"><path fill="currentColor" d="M505 442.7 405.3 343c-4.5-4.5-10.6-7-17-7H372c27.6-35.3 44-79.7 44-128C416 93.1 322.9.0 208 0S0 93.1.0 208s93.1 208 208 208c48.3.0 92.7-16.4 128-44v16.3c0 6.4 2.5 12.5 7 17l99.7 99.7c9.4 9.4 24.6 9.4 33.9.0l28.3-28.3c9.4-9.4 9.4-24.6.1-34zM208 336c-70.7.0-128-57.2-128-128 0-70.7 57.2-128 128-128 70.7.0 128 57.2 128 128 0 70.7-57.2 128-128 128z"/></svg></span></div><input type=search id=search-query class="flex flex-auto h-12 mx-1 bg-transparent appearance-none focus:outline-dotted focus:outline-2 focus:outline-transparent" placeholder=검색 tabindex=0></form><button id=close-search-button class="flex items-center justify-center w-8 h-8 text-neutral-700 hover:text-primary-600 dark:text-neutral dark:hover:text-primary-400" title="닫기 (Esc)">
<span class="relative block icon"><svg viewBox="0 0 320 512"><path fill="currentColor" d="M310.6 361.4c12.5 12.5 12.5 32.75.0 45.25C304.4 412.9 296.2 416 288 416s-16.38-3.125-22.62-9.375L160 301.3 54.63 406.6C48.38 412.9 40.19 416 32 416S15.63 412.9 9.375 406.6c-12.5-12.5-12.5-32.75.0-45.25l105.4-105.4L9.375 150.6c-12.5-12.5-12.5-32.75.0-45.25s32.75-12.5 45.25.0L160 210.8l105.4-105.4c12.5-12.5 32.75-12.5 45.25.0s12.5 32.75.0 45.25l-105.4 105.4L310.6 361.4z"/></svg></span></button></header><section class="flex-auto px-2 overflow-auto"><ul id=search-results></ul></section></div></div></div></body></html>