<!doctype html><html lang=ko dir=ltr class=scroll-smooth data-default-appearance=dark data-auto-appearance=true><head><meta charset=utf-8><meta http-equiv=content-language content="ko"><meta name=viewport content="width=device-width,initial-scale=1"><meta http-equiv=X-UA-Compatible content="ie=edge"><meta name=theme-color><title>BigQuery Data Transfer와 Airflow 통합: 매 배치마다 트랜스퍼를 생성하고 삭제하는 이유 &#183; nanta - 데이터 엔지니어링</title><meta name=title content="BigQuery Data Transfer와 Airflow 통합: 매 배치마다 트랜스퍼를 생성하고 삭제하는 이유 &#183; nanta - 데이터 엔지니어링"><meta name=description content="S3 마트 테이블을 BigQuery로 인입하는 파이프라인을 구축했다. PoC에서는 BigQuery Data Transfer 스케줄링을 GCP 쪽에 맡겼지만, 운영으로 가면서 Airflow에 통합했다. 매 배치 틱마다 트랜스퍼 객체를 생성하고 데이터 로드 완료 후 삭제하는 구조다. 사용자 피드백으로 멀티데이 lookback, 동시 실행 쿼터 제한, 빈 소스 경로 감지까지 개선한 과정을 정리한다."><meta name=keywords content="bigquery,airflow,data-transfer,gcp,aws,s3,"><link rel=canonical href=https://nanta-data.dev/posts/bigquery-data-transfer-airflow/><meta name=author content="nanta"><link href=https://github.com/NhoSW rel=me><meta property="og:url" content="https://nanta-data.dev/posts/bigquery-data-transfer-airflow/"><meta property="og:site_name" content="nanta - 데이터 엔지니어링"><meta property="og:title" content="BigQuery Data Transfer와 Airflow 통합: 매 배치마다 트랜스퍼를 생성하고 삭제하는 이유"><meta property="og:description" content="S3 마트 테이블을 BigQuery로 인입하는 파이프라인을 구축했다. PoC에서는 BigQuery Data Transfer 스케줄링을 GCP 쪽에 맡겼지만, 운영으로 가면서 Airflow에 통합했다. 매 배치 틱마다 트랜스퍼 객체를 생성하고 데이터 로드 완료 후 삭제하는 구조다. 사용자 피드백으로 멀티데이 lookback, 동시 실행 쿼터 제한, 빈 소스 경로 감지까지 개선한 과정을 정리한다."><meta property="og:locale" content="ko"><meta property="og:type" content="article"><meta property="article:section" content="posts"><meta property="article:published_time" content="2026-02-27T00:00:00+00:00"><meta property="article:modified_time" content="2026-02-27T00:00:00+00:00"><meta property="article:tag" content="Bigquery"><meta property="article:tag" content="Airflow"><meta property="article:tag" content="Data-Transfer"><meta property="article:tag" content="Gcp"><meta property="article:tag" content="Aws"><meta property="article:tag" content="S3"><meta name=twitter:card content="summary"><meta name=twitter:title content="BigQuery Data Transfer와 Airflow 통합: 매 배치마다 트랜스퍼를 생성하고 삭제하는 이유"><meta name=twitter:description content="S3 마트 테이블을 BigQuery로 인입하는 파이프라인을 구축했다. PoC에서는 BigQuery Data Transfer 스케줄링을 GCP 쪽에 맡겼지만, 운영으로 가면서 Airflow에 통합했다. 매 배치 틱마다 트랜스퍼 객체를 생성하고 데이터 로드 완료 후 삭제하는 구조다. 사용자 피드백으로 멀티데이 lookback, 동시 실행 쿼터 제한, 빈 소스 경로 감지까지 개선한 과정을 정리한다."><link type=text/css rel=stylesheet href=/css/main.bundle.min.c14e86e0d9a09802d254d2a15c05847ae65bfc2e98c2166fabc67369d2d7f2eae6c1da03bbba58cfd41a4af802147c75ce9fdc11dd724ac627ab2903942cbb79.css integrity="sha512-wU6G4NmgmALSVNKhXAWEeuZb/C6YwhZvq8ZzadLX8urmwdoDu7pYz9QaSvgCFHx1zp/cEd1ySsYnqykDlCy7eQ=="><script type=text/javascript src=/js/appearance.min.6f41174b3a05b680820fe08cadbfa5fb7a7ca347b76a0955cdc68b9d8aca1ce24f0547e138cea33bcc7904d551a90afcb1cc7f2d9fe8557075d501419046c08c.js integrity="sha512-b0EXSzoFtoCCD+CMrb+l+3p8o0e3aglVzcaLnYrKHOJPBUfhOM6jO8x5BNVRqQr8scx/LZ/oVXB11QFBkEbAjA=="></script><script src=/lib/zoom/zoom.min.umd.a527109b68c082a70f3697716dd72a9d5aa8b545cf800cecbbc7399f2ca6f6e0ce3e431f2062b48bbfa47c9ea42822714060bef309be073f49b9c0e30d318d7b.js integrity="sha512-pScQm2jAgqcPNpdxbdcqnVqotUXPgAzsu8c5nyym9uDOPkMfIGK0i7+kfJ6kKCJxQGC+8wm+Bz9JucDjDTGNew=="></script><script defer type=text/javascript id=script-bundle src=/js/main.bundle.min.bdda7dece6cbaf08deef7d254f7f842f3261c2524d247905127c9a20decc03f1011a2950048464c79272c1ce0705a49a41147f39f2b95163bb71d404b33263ef.js integrity="sha512-vdp97ObLrwje730lT3+ELzJhwlJNJHkFEnyaIN7MA/EBGilQBIRkx5Jywc4HBaSaQRR/OfK5UWO7cdQEszJj7w==" data-copy=복사 data-copied=복사되었습니다></script><link rel=apple-touch-icon sizes=180x180 href=/apple-touch-icon.png><link rel=icon type=image/png sizes=32x32 href=/favicon-32x32.png><link rel=icon type=image/png sizes=16x16 href=/favicon-16x16.png><link rel=manifest href=/site.webmanifest><script type=application/ld+json>[{"@context":"https://schema.org","@type":"Article","articleSection":"글 목록","name":"BigQuery Data Transfer와 Airflow 통합: 매 배치마다 트랜스퍼를 생성하고 삭제하는 이유","headline":"BigQuery Data Transfer와 Airflow 통합: 매 배치마다 트랜스퍼를 생성하고 삭제하는 이유","inLanguage":"ko","url":"https://nanta-data.dev/posts/bigquery-data-transfer-airflow/","author":{"@type":"Person","name":"nanta"},"copyrightYear":"2026","dateCreated":"2026-02-27T00:00:00\u002b00:00","datePublished":"2026-02-27T00:00:00\u002b00:00","dateModified":"2026-02-27T00:00:00\u002b00:00","keywords":["bigquery","airflow","data-transfer","gcp","aws","s3"],"mainEntityOfPage":"true","wordCount":"1037"}]</script><link rel=preconnect href=https://cdn.jsdelivr.net crossorigin><link href=https://cdn.jsdelivr.net/npm/geist@1.3.1/dist/fonts/geist-sans/style.min.css rel=stylesheet><link href=https://cdn.jsdelivr.net/npm/geist@1.3.1/dist/fonts/geist-mono/style.min.css rel=stylesheet><meta name=google-adsense-account content="ca-pub-9172052068678434"></head><body class="flex flex-col h-screen m-auto leading-7 max-w-7xl px-6 sm:px-14 md:px-24 lg:px-32 text-lg bg-neutral text-neutral-900 dark:bg-neutral-800 dark:text-neutral bf-scrollbar"><div id=the-top class="absolute flex self-center"><a class="px-3 py-1 text-sm -translate-y-8 rounded-b-lg bg-primary-200 focus:translate-y-0 dark:bg-neutral-600" href=#main-content><span class="font-bold text-primary-600 pe-2 dark:text-primary-400">&darr;</span>
본문으로 건너뛰기</a></div><div class=min-h-[148px]></div><div class="fixed inset-x-0 z-100"><div id=menu-blur class="absolute opacity-0 inset-x-0 top-0 h-full single_hero_background nozoom backdrop-blur-2xl shadow-2xl bg-neutral/25 dark:bg-neutral-800/25"></div><div class="relative m-auto leading-7 max-w-7xl px-6 sm:px-14 md:px-24 lg:px-32"><div class="main-menu flex items-center w-full gap-2 p-1 pl-0"><a href=/ class="text-base font-medium truncate min-w-0 shrink">nanta - 데이터 엔지니어링</a><div class="flex items-center ms-auto"><div class="hidden md:flex"><nav class="flex items-center gap-x-5 h-12"><a href=/posts/ class="flex items-center bf-icon-color-hover" aria-label="글 목록" title="글 목록"><span class="text-base font-medium break-normal">글 목록
</span></a><a href=/categories/ class="flex items-center bf-icon-color-hover" aria-label=카테고리 title=Categories><span class="text-base font-medium break-normal">카테고리
</span></a><a href=/tags/ class="flex items-center bf-icon-color-hover" aria-label=태그 title=Tags><span class="text-base font-medium break-normal">태그
</span></a><a href=/about/ class="flex items-center bf-icon-color-hover" aria-label=소개 title=소개><span class="text-base font-medium break-normal">소개</span></a><div class="translation nested-menu"><button class="cursor-pointer flex items-center">
<span class=me-1><span class="relative block icon"><svg viewBox="0 0 640 512"><path fill="currentColor" d="M0 128C0 92.7 28.7 64 64 64H256h48 16H576c35.3.0 64 28.7 64 64V384c0 35.3-28.7 64-64 64H320 304 256 64c-35.3.0-64-28.7-64-64V128zm320 0V384H576V128H320zM178.3 175.9c-3.2-7.2-10.4-11.9-18.3-11.9s-15.1 4.7-18.3 11.9l-64 144c-4.5 10.1.1 21.9 10.2 26.4s21.9-.1 26.4-10.2l8.9-20.1h73.6l8.9 20.1c4.5 10.1 16.3 14.6 26.4 10.2s14.6-16.3 10.2-26.4l-64-144zM160 233.2 179 276H141l19-42.8zM448 164c11 0 20 9 20 20v4h44 16c11 0 20 9 20 20s-9 20-20 20h-2l-1.6 4.5c-8.9 24.4-22.4 46.6-39.6 65.4.9.6 1.8 1.1 2.7 1.6l18.9 11.3c9.5 5.7 12.5 18 6.9 27.4s-18 12.5-27.4 6.9L467 333.8c-4.5-2.7-8.8-5.5-13.1-8.5-10.6 7.5-21.9 14-34 19.4l-3.6 1.6c-10.1 4.5-21.9-.1-26.4-10.2s.1-21.9 10.2-26.4l3.6-1.6c6.4-2.9 12.6-6.1 18.5-9.8L410 286.1c-7.8-7.8-7.8-20.5.0-28.3s20.5-7.8 28.3.0l14.6 14.6.5.5c12.4-13.1 22.5-28.3 29.8-45H448 376c-11 0-20-9-20-20s9-20 20-20h52v-4c0-11 9-20 20-20z"/></svg></span>
</span><span class="text-sm font-medium bf-icon-color-hover" title="BigQuery Data Transfer와 Airflow 통합: 매 배치마다 트랜스퍼를 생성하고 삭제하는 이유">KO</span></button><ul class=menuhide><li class="rounded-xl backdrop-blur shadow-2xl p-2 flex flex-col gap-1"><a href=/posts/bigquery-data-transfer-airflow/ class="flex items-center bf-icon-color-hover px-3 py-1"><span class="text-sm font-sm" title="BigQuery Data Transfer와 Airflow 통합: 매 배치마다 트랜스퍼를 생성하고 삭제하는 이유">한국어
</span></a><a href=/en/posts/bigquery-data-transfer-airflow/ class="flex items-center bf-icon-color-hover px-3 py-1"><span class="text-sm font-sm" title="BigQuery Data Transfer + Airflow: Why We Create and Delete Transfers Every Batch">English</span></a></li></ul></div><button id=search-button aria-label=Search class="text-base bf-icon-color-hover" title="검색하기 (/)">
<span class="relative block icon"><svg aria-hidden="true" focusable="false" data-prefix="fas" data-icon="search" class="svg-inline--fa fa-search fa-w-16" role="img" viewBox="0 0 512 512"><path fill="currentColor" d="M505 442.7 405.3 343c-4.5-4.5-10.6-7-17-7H372c27.6-35.3 44-79.7 44-128C416 93.1 322.9.0 208 0S0 93.1.0 208s93.1 208 208 208c48.3.0 92.7-16.4 128-44v16.3c0 6.4 2.5 12.5 7 17l99.7 99.7c9.4 9.4 24.6 9.4 33.9.0l28.3-28.3c9.4-9.4 9.4-24.6.1-34zM208 336c-70.7.0-128-57.2-128-128 0-70.7 57.2-128 128-128 70.7.0 128 57.2 128 128 0 70.7-57.2 128-128 128z"/></svg></span></button><div class="flex items-center"><button id=appearance-switcher aria-label="Dark mode switcher" type=button class="text-base bf-icon-color-hover"><div class="flex items-center justify-center dark:hidden"><span class="relative block icon"><svg viewBox="0 0 512 512"><path fill="currentColor" d="M32 256C32 132.2 132.3 32 255.8 32c11.36.0 29.7 1.668 40.9 3.746 9.616 1.777 11.75 14.63 3.279 19.44C245 86.5 211.2 144.6 211.2 207.8c0 109.7 99.71 193 208.3 172.3 9.561-1.805 16.28 9.324 10.11 16.95C387.9 448.6 324.8 480 255.8 480 132.1 480 32 379.6 32 256z"/></svg></span></div><div class="items-center justify-center hidden dark:flex"><span class="relative block icon"><svg viewBox="0 0 512 512"><path fill="currentColor" d="M256 159.1c-53.02.0-95.1 42.98-95.1 95.1s41.2 96.9 95.1 96.9 95.1-42.98 95.1-95.1S309 159.1 256 159.1zM509.3 347l-63.2-91.9 63.15-91.01c6.332-9.125 1.104-21.74-9.826-23.72l-109-19.7-19.7-109c-1.975-10.93-14.59-16.16-23.72-9.824L256 65.89 164.1 2.736c-9.125-6.332-21.74-1.107-23.72 9.824L121.6 121.6 12.56 141.3C1.633 143.2-3.596 155.9 2.736 164.1L65.89 256 2.74 347.01c-6.332 9.125-1.105 21.74 9.824 23.72l109 19.7 19.7 109c1.975 10.93 14.59 16.16 23.72 9.824L256 446.1l91.01 63.15c9.127 6.334 21.75 1.107 23.72-9.822l19.7-109 109-19.7C510.4 368.8 515.6 356.1 509.3 347zM256 383.1c-70.69.0-127.1-57.31-127.1-127.1.0-70.69 57.31-127.1 127.1-127.1S383.1 186.2 383.1 256c0 70.7-56.4 127.1-127.1 127.1z"/></svg></span></div></button></div></nav></div><div class="flex md:hidden"><div class="flex items-center h-14 gap-4"><button id=search-button-mobile aria-label=Search class="flex items-center justify-center bf-icon-color-hover" title="검색하기 (/)">
<span class="relative block icon"><svg aria-hidden="true" focusable="false" data-prefix="fas" data-icon="search" class="svg-inline--fa fa-search fa-w-16" role="img" viewBox="0 0 512 512"><path fill="currentColor" d="M505 442.7 405.3 343c-4.5-4.5-10.6-7-17-7H372c27.6-35.3 44-79.7 44-128C416 93.1 322.9.0 208 0S0 93.1.0 208s93.1 208 208 208c48.3.0 92.7-16.4 128-44v16.3c0 6.4 2.5 12.5 7 17l99.7 99.7c9.4 9.4 24.6 9.4 33.9.0l28.3-28.3c9.4-9.4 9.4-24.6.1-34zM208 336c-70.7.0-128-57.2-128-128 0-70.7 57.2-128 128-128 70.7.0 128 57.2 128 128 0 70.7-57.2 128-128 128z"/></svg>
</span></button>
<button id=appearance-switcher-mobile type=button aria-label="Dark mode switcher" class="flex items-center justify-center text-neutral-900 hover:text-primary-600 dark:text-neutral-200 dark:hover:text-primary-400"><div class=dark:hidden><span class="relative block icon"><svg viewBox="0 0 512 512"><path fill="currentColor" d="M32 256C32 132.2 132.3 32 255.8 32c11.36.0 29.7 1.668 40.9 3.746 9.616 1.777 11.75 14.63 3.279 19.44C245 86.5 211.2 144.6 211.2 207.8c0 109.7 99.71 193 208.3 172.3 9.561-1.805 16.28 9.324 10.11 16.95C387.9 448.6 324.8 480 255.8 480 132.1 480 32 379.6 32 256z"/></svg></span></div><div class="hidden dark:block"><span class="relative block icon"><svg viewBox="0 0 512 512"><path fill="currentColor" d="M256 159.1c-53.02.0-95.1 42.98-95.1 95.1s41.2 96.9 95.1 96.9 95.1-42.98 95.1-95.1S309 159.1 256 159.1zM509.3 347l-63.2-91.9 63.15-91.01c6.332-9.125 1.104-21.74-9.826-23.72l-109-19.7-19.7-109c-1.975-10.93-14.59-16.16-23.72-9.824L256 65.89 164.1 2.736c-9.125-6.332-21.74-1.107-23.72 9.824L121.6 121.6 12.56 141.3C1.633 143.2-3.596 155.9 2.736 164.1L65.89 256 2.74 347.01c-6.332 9.125-1.105 21.74 9.824 23.72l109 19.7 19.7 109c1.975 10.93 14.59 16.16 23.72 9.824L256 446.1l91.01 63.15c9.127 6.334 21.75 1.107 23.72-9.822l19.7-109 109-19.7C510.4 368.8 515.6 356.1 509.3 347zM256 383.1c-70.69.0-127.1-57.31-127.1-127.1.0-70.69 57.31-127.1 127.1-127.1S383.1 186.2 383.1 256c0 70.7-56.4 127.1-127.1 127.1z"/></svg></span></div></button>
<input type=checkbox id=mobile-menu-toggle autocomplete=off class="hidden peer">
<label for=mobile-menu-toggle class="flex items-center justify-center cursor-pointer bf-icon-color-hover"><span class="relative block icon"><svg viewBox="0 0 448 512"><path fill="currentColor" d="M0 96C0 78.33 14.33 64 32 64H416c17.7.0 32 14.33 32 32 0 17.7-14.3 32-32 32H32C14.33 128 0 113.7.0 96zM0 256c0-17.7 14.33-32 32-32H416c17.7.0 32 14.3 32 32s-14.3 32-32 32H32c-17.67.0-32-14.3-32-32zM416 448H32c-17.67.0-32-14.3-32-32s14.33-32 32-32H416c17.7.0 32 14.3 32 32s-14.3 32-32 32z"/></svg></span></label><div role=dialog aria-modal=true style=scrollbar-gutter:stable class="fixed inset-0 z-50 invisible overflow-y-auto px-6 py-20 opacity-0 transition-[opacity,visibility] duration-300 peer-checked:visible peer-checked:opacity-100 bg-neutral-50/97 dark:bg-neutral-900/99
bf-scrollbar"><label for=mobile-menu-toggle class="fixed end-8 top-5 flex items-center justify-center z-50 h-12 w-12 cursor-pointer select-none rounded-full bf-icon-color-hover border bf-border-color bf-border-color-hover bg-neutral-50 dark:bg-neutral-900"><span class="relative block icon"><svg viewBox="0 0 320 512"><path fill="currentColor" d="M310.6 361.4c12.5 12.5 12.5 32.75.0 45.25C304.4 412.9 296.2 416 288 416s-16.38-3.125-22.62-9.375L160 301.3 54.63 406.6C48.38 412.9 40.19 416 32 416S15.63 412.9 9.375 406.6c-12.5-12.5-12.5-32.75.0-45.25l105.4-105.4L9.375 150.6c-12.5-12.5-12.5-32.75.0-45.25s32.75-12.5 45.25.0L160 210.8l105.4-105.4c12.5-12.5 32.75-12.5 45.25.0s12.5 32.75.0 45.25l-105.4 105.4L310.6 361.4z"/></svg></span></label><nav class="mx-auto max-w-md space-y-6"><div class=px-2><a href=/posts/ aria-label="글 목록" class="flex items-center gap-4 group bf-icon-color-hover text-neutral-700 dark:text-neutral-200"><span title="글 목록" class="text-2xl font-bold tracking-tight">글 목록</span></a></div><div class=px-2><a href=/categories/ aria-label=카테고리 class="flex items-center gap-4 group bf-icon-color-hover text-neutral-700 dark:text-neutral-200"><span title=Categories class="text-2xl font-bold tracking-tight">카테고리</span></a></div><div class=px-2><a href=/tags/ aria-label=태그 class="flex items-center gap-4 group bf-icon-color-hover text-neutral-700 dark:text-neutral-200"><span title=Tags class="text-2xl font-bold tracking-tight">태그</span></a></div><div class=px-2><a href=/about/ aria-label=소개 class="flex items-center gap-4 group bf-icon-color-hover text-neutral-700 dark:text-neutral-200"><span title=소개 class="text-2xl font-bold tracking-tight">소개</span></a></div><div class="flex flex-wrap items-center [&_span]:text-2xl [&_.translation_button_.icon]:text-4xl! [&_.translation_button_span]:text-base! [&_.translation_.menuhide_span]:text-sm! gap-x-6 ps-2 mt-8 pt-8 border-t bf-border-color"><div class="translation nested-menu"><button class="cursor-pointer flex items-center">
<span class=me-1><span class="relative block icon"><svg viewBox="0 0 640 512"><path fill="currentColor" d="M0 128C0 92.7 28.7 64 64 64H256h48 16H576c35.3.0 64 28.7 64 64V384c0 35.3-28.7 64-64 64H320 304 256 64c-35.3.0-64-28.7-64-64V128zm320 0V384H576V128H320zM178.3 175.9c-3.2-7.2-10.4-11.9-18.3-11.9s-15.1 4.7-18.3 11.9l-64 144c-4.5 10.1.1 21.9 10.2 26.4s21.9-.1 26.4-10.2l8.9-20.1h73.6l8.9 20.1c4.5 10.1 16.3 14.6 26.4 10.2s14.6-16.3 10.2-26.4l-64-144zM160 233.2 179 276H141l19-42.8zM448 164c11 0 20 9 20 20v4h44 16c11 0 20 9 20 20s-9 20-20 20h-2l-1.6 4.5c-8.9 24.4-22.4 46.6-39.6 65.4.9.6 1.8 1.1 2.7 1.6l18.9 11.3c9.5 5.7 12.5 18 6.9 27.4s-18 12.5-27.4 6.9L467 333.8c-4.5-2.7-8.8-5.5-13.1-8.5-10.6 7.5-21.9 14-34 19.4l-3.6 1.6c-10.1 4.5-21.9-.1-26.4-10.2s.1-21.9 10.2-26.4l3.6-1.6c6.4-2.9 12.6-6.1 18.5-9.8L410 286.1c-7.8-7.8-7.8-20.5.0-28.3s20.5-7.8 28.3.0l14.6 14.6.5.5c12.4-13.1 22.5-28.3 29.8-45H448 376c-11 0-20-9-20-20s9-20 20-20h52v-4c0-11 9-20 20-20z"/></svg></span>
</span><span class="text-sm font-medium bf-icon-color-hover" title="BigQuery Data Transfer와 Airflow 통합: 매 배치마다 트랜스퍼를 생성하고 삭제하는 이유">KO</span></button><ul class=menuhide><li class="rounded-xl backdrop-blur shadow-2xl p-2 flex flex-col gap-1"><a href=/posts/bigquery-data-transfer-airflow/ class="flex items-center bf-icon-color-hover px-3 py-1"><span class="text-sm font-sm" title="BigQuery Data Transfer와 Airflow 통합: 매 배치마다 트랜스퍼를 생성하고 삭제하는 이유">한국어
</span></a><a href=/en/posts/bigquery-data-transfer-airflow/ class="flex items-center bf-icon-color-hover px-3 py-1"><span class="text-sm font-sm" title="BigQuery Data Transfer + Airflow: Why We Create and Delete Transfers Every Batch">English</span></a></li></ul></div></div></nav></div></div></div></div></div></div></div><script type=text/javascript src=/js/background-blur.min.605b3b942818f0ab5a717ae446135ec46b8ee5a2ad12ae56fb90dc2a76ce30c388f9fec8bcc18db15bd47e3fa8a09d779fa12aa9c184cf614a315bc72c6c163d.js integrity="sha512-YFs7lCgY8KtacXrkRhNexGuO5aKtEq5W+5DcKnbOMMOI+f7IvMGNsVvUfj+ooJ13n6EqqcGEz2FKMVvHLGwWPQ==" data-blur-id=menu-blur></script><div class="relative flex flex-col grow"><main id=main-content class=grow><article><header id=single_header class="mt-5 max-w-prose"><ol class="text-sm text-neutral-500 dark:text-neutral-400 print:hidden"><li class=hidden><a class="hover:underline decoration-neutral-300 dark:underline-neutral-600" href=/>nanta - 데이터 엔지니어링</a><span class="px-1 text-primary-500">/</span></li><li class=inline><a class="hover:underline decoration-neutral-300 dark:underline-neutral-600" href=/posts/>글 목록</a><span class="px-1 text-primary-500">/</span></li><li class=hidden><a class="hover:underline decoration-neutral-300 dark:underline-neutral-600" href=/posts/bigquery-data-transfer-airflow/>BigQuery Data Transfer와 Airflow 통합: 매 배치마다 트랜스퍼를 생성하고 삭제하는 이유</a><span class="px-1 text-primary-500">/</span></li></ol><h1 class="mt-0 text-4xl font-extrabold text-neutral-900 dark:text-neutral">BigQuery Data Transfer와 Airflow 통합: 매 배치마다 트랜스퍼를 생성하고 삭제하는 이유</h1><div class="mt-1 mb-6 text-base text-neutral-500 dark:text-neutral-400 print:hidden"><div class="flex flex-row flex-wrap items-center"><time datetime=2026-02-27T00:00:00+00:00>2026년 2월 27일</time><span class="px-2 text-primary-500">&#183;</span><span title="읽는 시간">5 분</span></div></div><div class="flex author"><div class=place-self-center><div class="text-[0.6rem] uppercase leading-3 text-neutral-500 dark:text-neutral-400">작성자</div><div class="font-semibold leading-6 text-neutral-800 dark:text-neutral-300">nanta</div><div class="text-sm text-neutral-700 dark:text-neutral-400">Apache Kafka, Airflow, Trino, StarRocks 등 데이터 엔지니어링과 모던 데이터 인프라에 대한 실무 경험을 공유하는 블로그입니다.</div><div class="text-2xl sm:text-lg"><div class="flex flex-wrap text-neutral-400 dark:text-neutral-500"><a class="px-1 hover:text-primary-700 dark:hover:text-primary-400" href=https://github.com/NhoSW target=_blank aria-label=Github title=Github rel="me noopener noreferrer"><span class="inline-block align-text-bottom"><span class="relative block icon"><svg viewBox="0 0 496 512"><path fill="currentColor" d="M165.9 397.4c0 2-2.3 3.6-5.2 3.6-3.3.3-5.6-1.3-5.6-3.6.0-2 2.3-3.6 5.2-3.6 3-.3 5.6 1.3 5.6 3.6zm-31.1-4.5c-.7 2 1.3 4.3 4.3 4.9 2.6 1 5.6.0 6.2-2s-1.3-4.3-4.3-5.2c-2.6-.7-5.5.3-6.2 2.3zm44.2-1.7c-2.9.7-4.9 2.6-4.6 4.9.3 2 2.9 3.3 5.9 2.6 2.9-.7 4.9-2.6 4.6-4.6-.3-1.9-3-3.2-5.9-2.9zM244.8 8C106.1 8 0 113.3.0 252c0 110.9 69.8 205.8 169.5 239.2 12.8 2.3 17.3-5.6 17.3-12.1.0-6.2-.3-40.4-.3-61.4.0.0-70 15-84.7-29.8.0.0-11.4-29.1-27.8-36.6.0.0-22.9-15.7 1.6-15.4.0.0 24.9 2 38.6 25.8 21.9 38.6 58.6 27.5 72.9 20.9 2.3-16 8.8-27.1 16-33.7-55.9-6.2-112.3-14.3-112.3-110.5.0-27.5 7.6-41.3 23.6-58.9-2.6-6.5-11.1-33.3 2.6-67.9 20.9-6.5 69 27 69 27 20-5.6 41.5-8.5 62.8-8.5s42.8 2.9 62.8 8.5c0 0 48.1-33.6 69-27 13.7 34.7 5.2 61.4 2.6 67.9 16 17.7 25.8 31.5 25.8 58.9.0 96.5-58.9 104.2-114.8 110.5 9.2 7.9 17 22.9 17 46.4.0 33.7-.3 75.4-.3 83.6.0 6.5 4.6 14.4 17.3 12.1C428.2 457.8 496 362.9 496 252 496 113.3 383.5 8 244.8 8zM97.2 352.9c-1.3 1-1 3.3.7 5.2 1.6 1.6 3.9 2.3 5.2 1 1.3-1 1-3.3-.7-5.2-1.6-1.6-3.9-2.3-5.2-1zm-10.8-8.1c-.7 1.3.3 2.9 2.3 3.9 1.6 1 3.6.7 4.3-.7.7-1.3-.3-2.9-2.3-3.9-2-.6-3.6-.3-4.3.7zm32.4 35.6c-1.6 1.3-1 4.3 1.3 6.2 2.3 2.3 5.2 2.6 6.5 1 1.3-1.3.7-4.3-1.3-6.2-2.2-2.3-5.2-2.6-6.5-1zm-11.4-14.7c-1.6 1-1.6 3.6.0 5.9 1.6 2.3 4.3 3.3 5.6 2.3 1.6-1.3 1.6-3.9.0-6.2-1.4-2.3-4-3.3-5.6-2z"/></svg></span></span></a></div></div></div></div><div class=mb-5></div></header><section class="flex flex-col max-w-full mt-0 prose dark:prose-invert lg:flex-row"><div class="order-first lg:ms-auto px-0 lg:order-last lg:ps-8 lg:max-w-2xs"><div class="toc ps-5 print:hidden lg:sticky lg:top-[140px]"><details open id=TOCView class="toc-right mt-0 overflow-y-auto overscroll-contain bf-scrollbar rounded-lg -ms-5 ps-5 pe-2 hidden lg:block"><summary class="block py-1 text-lg font-semibold cursor-pointer bg-neutral-100 text-neutral-800 -ms-5 ps-5 dark:bg-neutral-700 dark:text-neutral-100 lg:hidden">목차</summary><div class="min-w-[220px] py-2 border-dotted border-s-1 -ms-5 ps-5 dark:border-neutral-600"><nav id=TableOfContents><ul><li><a href=#poc에서의-접근과-한계>PoC에서의 접근과 한계</a></li><li><a href=#설계-매-배치마다-생성하고-삭제한다>설계: 매 배치마다 생성하고 삭제한다</a><ul><li><a href=#구현>구현</a></li><li><a href=#사용자-인터페이스>사용자 인터페이스</a></li></ul></li><li><a href=#spark-직접-인제션-대비-dts의-장점>Spark 직접 인제션 대비 DTS의 장점</a></li><li><a href=#사용자-피드백과-개선>사용자 피드백과 개선</a><ul><li><a href=#멀티데이-lookback>멀티데이 lookback</a></li><li><a href=#동시-실행-쿼터-제한>동시 실행 쿼터 제한</a></li><li><a href=#빈-소스-경로-감지>빈 소스 경로 감지</a></li><li><a href=#타임존-처리>타임존 처리</a></li></ul></li><li><a href=#파티션-매핑>파티션 매핑</a></li><li><a href=#write_append-모드-고려>WRITE_APPEND 모드 고려</a></li><li><a href=#배운-것>배운 것</a></li></ul></nav></div></details><details class="toc-inside mt-0 overflow-hidden rounded-lg -ms-5 ps-5 lg:hidden"><summary class="py-1 text-lg font-semibold cursor-pointer bg-neutral-100 text-neutral-800 -ms-5 ps-5 dark:bg-neutral-700 dark:text-neutral-100 lg:hidden">목차</summary><div class="py-2 border-dotted border-neutral-300 border-s-1 -ms-5 ps-5 dark:border-neutral-600"><nav id=TableOfContents><ul><li><a href=#poc에서의-접근과-한계>PoC에서의 접근과 한계</a></li><li><a href=#설계-매-배치마다-생성하고-삭제한다>설계: 매 배치마다 생성하고 삭제한다</a><ul><li><a href=#구현>구현</a></li><li><a href=#사용자-인터페이스>사용자 인터페이스</a></li></ul></li><li><a href=#spark-직접-인제션-대비-dts의-장점>Spark 직접 인제션 대비 DTS의 장점</a></li><li><a href=#사용자-피드백과-개선>사용자 피드백과 개선</a><ul><li><a href=#멀티데이-lookback>멀티데이 lookback</a></li><li><a href=#동시-실행-쿼터-제한>동시 실행 쿼터 제한</a></li><li><a href=#빈-소스-경로-감지>빈 소스 경로 감지</a></li><li><a href=#타임존-처리>타임존 처리</a></li></ul></li><li><a href=#파티션-매핑>파티션 매핑</a></li><li><a href=#write_append-모드-고려>WRITE_APPEND 모드 고려</a></li><li><a href=#배운-것>배운 것</a></li></ul></nav></div></details></div></div><div class="min-w-0 min-h-0 max-w-fit"><div class="article-content max-w-prose mb-20"><p>S3에 적재된 Gold 테이블을 BigQuery로 인입하는 파이프라인이 필요했다. AWS의 데이터 레이크에서 가공된 마트 테이블을 GCP BigQuery에서 분석할 수 있도록 하는 것이 목표다.</p><p>BigQuery Data Transfer Service(DTS)가 이 용도에 맞다. S3에서 BigQuery로 데이터를 직접 로드할 수 있고, 별도 컴퓨팅 비용이 없다. 문제는 이 DTS의 스케줄링을 어디서 관리할 것인가였다.</p><hr><h2 class="relative group">PoC에서의 접근과 한계<div id=poc에서의-접근과-한계 class=anchor></div><span class="absolute top-0 w-6 transition-opacity opacity-0 -start-6 not-prose group-hover:opacity-100 select-none"><a class="text-primary-300 dark:text-neutral-700 !no-underline" href=#poc%ec%97%90%ec%84%9c%ec%9d%98-%ec%a0%91%ea%b7%bc%ea%b3%bc-%ed%95%9c%ea%b3%84 aria-label=앵커>#</a></span></h2><p>PoC 단계에서는 빠르게 동작을 확인하는 것이 목적이었다. DTS 트랜스퍼 객체를 1회성 Airflow 잡으로 생성하고, 실제 스케줄링은 BigQuery 서비스 자체에 맡겼다. BigQuery 콘솔에서 트랜스퍼 스케줄을 확인하고 관리하는 방식이다.</p><p>동작은 했지만 운영 관점에서 문제가 있었다. 트랜스퍼 스케줄이 Airflow에 통합되어 있지 않다. Airflow에서는 트랜스퍼가 완료됐는지 알 수 없고, 후속 태스크와의 의존성도 관리할 수 없다. 트랜스퍼 실패 시 알림도 BigQuery 쪽에서만 확인할 수 있다.</p><p>대안으로 BigQuery 테이블 센서를 사용하는 방법도 있었다. 트랜스퍼가 완료되면 테이블에 데이터가 쌓이니, 센서로 테이블 업데이트를 감지하는 방식이다. 하지만 이건 간접적인 확인이다. 트랜스퍼가 실패한 건지, 아직 진행 중인 건지, 소스에 데이터가 없는 건지 구분이 안 된다.</p><p>매 배치 틱마다 트랜스퍼 객체의 생성과 삭제를 모두 Airflow에서 관리하는 것이 구조적으로 올바르다고 판단했다.</p><hr><h2 class="relative group">설계: 매 배치마다 생성하고 삭제한다<div id=설계-매-배치마다-생성하고-삭제한다 class=anchor></div><span class="absolute top-0 w-6 transition-opacity opacity-0 -start-6 not-prose group-hover:opacity-100 select-none"><a class="text-primary-300 dark:text-neutral-700 !no-underline" href=#%ec%84%a4%ea%b3%84-%eb%a7%a4-%eb%b0%b0%ec%b9%98%eb%a7%88%eb%8b%a4-%ec%83%9d%ec%84%b1%ed%95%98%ea%b3%a0-%ec%82%ad%ec%a0%9c%ed%95%9c%eb%8b%a4 aria-label=앵커>#</a></span></h2><p>핵심 아이디어는 트랜스퍼 객체를 상시 유지하지 않는 것이다.</p><ol><li>Airflow DAG의 배치 틱이 시작되면 DTS 트랜스퍼 객체를 생성한다</li><li>트랜스퍼가 완료될 때까지 대기한다 (async 오퍼레이터 사용)</li><li>완료되면 트랜스퍼 객체를 삭제한다</li></ol><p>이 방식의 장점은 명확하다. Airflow가 트랜스퍼의 전체 라이프사이클을 관리하므로 실패 감지, 재시도, 후속 태스크 의존성이 모두 Airflow의 기존 메커니즘으로 처리된다. BigQuery 콘솔에 유령 트랜스퍼 객체가 쌓이지도 않는다.</p><p>기본 쓰기 모드는 <code>WRITE_TRUNCATE</code>다. 각 시간 파티션별로 적재 시 기존 데이터를 덮어쓰므로 멱등성이 보장된다. 같은 배치를 여러 번 실행해도 결과가 동일하다.</p><h3 class="relative group">구현<div id=구현 class=anchor></div><span class="absolute top-0 w-6 transition-opacity opacity-0 -start-6 not-prose group-hover:opacity-100 select-none"><a class="text-primary-300 dark:text-neutral-700 !no-underline" href=#%ea%b5%ac%ed%98%84 aria-label=앵커>#</a></span></h3><p>Apache Airflow의 Google Cloud Provider에 BigQuery DTS 오퍼레이터가 있지만, 우리 유스케이스에 맞지 않는 부분과 미수정 버그가 있었다. 몇 가지 커스터마이징과 버그 픽스를 진행하고 내부 프로바이더 패키지(<code>airfilter-providers</code>)에 포함했다. 수정한 버그는 Airflow 원본 레포에도 MR을 올려두었다.</p><p>async 오퍼레이터를 활용하기 위해 Airflow triggerer 컴포넌트에 관련 볼륨 마운트도 추가했다. triggerer는 deferrable 오퍼레이터가 외부 이벤트를 기다릴 때 사용하는 Airflow 컴포넌트로, DTS 트랜스퍼 완료를 비동기로 대기하는 데 필요하다.</p><h3 class="relative group">사용자 인터페이스<div id=사용자-인터페이스 class=anchor></div><span class="absolute top-0 w-6 transition-opacity opacity-0 -start-6 not-prose group-hover:opacity-100 select-none"><a class="text-primary-300 dark:text-neutral-700 !no-underline" href=#%ec%82%ac%ec%9a%a9%ec%9e%90-%ec%9d%b8%ed%84%b0%ed%8e%98%ec%9d%b4%ec%8a%a4 aria-label=앵커>#</a></span></h3><p>실제 사용자가 해야 할 일은 설정 파일에 <code>S3ToBigQueryLoadConfig</code> 객체를 추가하는 것뿐이다.</p><div class=highlight-wrapper><div class=highlight><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=n>S3_LOAD_CONFIG_BY_DAG_ID</span> <span class=o>=</span> <span class=n>S3ToBigQueryLoadConfigByDagIdDict</span><span class=p>(</span>
</span></span><span class=line><span class=cl>    <span class=n>dataeng_bigquery_dts_load_dag_v1</span><span class=o>=</span><span class=p>[</span>
</span></span><span class=line><span class=cl>        <span class=n>S3ToBigQueryLoadConfig</span><span class=p>(</span>
</span></span><span class=line><span class=cl>            <span class=n>src_s3_path</span><span class=o>=</span><span class=s1>&#39;s3://bucket/schema/table_name&#39;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>            <span class=n>daily_partition_field</span><span class=o>=</span><span class=s1>&#39;part_dt&#39;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>            <span class=n>require_partition_filter</span><span class=o>=</span><span class=kc>True</span><span class=p>,</span>
</span></span><span class=line><span class=cl>            <span class=n>time_partition_expiration_days</span><span class=o>=</span><span class=mi>365</span><span class=p>,</span>
</span></span><span class=line><span class=cl>        <span class=p>),</span>
</span></span><span class=line><span class=cl>    <span class=p>],</span>
</span></span><span class=line><span class=cl><span class=p>)</span></span></span></code></pre></div></div><p>S3 소스 경로, 파티션 필드, 만료 기간만 지정하면 나머지는 프레임워크가 처리한다. 싱크 데이터셋과 테이블명은 기본값으로 S3 경로의 마지막 두 요소를 사용하고, 필요하면 <code>sink_dataset</code>과 <code>sink_table</code> 인자로 직접 지정할 수 있다.</p><hr><h2 class="relative group">Spark 직접 인제션 대비 DTS의 장점<div id=spark-직접-인제션-대비-dts의-장점 class=anchor></div><span class="absolute top-0 w-6 transition-opacity opacity-0 -start-6 not-prose group-hover:opacity-100 select-none"><a class="text-primary-300 dark:text-neutral-700 !no-underline" href=#spark-%ec%a7%81%ec%a0%91-%ec%9d%b8%ec%a0%9c%ec%85%98-%eb%8c%80%eb%b9%84-dts%ec%9d%98-%ec%9e%a5%ec%a0%90 aria-label=앵커>#</a></span></h2><p>S3 데이터를 BigQuery에 넣는 다른 방법도 있다. EMR Spark에서 데이터프레임을 만들어 BigQuery에 직접 쓰는 방식이다. 이 방식 대비 DTS를 선택한 이유가 있다.</p><p><strong>비용:</strong> DTS를 통한 데이터 로드에는 별도 컴퓨팅 비용이 없다. AWS에서 GCP로의 네트워크 비용은 어떤 방식이든 동일하게 발생하지만, DTS는 로드 자체의 컴퓨팅이 무료다. Spark 잡을 돌리면 EMR 클러스터 비용이 추가된다.</p><p><strong>유지보수:</strong> Spark 인제션은 Spark 앱 생성, 파티션 필드 제거 로직, BigQuery 커넥터 설정 등을 관리해야 한다. DTS 래퍼는 설정 객체 하나 추가하면 끝이다. 향후 config.yaml로 설정을 받는 형태로 전환하면 더 간소화할 수 있다.</p><hr><h2 class="relative group">사용자 피드백과 개선<div id=사용자-피드백과-개선 class=anchor></div><span class="absolute top-0 w-6 transition-opacity opacity-0 -start-6 not-prose group-hover:opacity-100 select-none"><a class="text-primary-300 dark:text-neutral-700 !no-underline" href=#%ec%82%ac%ec%9a%a9%ec%9e%90-%ed%94%bc%eb%93%9c%eb%b0%b1%ea%b3%bc-%ea%b0%9c%ec%84%a0 aria-label=앵커>#</a></span></h2><p>실제 사용자가 23개 테이블을 이관하면서 네 가지 피드백을 공유해주셨다. 실 사용에서 나온 피드백이라 모두 타당했다.</p><h3 class="relative group">멀티데이 lookback<div id=멀티데이-lookback class=anchor></div><span class="absolute top-0 w-6 transition-opacity opacity-0 -start-6 not-prose group-hover:opacity-100 select-none"><a class="text-primary-300 dark:text-neutral-700 !no-underline" href=#%eb%a9%80%ed%8b%b0%eb%8d%b0%ec%9d%b4-lookback aria-label=앵커>#</a></span></h3><p><strong>문제:</strong> 기존 구현은 전일자(D-1) 고정 적재만 가능했다. 하지만 일부 테이블은 매일 14일치 파티션이 업데이트된다. 14일치 데이터를 모두 갱신해야 하는데, 1일치만 적재할 수 있었다.</p><p>이건 CDC 테이블이 아니라 배치 테이블에서 발생하는 패턴이다. 원천 시스템에서 과거 데이터를 소급 수정하는 경우, 최근 N일의 파티션이 매일 갱신된다.</p><p><strong>대응:</strong> <code>S3ToBigQueryLoadConfig</code>에 <code>lookback_window_days</code> 인자를 추가했다. 기본값은 0(전일자만)이고, 예를 들어 14로 설정하면 D-1부터 D-14까지 14개 파티션을 매 배치마다 적재한다.</p><h3 class="relative group">동시 실행 쿼터 제한<div id=동시-실행-쿼터-제한 class=anchor></div><span class="absolute top-0 w-6 transition-opacity opacity-0 -start-6 not-prose group-hover:opacity-100 select-none"><a class="text-primary-300 dark:text-neutral-700 !no-underline" href=#%eb%8f%99%ec%8b%9c-%ec%8b%a4%ed%96%89-%ec%bf%bc%ed%84%b0-%ec%a0%9c%ed%95%9c aria-label=앵커>#</a></span></h3><p><strong>문제:</strong> 20개 이상의 테이블 로드 태스크가 동시에 실행되면, BigQuery 쪽의 throughput 쿼터 제한으로 일부 태스크가 강제 실패했다.</p><p>BigQuery에는 프로젝트 레벨의 동시 로드 잡 제한이 있다. 한꺼번에 너무 많은 DTS 트랜스퍼가 실행되면 쿼터를 초과한다.</p><p><strong>대응:</strong> BigQuery 쪽에 쿼터 증설을 요청할 수도 있지만, Airflow 쪽에서 동시 실행 수를 제한하는 것이 더 안전하다. <code>bigquery_dts_pool</code>이라는 별도 슬롯 풀을 구성하고, DTS 트랜스퍼 태스크에 이 풀을 매핑했다. 슬롯 풀의 크기로 동시 실행 수를 제어한다.</p><h3 class="relative group">빈 소스 경로 감지<div id=빈-소스-경로-감지 class=anchor></div><span class="absolute top-0 w-6 transition-opacity opacity-0 -start-6 not-prose group-hover:opacity-100 select-none"><a class="text-primary-300 dark:text-neutral-700 !no-underline" href=#%eb%b9%88-%ec%86%8c%ec%8a%a4-%ea%b2%bd%eb%a1%9c-%ea%b0%90%ec%a7%80 aria-label=앵커>#</a></span></h3><p><strong>문제:</strong> S3 소스 경로에 파일이 없는 경우(사용자 설정 실수 등), DTS 트랜스퍼가 에러 없이 성공으로 처리됐다. BigQuery에는 테이블 이름만 생성되고 데이터는 비어 있는 상태가 된다. 작업자는 성공했다고 생각하지만 실제로는 데이터가 없다.</p><p>이건 DTS 자체의 동작이다. 소스 경로에 파일이 없으면 로드할 것이 없으니 &ldquo;할 일을 다 했다"고 판단하고 성공을 반환한다.</p><p><strong>대응:</strong> 소스 경로에 파일이 없는 것과 잡이 실패하는 것을 구분하기 위해 <code>AirflowSkipException</code>을 레이즈하도록 구성했다. 파일이 없으면 태스크가 skip 상태가 되어, 성공과 실패 어느 쪽도 아닌 &ldquo;건너뜀"으로 표시된다.</p><p>여기서 한 가지 어려움이 있었다. DTS의 TransferRun 응답 객체에는 &ldquo;소스에 파일이 없었다"는 정보가 담겨 있지 않다. 이 정보는 GCP의 로깅 서비스에만 기록된다. Airflow의 Google Cloud Provider에는 GCP 로깅 클라이언트 연동 훅이 제공되지 않아서, 커스텀 훅을 구현해서 GCP 로깅 API로부터 관련 로그를 추출하는 방식으로 처리했다.</p><h3 class="relative group">타임존 처리<div id=타임존-처리 class=anchor></div><span class="absolute top-0 w-6 transition-opacity opacity-0 -start-6 not-prose group-hover:opacity-100 select-none"><a class="text-primary-300 dark:text-neutral-700 !no-underline" href=#%ed%83%80%ec%9e%84%ec%a1%b4-%ec%b2%98%eb%a6%ac aria-label=앵커>#</a></span></h3><p>DTS의 스케줄링 타임존과 Airflow의 타임존이 다를 수 있다. Airflow가 KST로 동작하는데 DTS가 UTC로 트랜스퍼를 생성하면 날짜가 어긋난다.</p><p>이 부분은 초기 구현부터 timezone 보정 인자를 제공하고 있었지만, 사용자에게 가이드가 부족했다. UTC/KST 기준에 대한 안내를 위키 문서에 추가했다.</p><hr><h2 class="relative group">파티션 매핑<div id=파티션-매핑 class=anchor></div><span class="absolute top-0 w-6 transition-opacity opacity-0 -start-6 not-prose group-hover:opacity-100 select-none"><a class="text-primary-300 dark:text-neutral-700 !no-underline" href=#%ed%8c%8c%ed%8b%b0%ec%85%98-%eb%a7%a4%ed%95%91 aria-label=앵커>#</a></span></h2><p>S3의 Hive 테이블과 BigQuery 테이블의 파티션 구조가 다르다는 점도 처리해야 했다.</p><p>BigQuery 테이블은 최대 1개의 파티션 필드만 지원한다. 하지만 S3의 Hive 테이블 중에는 <code>LOG_DATE</code>와 <code>LOG_HOUR</code> 두 단계로 파티션된 것이 있다. 이런 테이블은 BigQuery의 pseudo column인 <code>_PARTITIONTIME</code>으로 매핑했다.</p><p>예를 들어 <code>dt=2022-08-15/hour=3</code>으로 파티션된 데이터는 <code>_PARTITIONTIME$2022081503</code> 파티션에 들어간다. <code>_PARTITIONTIME</code>이 datetime 타입이므로 날짜와 시간을 하나의 필드로 합쳐서 표현할 수 있다.</p><hr><h2 class="relative group">WRITE_APPEND 모드 고려<div id=write_append-모드-고려 class=anchor></div><span class="absolute top-0 w-6 transition-opacity opacity-0 -start-6 not-prose group-hover:opacity-100 select-none"><a class="text-primary-300 dark:text-neutral-700 !no-underline" href=#write_append-%eb%aa%a8%eb%93%9c-%ea%b3%a0%eb%a0%a4 aria-label=앵커>#</a></span></h2><p>기본 모드인 <code>WRITE_TRUNCATE</code>는 멱등성이 보장되지만, <code>WRITE_APPEND</code> 모드를 사용해야 하는 경우도 있다. 이력을 누적해야 하는 테이블이 그렇다.</p><p><code>WRITE_APPEND</code>에서는 재실행 시 데이터가 중복된다. 멱등성을 보장하려면 DTS 트랜스퍼 객체를 삭제하지 않고 유지하는 방식으로 수정해야 한다. 같은 트랜스퍼 객체의 같은 실행은 중복 적재되지 않기 때문이다. 이 부분은 별도 검토 대상으로 분리했다.</p><hr><h2 class="relative group">배운 것<div id=배운-것 class=anchor></div><span class="absolute top-0 w-6 transition-opacity opacity-0 -start-6 not-prose group-hover:opacity-100 select-none"><a class="text-primary-300 dark:text-neutral-700 !no-underline" href=#%eb%b0%b0%ec%9a%b4-%ea%b2%83 aria-label=앵커>#</a></span></h2><p><strong>스케줄링은 한곳에서 관리해야 한다.</strong> DTS 자체 스케줄링과 Airflow 스케줄링이 분리되면, 실패 감지, 재시도, 의존성 관리가 모두 이중으로 필요해진다. 매 배치마다 트랜스퍼를 생성하고 삭제하는 구조가 복잡해 보이지만, 운영 측면에서는 가장 단순하다.</p><p><strong>DTS의 &ldquo;성공"을 맹신하지 말자.</strong> 소스에 파일이 없어도 DTS는 성공을 반환한다. &ldquo;성공 = 데이터가 적재됨"이라는 가정은 위험하다. 실제로 데이터가 있는지 별도 검증이 필요하다.</p><p><strong>쿼터 제한은 클라이언트 쪽에서 제어하는 게 낫다.</strong> BigQuery 쪽에 쿼터 증설을 요청할 수도 있지만, 증설 후에도 더 많은 테이블이 추가되면 다시 한계에 부딪힌다. Airflow 슬롯 풀로 동시 실행 수를 직접 제어하면 쿼터 범위 안에서 안정적으로 운영할 수 있다.</p><p><strong>사용자 피드백은 설계를 완성한다.</strong> 초기 구현은 &ldquo;D-1 파티션 1개 적재"만 고려했다. 실제 사용자가 23개 테이블을 이관하면서 멀티데이 lookback, 동시 실행 제한, 빈 경로 감지 등 운영에서만 드러나는 요구사항이 나왔다. 프레임워크는 실사용 피드백 없이 완성될 수 없다.</p><p><strong>참고 자료:</strong></p><ul><li><a href=https://cloud.google.com/bigquery/pricing#bqdts target=_blank rel=noreferrer>BigQuery Data Transfer Service Pricing</a></li><li><a href=https://cloud.google.com/bigquery/docs/loading-data target=_blank rel=noreferrer>BigQuery: Introduction to Loading Data</a></li><li><a href=https://cloud.google.com/bigquery/docs/batch-loading-data target=_blank rel=noreferrer>BigQuery: Batch Loading Data</a></li><li><a href=https://cloud.google.com/bigquery/quotas#load_jobs target=_blank rel=noreferrer>BigQuery Quotas: Load Jobs</a></li><li><a href=https://airflow.apache.org/docs/apache-airflow-providers-google/stable/operators/cloud/bigquery_dts.html target=_blank rel=noreferrer>Airflow: Google Cloud BigQuery DTS Operators</a></li></ul></div><section class="flex flex-row flex-wrap justify-center pt-4 text-xl"><a target=_blank class="m-1 rounded bg-neutral-300 p-1.5 text-neutral-700 hover:bg-primary-500 hover:text-neutral dark:bg-neutral-700 dark:text-neutral-300 dark:hover:bg-primary-400 dark:hover:text-neutral-800" href="https://www.linkedin.com/shareArticle?mini=true&amp;url=https://nanta-data.dev/posts/bigquery-data-transfer-airflow/&amp;title=BigQuery%20Data%20Transfer%ec%99%80%20Airflow%20%ed%86%b5%ed%95%a9:%20%eb%a7%a4%20%eb%b0%b0%ec%b9%98%eb%a7%88%eb%8b%a4%20%ed%8a%b8%eb%9e%9c%ec%8a%a4%ed%8d%bc%eb%a5%bc%20%ec%83%9d%ec%84%b1%ed%95%98%ea%b3%a0%20%ec%82%ad%ec%a0%9c%ed%95%98%eb%8a%94%20%ec%9d%b4%ec%9c%a0" title="LinkedIn에서 공유" aria-label="LinkedIn에서 공유"><span class="relative block icon"><svg viewBox="0 0 448 512"><path fill="currentColor" d="M416 32H31.9C14.3 32 0 46.5.0 64.3v383.4C0 465.5 14.3 480 31.9 480H416c17.6.0 32-14.5 32-32.3V64.3c0-17.8-14.4-32.3-32-32.3zM135.4 416H69V202.2h66.5V416zm-33.2-243c-21.3.0-38.5-17.3-38.5-38.5S80.9 96 102.2 96c21.2.0 38.5 17.3 38.5 38.5.0 21.3-17.2 38.5-38.5 38.5zm282.1 243h-66.4V312c0-24.8-.5-56.7-34.5-56.7-34.6.0-39.9 27-39.9 54.9V416h-66.4V202.2h63.7v29.2h.9c8.9-16.8 30.6-34.5 62.9-34.5 67.2.0 79.7 44.3 79.7 101.9V416z"/></svg>
</span></a><a target=_blank class="m-1 rounded bg-neutral-300 p-1.5 text-neutral-700 hover:bg-primary-500 hover:text-neutral dark:bg-neutral-700 dark:text-neutral-300 dark:hover:bg-primary-400 dark:hover:text-neutral-800" href="https://reddit.com/submit/?url=https://nanta-data.dev/posts/bigquery-data-transfer-airflow/&amp;resubmit=true&amp;title=BigQuery%20Data%20Transfer%ec%99%80%20Airflow%20%ed%86%b5%ed%95%a9:%20%eb%a7%a4%20%eb%b0%b0%ec%b9%98%eb%a7%88%eb%8b%a4%20%ed%8a%b8%eb%9e%9c%ec%8a%a4%ed%8d%bc%eb%a5%bc%20%ec%83%9d%ec%84%b1%ed%95%98%ea%b3%a0%20%ec%82%ad%ec%a0%9c%ed%95%98%eb%8a%94%20%ec%9d%b4%ec%9c%a0" title="Reddit에 게시" aria-label="Reddit에 게시"><span class="relative block icon"><svg viewBox="0 0 512 512"><path fill="currentColor" d="M201.5 305.5c-13.8.0-24.9-11.1-24.9-24.6.0-13.8 11.1-24.9 24.9-24.9 13.6.0 24.6 11.1 24.6 24.9.0 13.6-11.1 24.6-24.6 24.6zM504 256c0 137-111 248-248 248S8 393 8 256 119 8 256 8s248 111 248 248zm-132.3-41.2c-9.4.0-17.7 3.9-23.8 10-22.4-15.5-52.6-25.5-86.1-26.6l17.4-78.3 55.4 12.5c0 13.6 11.1 24.6 24.6 24.6 13.8.0 24.9-11.3 24.9-24.9s-11.1-24.9-24.9-24.9c-9.7.0-18 5.8-22.1 13.8l-61.2-13.6c-3-.8-6.1 1.4-6.9 4.4l-19.1 86.4c-33.2 1.4-63.1 11.3-85.5 26.8-6.1-6.4-14.7-10.2-24.1-10.2-34.9.0-46.3 46.9-14.4 62.8-1.1 5-1.7 10.2-1.7 15.5.0 52.6 59.2 95.2 132 95.2 73.1.0 132.3-42.6 132.3-95.2.0-5.3-.6-10.8-1.9-15.8 31.3-16 19.8-62.5-14.9-62.5zM302.8 331c-18.2 18.2-76.1 17.9-93.6.0-2.2-2.2-6.1-2.2-8.3.0-2.5 2.5-2.5 6.4.0 8.6 22.8 22.8 87.3 22.8 110.2.0 2.5-2.2 2.5-6.1.0-8.6-2.2-2.2-6.1-2.2-8.3.0zm7.7-75c-13.6.0-24.6 11.1-24.6 24.9.0 13.6 11.1 24.6 24.6 24.6 13.8.0 24.9-11.1 24.9-24.6.0-13.8-11-24.9-24.9-24.9z"/></svg>
</span></a><a target=_blank class="m-1 rounded bg-neutral-300 p-1.5 text-neutral-700 hover:bg-primary-500 hover:text-neutral dark:bg-neutral-700 dark:text-neutral-300 dark:hover:bg-primary-400 dark:hover:text-neutral-800" href="mailto:?body=https://nanta-data.dev/posts/bigquery-data-transfer-airflow/&amp;subject=BigQuery%20Data%20Transfer%ec%99%80%20Airflow%20%ed%86%b5%ed%95%a9:%20%eb%a7%a4%20%eb%b0%b0%ec%b9%98%eb%a7%88%eb%8b%a4%20%ed%8a%b8%eb%9e%9c%ec%8a%a4%ed%8d%bc%eb%a5%bc%20%ec%83%9d%ec%84%b1%ed%95%98%ea%b3%a0%20%ec%82%ad%ec%a0%9c%ed%95%98%eb%8a%94%20%ec%9d%b4%ec%9c%a0" title="이메일로 전송" aria-label="이메일로 전송"><span class="relative block icon"><svg viewBox="0 0 512 512"><path fill="currentColor" d="M207.8 20.73c-93.45 18.32-168.7 93.66-187 187.1-27.64 140.9 68.65 266.2 199.1 285.1 19.01 2.888 36.17-12.26 36.17-31.49l1e-4-.6631c0-15.74-11.44-28.88-26.84-31.24-84.35-12.98-149.2-86.13-149.2-174.2.0-102.9 88.61-185.5 193.4-175.4 91.54 8.869 158.6 91.25 158.6 183.2v16.16c0 22.09-17.94 40.05-40 40.05s-40.01-17.96-40.01-40.05v-120.1c0-8.847-7.161-16.02-16.01-16.02l-31.98.0036c-7.299.0-13.2 4.992-15.12 11.68-24.85-12.15-54.24-16.38-86.06-5.106-38.75 13.73-68.12 48.91-73.72 89.64-9.483 69.01 43.81 128 110.9 128 26.44.0 50.43-9.544 69.59-24.88 24 31.3 65.23 48.69 109.4 37.49C465.2 369.3 496 324.1 495.1 277.2V256.3c0-149.2-133.9-265.632-287.3-235.57zM239.1 304.3c-26.47.0-48-21.56-48-48.05s21.53-48.05 48-48.05 48 21.56 48 48.05-20.6 48.05-48 48.05z"/></svg></span></a></section></div></section><footer class="pt-8 max-w-prose print:hidden"><div class=pt-8><hr class="border-dotted border-neutral-300 dark:border-neutral-600"><div class="flex justify-between pt-3"><span class="flex flex-col"><a class="flex text-neutral-700 hover:text-primary-600 dark:text-neutral dark:hover:text-primary-400" href=/posts/eks-topology-aware-hints/><span class=leading-6><span class="inline-block rtl:rotate-180">&larr;</span>&ensp;EKS Topology Aware Hint 적용 검토: 우리 클러스터에서는 의미 없었던 이유
</span></a><span class="ms-6 mt-1 text-xs text-neutral-500 dark:text-neutral-400"><time datetime=2026-02-27T00:00:00+00:00>2026년 2월 27일</time>
</span></span><span class="flex flex-col items-end"></span></div></div></footer></article><div id=scroll-to-top class="fixed bottom-6 end-6 z-50 transform translate-y-4 opacity-0 duration-200"><a href=#the-top class="pointer-events-auto flex h-12 w-12 items-center justify-center rounded-full bg-neutral/50 text-xl text-neutral-700 hover:text-primary-600 dark:bg-neutral-800/50 dark:text-neutral dark:hover:text-primary-400" aria-label="맨 위로 스크롤" title="맨 위로 스크롤">&uarr;</a></div></main><footer id=site-footer class="py-10 print:hidden"><div class="flex items-center justify-between text-sm text-neutral-500 dark:text-neutral-400"><nav><ul class="flex list-none flex-row"><li class="me-4 last:me-0"><a class="decoration-primary-500 hover:underline hover:decoration-2 hover:underline-offset-2 flex items-center" href=/privacy-policy/ title=개인정보처리방침>개인정보처리방침</a></li></ul></nav><p>&copy;
2026
nanta</p></div><script>mediumZoom(document.querySelectorAll("img:not(.nozoom)"),{margin:24,background:"rgba(0,0,0,0.5)",scrollOffset:0})</script></footer><div id=search-wrapper class="invisible fixed inset-0 flex h-screen w-screen cursor-default flex-col bg-neutral-500/50 p-4 backdrop-blur-sm dark:bg-neutral-900/50 sm:p-6 md:p-[10vh] lg:p-[12vh] z-500" data-url=https://nanta-data.dev/><div id=search-modal class="flex flex-col w-full max-w-3xl min-h-0 mx-auto border rounded-md shadow-lg top-20 border-neutral-200 bg-neutral dark:border-neutral-700 dark:bg-neutral-800"><header class="relative z-10 flex items-center justify-between flex-none px-2"><form class="flex items-center flex-auto min-w-0"><div class="flex items-center justify-center w-8 h-8 text-neutral-400"><span class="relative block icon"><svg aria-hidden="true" focusable="false" data-prefix="fas" data-icon="search" class="svg-inline--fa fa-search fa-w-16" role="img" viewBox="0 0 512 512"><path fill="currentColor" d="M505 442.7 405.3 343c-4.5-4.5-10.6-7-17-7H372c27.6-35.3 44-79.7 44-128C416 93.1 322.9.0 208 0S0 93.1.0 208s93.1 208 208 208c48.3.0 92.7-16.4 128-44v16.3c0 6.4 2.5 12.5 7 17l99.7 99.7c9.4 9.4 24.6 9.4 33.9.0l28.3-28.3c9.4-9.4 9.4-24.6.1-34zM208 336c-70.7.0-128-57.2-128-128 0-70.7 57.2-128 128-128 70.7.0 128 57.2 128 128 0 70.7-57.2 128-128 128z"/></svg></span></div><input type=search id=search-query class="flex flex-auto h-12 mx-1 bg-transparent appearance-none focus:outline-dotted focus:outline-2 focus:outline-transparent" placeholder=검색 tabindex=0></form><button id=close-search-button class="flex items-center justify-center w-8 h-8 text-neutral-700 hover:text-primary-600 dark:text-neutral dark:hover:text-primary-400" title="닫기 (Esc)">
<span class="relative block icon"><svg viewBox="0 0 320 512"><path fill="currentColor" d="M310.6 361.4c12.5 12.5 12.5 32.75.0 45.25C304.4 412.9 296.2 416 288 416s-16.38-3.125-22.62-9.375L160 301.3 54.63 406.6C48.38 412.9 40.19 416 32 416S15.63 412.9 9.375 406.6c-12.5-12.5-12.5-32.75.0-45.25l105.4-105.4L9.375 150.6c-12.5-12.5-12.5-32.75.0-45.25s32.75-12.5 45.25.0L160 210.8l105.4-105.4c12.5-12.5 32.75-12.5 45.25.0s12.5 32.75.0 45.25l-105.4 105.4L310.6 361.4z"/></svg></span></button></header><section class="flex-auto px-2 overflow-auto"><ul id=search-results></ul></section></div></div></div></body></html>