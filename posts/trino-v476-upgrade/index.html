<!doctype html><html lang=ko dir=ltr class=scroll-smooth data-default-appearance=dark data-auto-appearance=true><head><meta charset=utf-8><meta http-equiv=content-language content="ko"><meta name=viewport content="width=device-width,initial-scale=1"><meta http-equiv=X-UA-Compatible content="ie=edge"><meta name=theme-color><title>Trino v451에서 v476으로: 25개 버전을 건너뛴 운영 클러스터 업그레이드 &#183; nanta - 데이터 엔지니어링</title><meta name=title content="Trino v451에서 v476으로: 25개 버전을 건너뛴 운영 클러스터 업그레이드 &#183; nanta - 데이터 엔지니어링"><meta name=description content="Trino를 v451에서 v476으로 업그레이드했다. Blue/Green 배포로 OLAP 클러스터부터 점진 적용하는 과정에서 Materialized View 리그레션과 Parquet 읽기 리그레션을 발견했다. 바이너리 서치로 원인 버전을 v469로 좁히고, 커밋 단위 리버트로 원인 PR을 특정해서 커뮤니티에 이슈를 올렸더니 하루 만에 픽스가 나왔다."><meta name=keywords content="trino,upgrade,kubernetes,blue-green,parquet,iceberg,java,"><link rel=canonical href=https://nanta-data.dev/posts/trino-v476-upgrade/><meta name=author content="nanta"><link href=https://github.com/NhoSW rel=me><meta property="og:url" content="https://nanta-data.dev/posts/trino-v476-upgrade/"><meta property="og:site_name" content="nanta - 데이터 엔지니어링"><meta property="og:title" content="Trino v451에서 v476으로: 25개 버전을 건너뛴 운영 클러스터 업그레이드"><meta property="og:description" content="Trino를 v451에서 v476으로 업그레이드했다. Blue/Green 배포로 OLAP 클러스터부터 점진 적용하는 과정에서 Materialized View 리그레션과 Parquet 읽기 리그레션을 발견했다. 바이너리 서치로 원인 버전을 v469로 좁히고, 커밋 단위 리버트로 원인 PR을 특정해서 커뮤니티에 이슈를 올렸더니 하루 만에 픽스가 나왔다."><meta property="og:locale" content="ko"><meta property="og:type" content="article"><meta property="article:section" content="posts"><meta property="article:published_time" content="2026-02-27T00:00:00+00:00"><meta property="article:modified_time" content="2026-02-27T00:00:00+00:00"><meta property="article:tag" content="Trino"><meta property="article:tag" content="Upgrade"><meta property="article:tag" content="Kubernetes"><meta property="article:tag" content="Blue-Green"><meta property="article:tag" content="Parquet"><meta property="article:tag" content="Iceberg"><meta name=twitter:card content="summary"><meta name=twitter:title content="Trino v451에서 v476으로: 25개 버전을 건너뛴 운영 클러스터 업그레이드"><meta name=twitter:description content="Trino를 v451에서 v476으로 업그레이드했다. Blue/Green 배포로 OLAP 클러스터부터 점진 적용하는 과정에서 Materialized View 리그레션과 Parquet 읽기 리그레션을 발견했다. 바이너리 서치로 원인 버전을 v469로 좁히고, 커밋 단위 리버트로 원인 PR을 특정해서 커뮤니티에 이슈를 올렸더니 하루 만에 픽스가 나왔다."><link type=text/css rel=stylesheet href=/css/main.bundle.min.c14e86e0d9a09802d254d2a15c05847ae65bfc2e98c2166fabc67369d2d7f2eae6c1da03bbba58cfd41a4af802147c75ce9fdc11dd724ac627ab2903942cbb79.css integrity="sha512-wU6G4NmgmALSVNKhXAWEeuZb/C6YwhZvq8ZzadLX8urmwdoDu7pYz9QaSvgCFHx1zp/cEd1ySsYnqykDlCy7eQ=="><script type=text/javascript src=/js/appearance.min.6f41174b3a05b680820fe08cadbfa5fb7a7ca347b76a0955cdc68b9d8aca1ce24f0547e138cea33bcc7904d551a90afcb1cc7f2d9fe8557075d501419046c08c.js integrity="sha512-b0EXSzoFtoCCD+CMrb+l+3p8o0e3aglVzcaLnYrKHOJPBUfhOM6jO8x5BNVRqQr8scx/LZ/oVXB11QFBkEbAjA=="></script><script src=/lib/zoom/zoom.min.umd.a527109b68c082a70f3697716dd72a9d5aa8b545cf800cecbbc7399f2ca6f6e0ce3e431f2062b48bbfa47c9ea42822714060bef309be073f49b9c0e30d318d7b.js integrity="sha512-pScQm2jAgqcPNpdxbdcqnVqotUXPgAzsu8c5nyym9uDOPkMfIGK0i7+kfJ6kKCJxQGC+8wm+Bz9JucDjDTGNew=="></script><script defer type=text/javascript id=script-bundle src=/js/main.bundle.min.bdda7dece6cbaf08deef7d254f7f842f3261c2524d247905127c9a20decc03f1011a2950048464c79272c1ce0705a49a41147f39f2b95163bb71d404b33263ef.js integrity="sha512-vdp97ObLrwje730lT3+ELzJhwlJNJHkFEnyaIN7MA/EBGilQBIRkx5Jywc4HBaSaQRR/OfK5UWO7cdQEszJj7w==" data-copy=복사 data-copied=복사되었습니다></script><link rel=apple-touch-icon sizes=180x180 href=/apple-touch-icon.png><link rel=icon type=image/png sizes=32x32 href=/favicon-32x32.png><link rel=icon type=image/png sizes=16x16 href=/favicon-16x16.png><link rel=manifest href=/site.webmanifest><script type=application/ld+json>[{"@context":"https://schema.org","@type":"Article","articleSection":"글 목록","name":"Trino v451에서 v476으로: 25개 버전을 건너뛴 운영 클러스터 업그레이드","headline":"Trino v451에서 v476으로: 25개 버전을 건너뛴 운영 클러스터 업그레이드","inLanguage":"ko","url":"https://nanta-data.dev/posts/trino-v476-upgrade/","author":{"@type":"Person","name":"nanta"},"copyrightYear":"2026","dateCreated":"2026-02-27T00:00:00\u002b00:00","datePublished":"2026-02-27T00:00:00\u002b00:00","dateModified":"2026-02-27T00:00:00\u002b00:00","keywords":["trino","upgrade","kubernetes","blue-green","parquet","iceberg","java"],"mainEntityOfPage":"true","wordCount":"1431"}]</script><link rel=preconnect href=https://cdn.jsdelivr.net crossorigin><link href=https://cdn.jsdelivr.net/npm/geist@1.3.1/dist/fonts/geist-sans/style.min.css rel=stylesheet><link href=https://cdn.jsdelivr.net/npm/geist@1.3.1/dist/fonts/geist-mono/style.min.css rel=stylesheet></head><body class="flex flex-col h-screen m-auto leading-7 max-w-7xl px-6 sm:px-14 md:px-24 lg:px-32 text-lg bg-neutral text-neutral-900 dark:bg-neutral-800 dark:text-neutral bf-scrollbar"><div id=the-top class="absolute flex self-center"><a class="px-3 py-1 text-sm -translate-y-8 rounded-b-lg bg-primary-200 focus:translate-y-0 dark:bg-neutral-600" href=#main-content><span class="font-bold text-primary-600 pe-2 dark:text-primary-400">&darr;</span>
본문으로 건너뛰기</a></div><div class=min-h-[148px]></div><div class="fixed inset-x-0 z-100"><div id=menu-blur class="absolute opacity-0 inset-x-0 top-0 h-full single_hero_background nozoom backdrop-blur-2xl shadow-2xl bg-neutral/25 dark:bg-neutral-800/25"></div><div class="relative m-auto leading-7 max-w-7xl px-6 sm:px-14 md:px-24 lg:px-32"><div class="main-menu flex items-center w-full gap-2 p-1 pl-0"><a href=/ class="text-base font-medium truncate min-w-0 shrink">nanta - 데이터 엔지니어링</a><div class="flex items-center ms-auto"><div class="hidden md:flex"><nav class="flex items-center gap-x-5 h-12"><a href=/posts/ class="flex items-center bf-icon-color-hover" aria-label="글 목록" title="글 목록"><span class="text-base font-medium break-normal">글 목록
</span></a><a href=/categories/ class="flex items-center bf-icon-color-hover" aria-label=카테고리 title=Categories><span class="text-base font-medium break-normal">카테고리
</span></a><a href=/tags/ class="flex items-center bf-icon-color-hover" aria-label=태그 title=Tags><span class="text-base font-medium break-normal">태그
</span></a><a href=/about/ class="flex items-center bf-icon-color-hover" aria-label=소개 title=소개><span class="text-base font-medium break-normal">소개</span></a><div class="translation nested-menu"><button class="cursor-pointer flex items-center">
<span class=me-1><span class="relative block icon"><svg viewBox="0 0 640 512"><path fill="currentColor" d="M0 128C0 92.7 28.7 64 64 64H256h48 16H576c35.3.0 64 28.7 64 64V384c0 35.3-28.7 64-64 64H320 304 256 64c-35.3.0-64-28.7-64-64V128zm320 0V384H576V128H320zM178.3 175.9c-3.2-7.2-10.4-11.9-18.3-11.9s-15.1 4.7-18.3 11.9l-64 144c-4.5 10.1.1 21.9 10.2 26.4s21.9-.1 26.4-10.2l8.9-20.1h73.6l8.9 20.1c4.5 10.1 16.3 14.6 26.4 10.2s14.6-16.3 10.2-26.4l-64-144zM160 233.2 179 276H141l19-42.8zM448 164c11 0 20 9 20 20v4h44 16c11 0 20 9 20 20s-9 20-20 20h-2l-1.6 4.5c-8.9 24.4-22.4 46.6-39.6 65.4.9.6 1.8 1.1 2.7 1.6l18.9 11.3c9.5 5.7 12.5 18 6.9 27.4s-18 12.5-27.4 6.9L467 333.8c-4.5-2.7-8.8-5.5-13.1-8.5-10.6 7.5-21.9 14-34 19.4l-3.6 1.6c-10.1 4.5-21.9-.1-26.4-10.2s.1-21.9 10.2-26.4l3.6-1.6c6.4-2.9 12.6-6.1 18.5-9.8L410 286.1c-7.8-7.8-7.8-20.5.0-28.3s20.5-7.8 28.3.0l14.6 14.6.5.5c12.4-13.1 22.5-28.3 29.8-45H448 376c-11 0-20-9-20-20s9-20 20-20h52v-4c0-11 9-20 20-20z"/></svg></span>
</span><span class="text-sm font-medium bf-icon-color-hover" title="Trino v451에서 v476으로: 25개 버전을 건너뛴 운영 클러스터 업그레이드">KO</span></button><ul class=menuhide><li class="rounded-xl backdrop-blur shadow-2xl p-2 flex flex-col gap-1"><a href=/posts/trino-v476-upgrade/ class="flex items-center bf-icon-color-hover px-3 py-1"><span class="text-sm font-sm" title="Trino v451에서 v476으로: 25개 버전을 건너뛴 운영 클러스터 업그레이드">한국어
</span></a><a href=/en/posts/trino-v476-upgrade/ class="flex items-center bf-icon-color-hover px-3 py-1"><span class="text-sm font-sm" title="Trino v451 to v476: Upgrading a Production Cluster Across 25 Versions">English</span></a></li></ul></div><button id=search-button aria-label=Search class="text-base bf-icon-color-hover" title="검색하기 (/)">
<span class="relative block icon"><svg aria-hidden="true" focusable="false" data-prefix="fas" data-icon="search" class="svg-inline--fa fa-search fa-w-16" role="img" viewBox="0 0 512 512"><path fill="currentColor" d="M505 442.7 405.3 343c-4.5-4.5-10.6-7-17-7H372c27.6-35.3 44-79.7 44-128C416 93.1 322.9.0 208 0S0 93.1.0 208s93.1 208 208 208c48.3.0 92.7-16.4 128-44v16.3c0 6.4 2.5 12.5 7 17l99.7 99.7c9.4 9.4 24.6 9.4 33.9.0l28.3-28.3c9.4-9.4 9.4-24.6.1-34zM208 336c-70.7.0-128-57.2-128-128 0-70.7 57.2-128 128-128 70.7.0 128 57.2 128 128 0 70.7-57.2 128-128 128z"/></svg></span></button><div class="flex items-center"><button id=appearance-switcher aria-label="Dark mode switcher" type=button class="text-base bf-icon-color-hover"><div class="flex items-center justify-center dark:hidden"><span class="relative block icon"><svg viewBox="0 0 512 512"><path fill="currentColor" d="M32 256C32 132.2 132.3 32 255.8 32c11.36.0 29.7 1.668 40.9 3.746 9.616 1.777 11.75 14.63 3.279 19.44C245 86.5 211.2 144.6 211.2 207.8c0 109.7 99.71 193 208.3 172.3 9.561-1.805 16.28 9.324 10.11 16.95C387.9 448.6 324.8 480 255.8 480 132.1 480 32 379.6 32 256z"/></svg></span></div><div class="items-center justify-center hidden dark:flex"><span class="relative block icon"><svg viewBox="0 0 512 512"><path fill="currentColor" d="M256 159.1c-53.02.0-95.1 42.98-95.1 95.1s41.2 96.9 95.1 96.9 95.1-42.98 95.1-95.1S309 159.1 256 159.1zM509.3 347l-63.2-91.9 63.15-91.01c6.332-9.125 1.104-21.74-9.826-23.72l-109-19.7-19.7-109c-1.975-10.93-14.59-16.16-23.72-9.824L256 65.89 164.1 2.736c-9.125-6.332-21.74-1.107-23.72 9.824L121.6 121.6 12.56 141.3C1.633 143.2-3.596 155.9 2.736 164.1L65.89 256 2.74 347.01c-6.332 9.125-1.105 21.74 9.824 23.72l109 19.7 19.7 109c1.975 10.93 14.59 16.16 23.72 9.824L256 446.1l91.01 63.15c9.127 6.334 21.75 1.107 23.72-9.822l19.7-109 109-19.7C510.4 368.8 515.6 356.1 509.3 347zM256 383.1c-70.69.0-127.1-57.31-127.1-127.1.0-70.69 57.31-127.1 127.1-127.1S383.1 186.2 383.1 256c0 70.7-56.4 127.1-127.1 127.1z"/></svg></span></div></button></div></nav></div><div class="flex md:hidden"><div class="flex items-center h-14 gap-4"><button id=search-button-mobile aria-label=Search class="flex items-center justify-center bf-icon-color-hover" title="검색하기 (/)">
<span class="relative block icon"><svg aria-hidden="true" focusable="false" data-prefix="fas" data-icon="search" class="svg-inline--fa fa-search fa-w-16" role="img" viewBox="0 0 512 512"><path fill="currentColor" d="M505 442.7 405.3 343c-4.5-4.5-10.6-7-17-7H372c27.6-35.3 44-79.7 44-128C416 93.1 322.9.0 208 0S0 93.1.0 208s93.1 208 208 208c48.3.0 92.7-16.4 128-44v16.3c0 6.4 2.5 12.5 7 17l99.7 99.7c9.4 9.4 24.6 9.4 33.9.0l28.3-28.3c9.4-9.4 9.4-24.6.1-34zM208 336c-70.7.0-128-57.2-128-128 0-70.7 57.2-128 128-128 70.7.0 128 57.2 128 128 0 70.7-57.2 128-128 128z"/></svg>
</span></button>
<button id=appearance-switcher-mobile type=button aria-label="Dark mode switcher" class="flex items-center justify-center text-neutral-900 hover:text-primary-600 dark:text-neutral-200 dark:hover:text-primary-400"><div class=dark:hidden><span class="relative block icon"><svg viewBox="0 0 512 512"><path fill="currentColor" d="M32 256C32 132.2 132.3 32 255.8 32c11.36.0 29.7 1.668 40.9 3.746 9.616 1.777 11.75 14.63 3.279 19.44C245 86.5 211.2 144.6 211.2 207.8c0 109.7 99.71 193 208.3 172.3 9.561-1.805 16.28 9.324 10.11 16.95C387.9 448.6 324.8 480 255.8 480 132.1 480 32 379.6 32 256z"/></svg></span></div><div class="hidden dark:block"><span class="relative block icon"><svg viewBox="0 0 512 512"><path fill="currentColor" d="M256 159.1c-53.02.0-95.1 42.98-95.1 95.1s41.2 96.9 95.1 96.9 95.1-42.98 95.1-95.1S309 159.1 256 159.1zM509.3 347l-63.2-91.9 63.15-91.01c6.332-9.125 1.104-21.74-9.826-23.72l-109-19.7-19.7-109c-1.975-10.93-14.59-16.16-23.72-9.824L256 65.89 164.1 2.736c-9.125-6.332-21.74-1.107-23.72 9.824L121.6 121.6 12.56 141.3C1.633 143.2-3.596 155.9 2.736 164.1L65.89 256 2.74 347.01c-6.332 9.125-1.105 21.74 9.824 23.72l109 19.7 19.7 109c1.975 10.93 14.59 16.16 23.72 9.824L256 446.1l91.01 63.15c9.127 6.334 21.75 1.107 23.72-9.822l19.7-109 109-19.7C510.4 368.8 515.6 356.1 509.3 347zM256 383.1c-70.69.0-127.1-57.31-127.1-127.1.0-70.69 57.31-127.1 127.1-127.1S383.1 186.2 383.1 256c0 70.7-56.4 127.1-127.1 127.1z"/></svg></span></div></button>
<input type=checkbox id=mobile-menu-toggle autocomplete=off class="hidden peer">
<label for=mobile-menu-toggle class="flex items-center justify-center cursor-pointer bf-icon-color-hover"><span class="relative block icon"><svg viewBox="0 0 448 512"><path fill="currentColor" d="M0 96C0 78.33 14.33 64 32 64H416c17.7.0 32 14.33 32 32 0 17.7-14.3 32-32 32H32C14.33 128 0 113.7.0 96zM0 256c0-17.7 14.33-32 32-32H416c17.7.0 32 14.3 32 32s-14.3 32-32 32H32c-17.67.0-32-14.3-32-32zM416 448H32c-17.67.0-32-14.3-32-32s14.33-32 32-32H416c17.7.0 32 14.3 32 32s-14.3 32-32 32z"/></svg></span></label><div role=dialog aria-modal=true style=scrollbar-gutter:stable class="fixed inset-0 z-50 invisible overflow-y-auto px-6 py-20 opacity-0 transition-[opacity,visibility] duration-300 peer-checked:visible peer-checked:opacity-100 bg-neutral-50/97 dark:bg-neutral-900/99
bf-scrollbar"><label for=mobile-menu-toggle class="fixed end-8 top-5 flex items-center justify-center z-50 h-12 w-12 cursor-pointer select-none rounded-full bf-icon-color-hover border bf-border-color bf-border-color-hover bg-neutral-50 dark:bg-neutral-900"><span class="relative block icon"><svg viewBox="0 0 320 512"><path fill="currentColor" d="M310.6 361.4c12.5 12.5 12.5 32.75.0 45.25C304.4 412.9 296.2 416 288 416s-16.38-3.125-22.62-9.375L160 301.3 54.63 406.6C48.38 412.9 40.19 416 32 416S15.63 412.9 9.375 406.6c-12.5-12.5-12.5-32.75.0-45.25l105.4-105.4L9.375 150.6c-12.5-12.5-12.5-32.75.0-45.25s32.75-12.5 45.25.0L160 210.8l105.4-105.4c12.5-12.5 32.75-12.5 45.25.0s12.5 32.75.0 45.25l-105.4 105.4L310.6 361.4z"/></svg></span></label><nav class="mx-auto max-w-md space-y-6"><div class=px-2><a href=/posts/ aria-label="글 목록" class="flex items-center gap-4 group bf-icon-color-hover text-neutral-700 dark:text-neutral-200"><span title="글 목록" class="text-2xl font-bold tracking-tight">글 목록</span></a></div><div class=px-2><a href=/categories/ aria-label=카테고리 class="flex items-center gap-4 group bf-icon-color-hover text-neutral-700 dark:text-neutral-200"><span title=Categories class="text-2xl font-bold tracking-tight">카테고리</span></a></div><div class=px-2><a href=/tags/ aria-label=태그 class="flex items-center gap-4 group bf-icon-color-hover text-neutral-700 dark:text-neutral-200"><span title=Tags class="text-2xl font-bold tracking-tight">태그</span></a></div><div class=px-2><a href=/about/ aria-label=소개 class="flex items-center gap-4 group bf-icon-color-hover text-neutral-700 dark:text-neutral-200"><span title=소개 class="text-2xl font-bold tracking-tight">소개</span></a></div><div class="flex flex-wrap items-center [&_span]:text-2xl [&_.translation_button_.icon]:text-4xl! [&_.translation_button_span]:text-base! [&_.translation_.menuhide_span]:text-sm! gap-x-6 ps-2 mt-8 pt-8 border-t bf-border-color"><div class="translation nested-menu"><button class="cursor-pointer flex items-center">
<span class=me-1><span class="relative block icon"><svg viewBox="0 0 640 512"><path fill="currentColor" d="M0 128C0 92.7 28.7 64 64 64H256h48 16H576c35.3.0 64 28.7 64 64V384c0 35.3-28.7 64-64 64H320 304 256 64c-35.3.0-64-28.7-64-64V128zm320 0V384H576V128H320zM178.3 175.9c-3.2-7.2-10.4-11.9-18.3-11.9s-15.1 4.7-18.3 11.9l-64 144c-4.5 10.1.1 21.9 10.2 26.4s21.9-.1 26.4-10.2l8.9-20.1h73.6l8.9 20.1c4.5 10.1 16.3 14.6 26.4 10.2s14.6-16.3 10.2-26.4l-64-144zM160 233.2 179 276H141l19-42.8zM448 164c11 0 20 9 20 20v4h44 16c11 0 20 9 20 20s-9 20-20 20h-2l-1.6 4.5c-8.9 24.4-22.4 46.6-39.6 65.4.9.6 1.8 1.1 2.7 1.6l18.9 11.3c9.5 5.7 12.5 18 6.9 27.4s-18 12.5-27.4 6.9L467 333.8c-4.5-2.7-8.8-5.5-13.1-8.5-10.6 7.5-21.9 14-34 19.4l-3.6 1.6c-10.1 4.5-21.9-.1-26.4-10.2s.1-21.9 10.2-26.4l3.6-1.6c6.4-2.9 12.6-6.1 18.5-9.8L410 286.1c-7.8-7.8-7.8-20.5.0-28.3s20.5-7.8 28.3.0l14.6 14.6.5.5c12.4-13.1 22.5-28.3 29.8-45H448 376c-11 0-20-9-20-20s9-20 20-20h52v-4c0-11 9-20 20-20z"/></svg></span>
</span><span class="text-sm font-medium bf-icon-color-hover" title="Trino v451에서 v476으로: 25개 버전을 건너뛴 운영 클러스터 업그레이드">KO</span></button><ul class=menuhide><li class="rounded-xl backdrop-blur shadow-2xl p-2 flex flex-col gap-1"><a href=/posts/trino-v476-upgrade/ class="flex items-center bf-icon-color-hover px-3 py-1"><span class="text-sm font-sm" title="Trino v451에서 v476으로: 25개 버전을 건너뛴 운영 클러스터 업그레이드">한국어
</span></a><a href=/en/posts/trino-v476-upgrade/ class="flex items-center bf-icon-color-hover px-3 py-1"><span class="text-sm font-sm" title="Trino v451 to v476: Upgrading a Production Cluster Across 25 Versions">English</span></a></li></ul></div></div></nav></div></div></div></div></div></div></div><script type=text/javascript src=/js/background-blur.min.605b3b942818f0ab5a717ae446135ec46b8ee5a2ad12ae56fb90dc2a76ce30c388f9fec8bcc18db15bd47e3fa8a09d779fa12aa9c184cf614a315bc72c6c163d.js integrity="sha512-YFs7lCgY8KtacXrkRhNexGuO5aKtEq5W+5DcKnbOMMOI+f7IvMGNsVvUfj+ooJ13n6EqqcGEz2FKMVvHLGwWPQ==" data-blur-id=menu-blur></script><div class="relative flex flex-col grow"><main id=main-content class=grow><article><header id=single_header class="mt-5 max-w-prose"><ol class="text-sm text-neutral-500 dark:text-neutral-400 print:hidden"><li class=hidden><a class="hover:underline decoration-neutral-300 dark:underline-neutral-600" href=/>nanta - 데이터 엔지니어링</a><span class="px-1 text-primary-500">/</span></li><li class=inline><a class="hover:underline decoration-neutral-300 dark:underline-neutral-600" href=/posts/>글 목록</a><span class="px-1 text-primary-500">/</span></li><li class=hidden><a class="hover:underline decoration-neutral-300 dark:underline-neutral-600" href=/posts/trino-v476-upgrade/>Trino v451에서 v476으로: 25개 버전을 건너뛴 운영 클러스터 업그레이드</a><span class="px-1 text-primary-500">/</span></li></ol><h1 class="mt-0 text-4xl font-extrabold text-neutral-900 dark:text-neutral">Trino v451에서 v476으로: 25개 버전을 건너뛴 운영 클러스터 업그레이드</h1><div class="mt-1 mb-6 text-base text-neutral-500 dark:text-neutral-400 print:hidden"><div class="flex flex-row flex-wrap items-center"><time datetime=2026-02-27T00:00:00+00:00>2026년 2월 27일</time><span class="px-2 text-primary-500">&#183;</span><span title="읽는 시간">7 분</span></div></div><div class="flex author"><div class=place-self-center><div class="text-[0.6rem] uppercase leading-3 text-neutral-500 dark:text-neutral-400">작성자</div><div class="font-semibold leading-6 text-neutral-800 dark:text-neutral-300">nanta</div><div class="text-sm text-neutral-700 dark:text-neutral-400">Apache Kafka, Airflow, Trino, StarRocks 등 데이터 엔지니어링과 모던 데이터 인프라에 대한 실무 경험을 공유하는 블로그입니다.</div><div class="text-2xl sm:text-lg"><div class="flex flex-wrap text-neutral-400 dark:text-neutral-500"><a class="px-1 hover:text-primary-700 dark:hover:text-primary-400" href=https://github.com/NhoSW target=_blank aria-label=Github title=Github rel="me noopener noreferrer"><span class="inline-block align-text-bottom"><span class="relative block icon"><svg viewBox="0 0 496 512"><path fill="currentColor" d="M165.9 397.4c0 2-2.3 3.6-5.2 3.6-3.3.3-5.6-1.3-5.6-3.6.0-2 2.3-3.6 5.2-3.6 3-.3 5.6 1.3 5.6 3.6zm-31.1-4.5c-.7 2 1.3 4.3 4.3 4.9 2.6 1 5.6.0 6.2-2s-1.3-4.3-4.3-5.2c-2.6-.7-5.5.3-6.2 2.3zm44.2-1.7c-2.9.7-4.9 2.6-4.6 4.9.3 2 2.9 3.3 5.9 2.6 2.9-.7 4.9-2.6 4.6-4.6-.3-1.9-3-3.2-5.9-2.9zM244.8 8C106.1 8 0 113.3.0 252c0 110.9 69.8 205.8 169.5 239.2 12.8 2.3 17.3-5.6 17.3-12.1.0-6.2-.3-40.4-.3-61.4.0.0-70 15-84.7-29.8.0.0-11.4-29.1-27.8-36.6.0.0-22.9-15.7 1.6-15.4.0.0 24.9 2 38.6 25.8 21.9 38.6 58.6 27.5 72.9 20.9 2.3-16 8.8-27.1 16-33.7-55.9-6.2-112.3-14.3-112.3-110.5.0-27.5 7.6-41.3 23.6-58.9-2.6-6.5-11.1-33.3 2.6-67.9 20.9-6.5 69 27 69 27 20-5.6 41.5-8.5 62.8-8.5s42.8 2.9 62.8 8.5c0 0 48.1-33.6 69-27 13.7 34.7 5.2 61.4 2.6 67.9 16 17.7 25.8 31.5 25.8 58.9.0 96.5-58.9 104.2-114.8 110.5 9.2 7.9 17 22.9 17 46.4.0 33.7-.3 75.4-.3 83.6.0 6.5 4.6 14.4 17.3 12.1C428.2 457.8 496 362.9 496 252 496 113.3 383.5 8 244.8 8zM97.2 352.9c-1.3 1-1 3.3.7 5.2 1.6 1.6 3.9 2.3 5.2 1 1.3-1 1-3.3-.7-5.2-1.6-1.6-3.9-2.3-5.2-1zm-10.8-8.1c-.7 1.3.3 2.9 2.3 3.9 1.6 1 3.6.7 4.3-.7.7-1.3-.3-2.9-2.3-3.9-2-.6-3.6-.3-4.3.7zm32.4 35.6c-1.6 1.3-1 4.3 1.3 6.2 2.3 2.3 5.2 2.6 6.5 1 1.3-1.3.7-4.3-1.3-6.2-2.2-2.3-5.2-2.6-6.5-1zm-11.4-14.7c-1.6 1-1.6 3.6.0 5.9 1.6 2.3 4.3 3.3 5.6 2.3 1.6-1.3 1.6-3.9.0-6.2-1.4-2.3-4-3.3-5.6-2z"/></svg></span></span></a></div></div></div></div><div class=mb-5></div></header><section class="flex flex-col max-w-full mt-0 prose dark:prose-invert lg:flex-row"><div class="order-first lg:ms-auto px-0 lg:order-last lg:ps-8 lg:max-w-2xs"><div class="toc ps-5 print:hidden lg:sticky lg:top-[140px]"><details open id=TOCView class="toc-right mt-0 overflow-y-auto overscroll-contain bf-scrollbar rounded-lg -ms-5 ps-5 pe-2 hidden lg:block"><summary class="block py-1 text-lg font-semibold cursor-pointer bg-neutral-100 text-neutral-800 -ms-5 ps-5 dark:bg-neutral-700 dark:text-neutral-100 lg:hidden">목차</summary><div class="min-w-[220px] py-2 border-dotted border-s-1 -ms-5 ps-5 dark:border-neutral-600"><nav id=TableOfContents><ul><li><a href=#왜-v476인가>왜 v476인가</a><ul><li><a href=#java-22에서-java-24로>Java 22에서 Java 24로</a></li><li><a href=#s3-테이블-버킷-읽기-지원>S3 테이블 버킷 읽기 지원</a></li><li><a href=#버킷-파티션-푸시다운>버킷 파티션 푸시다운</a></li><li><a href=#iceberg-메타테이블-및-프로시저-개선>Iceberg 메타테이블 및 프로시저 개선</a></li><li><a href=#alluxio-파일-시스템-캐시>Alluxio 파일 시스템 캐시</a></li><li><a href=#apache-ranger-플러그인>Apache Ranger 플러그인</a></li></ul></li><li><a href=#배포-전략>배포 전략</a><ul><li><a href=#bluegreen-점진-배포>Blue/Green 점진 배포</a></li><li><a href=#v451-때부터-이어진-미해결-이슈>v451 때부터 이어진 미해결 이슈</a></li></ul></li><li><a href=#배포-개시와-첫-번째-롤백>배포 개시와 첫 번째 롤백</a><ul><li><a href=#materialized-view-refresh-stuck>Materialized View REFRESH stuck</a></li><li><a href=#parquet-파일-데이터-미인식>Parquet 파일 데이터 미인식</a></li></ul></li><li><a href=#바이너리-서치로-원인-버전-특정>바이너리 서치로 원인 버전 특정</a></li><li><a href=#원인-parquet-footer-최적화와-레거시-pyarrow>원인: Parquet Footer 최적화와 레거시 pyarrow</a></li><li><a href=#커뮤니티-이슈-제보와-하루-만의-픽스>커뮤니티 이슈 제보와 하루 만의 픽스</a></li><li><a href=#재배포-및-결과>재배포 및 결과</a></li><li><a href=#배운-것>배운 것</a></li></ul></nav></div></details><details class="toc-inside mt-0 overflow-hidden rounded-lg -ms-5 ps-5 lg:hidden"><summary class="py-1 text-lg font-semibold cursor-pointer bg-neutral-100 text-neutral-800 -ms-5 ps-5 dark:bg-neutral-700 dark:text-neutral-100 lg:hidden">목차</summary><div class="py-2 border-dotted border-neutral-300 border-s-1 -ms-5 ps-5 dark:border-neutral-600"><nav id=TableOfContents><ul><li><a href=#왜-v476인가>왜 v476인가</a><ul><li><a href=#java-22에서-java-24로>Java 22에서 Java 24로</a></li><li><a href=#s3-테이블-버킷-읽기-지원>S3 테이블 버킷 읽기 지원</a></li><li><a href=#버킷-파티션-푸시다운>버킷 파티션 푸시다운</a></li><li><a href=#iceberg-메타테이블-및-프로시저-개선>Iceberg 메타테이블 및 프로시저 개선</a></li><li><a href=#alluxio-파일-시스템-캐시>Alluxio 파일 시스템 캐시</a></li><li><a href=#apache-ranger-플러그인>Apache Ranger 플러그인</a></li></ul></li><li><a href=#배포-전략>배포 전략</a><ul><li><a href=#bluegreen-점진-배포>Blue/Green 점진 배포</a></li><li><a href=#v451-때부터-이어진-미해결-이슈>v451 때부터 이어진 미해결 이슈</a></li></ul></li><li><a href=#배포-개시와-첫-번째-롤백>배포 개시와 첫 번째 롤백</a><ul><li><a href=#materialized-view-refresh-stuck>Materialized View REFRESH stuck</a></li><li><a href=#parquet-파일-데이터-미인식>Parquet 파일 데이터 미인식</a></li></ul></li><li><a href=#바이너리-서치로-원인-버전-특정>바이너리 서치로 원인 버전 특정</a></li><li><a href=#원인-parquet-footer-최적화와-레거시-pyarrow>원인: Parquet Footer 최적화와 레거시 pyarrow</a></li><li><a href=#커뮤니티-이슈-제보와-하루-만의-픽스>커뮤니티 이슈 제보와 하루 만의 픽스</a></li><li><a href=#재배포-및-결과>재배포 및 결과</a></li><li><a href=#배운-것>배운 것</a></li></ul></nav></div></details></div></div><div class="min-w-0 min-h-0 max-w-fit"><div class="article-content max-w-prose mb-20"><p>Trino v451에서 v476으로 업그레이드를 진행했다. v476은 2025년 6월 5일에 릴리즈됐다. 25개 마이너 버전을 건너뛰는 업그레이드라서 변경사항이 방대했고, 실제로 배포 과정에서 두 건의 리그레션을 만났다. 그중 하나는 커뮤니티에도 보고된 적 없는 새로운 이슈였다.</p><p>이 글은 업그레이드에서 기대한 것, 실제로 겪은 것, 그리고 리그레션을 추적하고 해결한 과정을 정리한 기록이다.</p><hr><h2 class="relative group">왜 v476인가<div id=왜-v476인가 class=anchor></div><span class="absolute top-0 w-6 transition-opacity opacity-0 -start-6 not-prose group-hover:opacity-100 select-none"><a class="text-primary-300 dark:text-neutral-700 !no-underline" href=#%ec%99%9c-v476%ec%9d%b8%ea%b0%80 aria-label=앵커>#</a></span></h2><h3 class="relative group">Java 22에서 Java 24로<div id=java-22에서-java-24로 class=anchor></div><span class="absolute top-0 w-6 transition-opacity opacity-0 -start-6 not-prose group-hover:opacity-100 select-none"><a class="text-primary-300 dark:text-neutral-700 !no-underline" href=#java-22%ec%97%90%ec%84%9c-java-24%eb%a1%9c aria-label=앵커>#</a></span></h3><p>Trino는 최신 JVM에 적극적으로 올라타는 프로젝트다. v447에서 Java 22를 요구하기 시작했고, v464에서 Java 23, v476에서 Java 24로 올라갔다. 단순히 JVM 버전만 올라가는 게 아니다. Project Hummingbird라는 이름의 성능 개선 프로젝트가 Java의 Vector API를 활용해서 Parquet 파일 읽기에 벡터화 디코딩을 적용하고 있다. v448에서 Parquet 벡터화 디코딩이 도입됐고, 256비트 이상의 벡터 레지스터가 필요해서 Graviton 2(r6g, m6g)에서는 비활성화되지만 Graviton 3 이상에서는 자동 활성화된다.</p><p>Java 24의 최신 JIT 컴파일러 최적화와 메모리 관리 개선이 쿼리 처리 성능에 직접 영향을 준다.</p><h3 class="relative group">S3 테이블 버킷 읽기 지원<div id=s3-테이블-버킷-읽기-지원 class=anchor></div><span class="absolute top-0 w-6 transition-opacity opacity-0 -start-6 not-prose group-hover:opacity-100 select-none"><a class="text-primary-300 dark:text-neutral-700 !no-underline" href=#s3-%ed%85%8c%ec%9d%b4%eb%b8%94-%eb%b2%84%ed%82%b7-%ec%9d%bd%ea%b8%b0-%ec%a7%80%ec%9b%90 aria-label=앵커>#</a></span></h3><p>v471부터 Iceberg 커넥터에서 S3 테이블 버킷에 대한 읽기가 가능해졌다. 매니지드 Iceberg 테이블인 S3 테이블 버킷의 도입을 검토하고 있었기 때문에, Trino에서 읽기를 지원하는 건 필수 전제 조건이었다. Glue Data Catalog의 Iceberg REST 엔드포인트를 통해 연동하며, 기존 glue 타입이 아닌 rest 타입 카탈로그를 별도 구성해야 한다.</p><h3 class="relative group">버킷 파티션 푸시다운<div id=버킷-파티션-푸시다운 class=anchor></div><span class="absolute top-0 w-6 transition-opacity opacity-0 -start-6 not-prose group-hover:opacity-100 select-none"><a class="text-primary-300 dark:text-neutral-700 !no-underline" href=#%eb%b2%84%ed%82%b7-%ed%8c%8c%ed%8b%b0%ec%85%98-%ed%91%b8%ec%8b%9c%eb%8b%a4%ec%9a%b4 aria-label=앵커>#</a></span></h3><p>v468에 추가된 파티셔닝 푸시다운이 있다. 버킷 파티션이 걸린 테이블에 대해 쿼리 조건을 파티션 레벨로 푸시다운해서 스캔 범위를 줄이는 최적화다.</p><p>우리 환경에서 앱 로그와 웹 로그 테이블이 <code>screen_name</code>에 버킷 파티션을 사용하고 있다. 이 테이블들은 규모가 크기 때문에 버킷 파티션 푸시다운의 효과가 클 것으로 기대했다.</p><h3 class="relative group">Iceberg 메타테이블 및 프로시저 개선<div id=iceberg-메타테이블-및-프로시저-개선 class=anchor></div><span class="absolute top-0 w-6 transition-opacity opacity-0 -start-6 not-prose group-hover:opacity-100 select-none"><a class="text-primary-300 dark:text-neutral-700 !no-underline" href=#iceberg-%eb%a9%94%ed%83%80%ed%85%8c%ec%9d%b4%eb%b8%94-%eb%b0%8f-%ed%94%84%eb%a1%9c%ec%8b%9c%ec%a0%80-%ea%b0%9c%ec%84%a0 aria-label=앵커>#</a></span></h3><p>Iceberg 테이블 모니터링을 구축하면서 v451에 체리피킹했던 픽스들이 v476에 네이티브로 포함된다.</p><table><thead><tr><th>버전</th><th>개선 내용</th></tr></thead><tbody><tr><td>v455</td><td><code>$files</code> 메타테이블에서 delete file 인식 버그 수정</td></tr><tr><td>v465</td><td><code>$files</code> 메타테이블에 <code>partition</code> 필드 추가</td></tr><tr><td>v466</td><td>Glue Catalog 조회 병렬화로 성능 개선</td></tr><tr><td>v469</td><td><code>$all_entries</code> 메타테이블 추가 (Spark의 <code>all_entries</code>에 대응)</td></tr><tr><td>v470</td><td><code>$all_entries</code> 버그 수정, <code>optimize_manifests</code> 프로시저 추가</td></tr><tr><td>v475</td><td><code>system.iceberg_tables</code> 테이블 추가 (Iceberg 테이블만 리스팅)</td></tr></tbody></table><p>체리피킹 없이 이 기능들을 모두 쓸 수 있게 되는 것만으로도 업그레이드의 가치가 있었다.</p><h3 class="relative group">Alluxio 파일 시스템 캐시<div id=alluxio-파일-시스템-캐시 class=anchor></div><span class="absolute top-0 w-6 transition-opacity opacity-0 -start-6 not-prose group-hover:opacity-100 select-none"><a class="text-primary-300 dark:text-neutral-700 !no-underline" href=#alluxio-%ed%8c%8c%ec%9d%bc-%ec%8b%9c%ec%8a%a4%ed%85%9c-%ec%ba%90%ec%8b%9c aria-label=앵커>#</a></span></h3><p>기존에 사용하던 Alluxio 기반 로컬 디스크 캐시와 별개로, 외부 Alluxio 클러스터를 파일 시스템으로 연동하는 기능이 추가됐다. 카탈로그 간, 클러스터 간 캐시 공유가 가능해진다. 당장 적용할 계획은 아니지만 향후 캐시 아키텍처 개선에 활용할 수 있는 선택지다.</p><h3 class="relative group">Apache Ranger 플러그인<div id=apache-ranger-플러그인 class=anchor></div><span class="absolute top-0 w-6 transition-opacity opacity-0 -start-6 not-prose group-hover:opacity-100 select-none"><a class="text-primary-300 dark:text-neutral-700 !no-underline" href=#apache-ranger-%ed%94%8c%eb%9f%ac%ea%b7%b8%ec%9d%b8 aria-label=앵커>#</a></span></h3><p>Apache Ranger 인가 플러그인이 Trino 공식 레포에 통합됐다. 기존에 별도 레포로 관리되던 것이 메인 프로젝트에 포함돼서 버전 호환성 관리가 수월해진다.</p><hr><h2 class="relative group">배포 전략<div id=배포-전략 class=anchor></div><span class="absolute top-0 w-6 transition-opacity opacity-0 -start-6 not-prose group-hover:opacity-100 select-none"><a class="text-primary-300 dark:text-neutral-700 !no-underline" href=#%eb%b0%b0%ed%8f%ac-%ec%a0%84%eb%9e%b5 aria-label=앵커>#</a></span></h2><h3 class="relative group">Blue/Green 점진 배포<div id=bluegreen-점진-배포 class=anchor></div><span class="absolute top-0 w-6 transition-opacity opacity-0 -start-6 not-prose group-hover:opacity-100 select-none"><a class="text-primary-300 dark:text-neutral-700 !no-underline" href=#bluegreen-%ec%a0%90%ec%a7%84-%eb%b0%b0%ed%8f%ac aria-label=앵커>#</a></span></h3><p>OLAP과 BI 두 클러스터 그룹 각각에 Blue/Green 쌍이 있다. 업그레이드 계획은 이랬다.</p><ol><li>각 클러스터 그룹의 한쪽(Green)에 먼저 배포</li><li>1주일간 모니터링</li><li>이상 없으면 나머지(Blue)에 적용</li></ol><p>이슈 발생 시 Trino Gateway에서 해당 클러스터를 라우팅에서 즉시 빼고 롤백할 수 있다. 게이트웨이를 운영하고 있기 때문에 가능한 전략이다. 실제로 이 전략 덕분에 리그레션을 발견하고도 운영에 영향 없이 대응할 수 있었다.</p><p>OLAP-Green 클러스터부터 시작하기로 했다. BI보다 OLAP이 쿼리 패턴이 다양해서 리그레션을 더 빨리 발견할 수 있을 거라 판단했다.</p><h3 class="relative group">v451 때부터 이어진 미해결 이슈<div id=v451-때부터-이어진-미해결-이슈 class=anchor></div><span class="absolute top-0 w-6 transition-opacity opacity-0 -start-6 not-prose group-hover:opacity-100 select-none"><a class="text-primary-300 dark:text-neutral-700 !no-underline" href=#v451-%eb%95%8c%eb%b6%80%ed%84%b0-%ec%9d%b4%ec%96%b4%ec%a7%84-%eb%af%b8%ed%95%b4%ea%b2%b0-%ec%9d%b4%ec%8a%88 aria-label=앵커>#</a></span></h3><p>v451 배포 때 문제가 됐던 이슈 두 가지가 여전히 해결되지 않은 상태였다. 업그레이드 전에 대응 방안을 준비해뒀다.</p><p><strong>워커 stuck 이슈</strong></p><p>v451 배포 당시 부하 상황에서 일부 워커가 멈추는 현상이 있었다. 원인은 <code>ThreadPerDriverTaskExecutor</code>라는 실험적 기능이었다. 별다른 문서화도 없이 디폴트로 활성화된 채 추가됐었다. 커뮤니티에 이슈가 올라와 있지만 아직 해결되지 않았다.</p><p>이번에도 동일하게 <code>experimental.thread-per-driver-scheduler-enabled=false</code>로 비활성화해서 대응할 계획이었다.</p><p><strong>파티션 프루닝 리그레션</strong></p><p>필터 조건에 형변환이 포함된 경우 파티션 프루닝이 동작하지 않는 이슈다. 예를 들어 <code>WHERE date_column = CAST('2024-01-01' AS DATE)</code> 같은 쿼리에서 파티션이 제대로 걸러지지 않는다.</p><p>v451 때는 리그레션을 유발한 커밋 자체를 리버트해서 대응했다. 그 사이에 Trino 커뮤니티에서 이 리그레션을 우회하는 escape hatch 설정이 추가됐다. unsafe pushdown을 허용하는 설정인데, 이번에는 이 설정을 적용해서 리그레션이 발생하지 않는지 확인하는 방향으로 진행했다.</p><hr><h2 class="relative group">배포 개시와 첫 번째 롤백<div id=배포-개시와-첫-번째-롤백 class=anchor></div><span class="absolute top-0 w-6 transition-opacity opacity-0 -start-6 not-prose group-hover:opacity-100 select-none"><a class="text-primary-300 dark:text-neutral-700 !no-underline" href=#%eb%b0%b0%ed%8f%ac-%ea%b0%9c%ec%8b%9c%ec%99%80-%ec%b2%ab-%eb%b2%88%ec%a7%b8-%eb%a1%a4%eb%b0%b1 aria-label=앵커>#</a></span></h2><p>2025년 6월 23일, 코어타임 이후에 OLAP-Green 클러스터에 v476을 배포했다. 사용자들에게 Zeppelin 지원 채널을 통해 사전 공지를 했다.</p><h3 class="relative group">Materialized View REFRESH stuck<div id=materialized-view-refresh-stuck class=anchor></div><span class="absolute top-0 w-6 transition-opacity opacity-0 -start-6 not-prose group-hover:opacity-100 select-none"><a class="text-primary-300 dark:text-neutral-700 !no-underline" href=#materialized-view-refresh-stuck aria-label=앵커>#</a></span></h3><p>배포 직후 Airflow에서 Iceberg materialized view를 REFRESH하는 쿼리가 stuck 되고 있다는 제보가 들어왔다. 쿼리가 FINISHING 상태에서 끝나지 않고 멈춰 있었다.</p><p>Trino 레포를 확인하니 v475에 추가된 &ldquo;Cleanup previous snapshot files during materialized view refresh"라는 변경이 리그레션을 유발한 것으로 확인됐고, 바로 전날 리버트 PR이 머지된 상태였다. 타이밍이 절묘했다. 해당 리버트 커밋을 포크 레포에 반영해서 이슈를 해소했다.</p><h3 class="relative group">Parquet 파일 데이터 미인식<div id=parquet-파일-데이터-미인식 class=anchor></div><span class="absolute top-0 w-6 transition-opacity opacity-0 -start-6 not-prose group-hover:opacity-100 select-none"><a class="text-primary-300 dark:text-neutral-700 !no-underline" href=#parquet-%ed%8c%8c%ec%9d%bc-%eb%8d%b0%ec%9d%b4%ed%84%b0-%eb%af%b8%ec%9d%b8%ec%8b%9d aria-label=앵커>#</a></span></h3><p>더 심각한 이슈가 뒤따랐다. 사용자가 JupyterLab에서 쿼리 결과가 이상하다고 제보했다. 확인해보니 특정 Hive 테이블에서 데이터가 아예 조회되지 않았다.</p><p>문제의 패턴은 이랬다. 사용자가 Parquet 파일을 S3에 미리 적재해두고, 해당 경로를 바라보는 Hive 테이블을 나중에 생성하는 방식이었다. v451에서는 정상적으로 동작하던 패턴인데, v476에서는 테이블 생성 전에 올려둔 데이터 파일을 인식하지 못했다.</p><p>확인한 사항들:</p><ul><li>데이터 파일을 어디서 생성했든(Trino v451, v476, Spark) 동일하게 재현</li><li>Glue API 버전(v1, v2)과 무관</li><li>Spark의 <code>MSCK REPAIR TABLE</code>이나 Trino의 <code>system.sync_partition_metadata()</code> 호출로도 파티션 데이터 인식 불가</li></ul><p>이 이슈의 영향이 크다고 판단해서 <strong>OLAP-Green을 v451로 롤백</strong>했다. 원인을 파악한 뒤 재배포하기로 했다.</p><hr><h2 class="relative group">바이너리 서치로 원인 버전 특정<div id=바이너리-서치로-원인-버전-특정 class=anchor></div><span class="absolute top-0 w-6 transition-opacity opacity-0 -start-6 not-prose group-hover:opacity-100 select-none"><a class="text-primary-300 dark:text-neutral-700 !no-underline" href=#%eb%b0%94%ec%9d%b4%eb%84%88%eb%a6%ac-%ec%84%9c%ec%b9%98%eb%a1%9c-%ec%9b%90%ec%9d%b8-%eb%b2%84%ec%a0%84-%ed%8a%b9%ec%a0%95 aria-label=앵커>#</a></span></h2><p>커뮤니티에 이 이슈가 보고된 적이 없었다. 직접 찾아야 했다.</p><p>v451과 v476 사이에 메타스토어와 Hive 커넥터에 대한 코드 변경이 매우 많았다. 릴리즈 노트만 훑어봐서는 원인을 특정할 수 없었다. 바이너리 서치 방식으로 접근했다.</p><p>Zeppelin에 테스트 노트북을 만들어서 각 버전에서 이슈 재현 여부를 체계적으로 확인했다.</p><div class=highlight-wrapper><div class=highlight><pre tabindex=0 class=chroma><code class=language-text data-lang=text><span class=line><span class=cl>v451 — 정상
</span></span><span class=line><span class=cl>  ↓ (중간 지점 테스트)
</span></span><span class=line><span class=cl>v463 — 정상
</span></span><span class=line><span class=cl>  ↓
</span></span><span class=line><span class=cl>v469 — 재현!
</span></span><span class=line><span class=cl>  ↓ (범위 좁힘)
</span></span><span class=line><span class=cl>v466 — 정상
</span></span><span class=line><span class=cl>v467 — 정상
</span></span><span class=line><span class=cl>v468 — 정상
</span></span><span class=line><span class=cl>v469 — 재현!</span></span></code></pre></div></div><p><strong>v469에서 리그레션이 시작됨을 확인했다.</strong></p><p>다음은 v469의 Hive 커넥터 변경사항 중 어떤 커밋이 원인인지 찾는 작업이었다. v469 릴리즈 노트에서 Hive 커넥터 관련 변경사항을 확인하고, 해당 PR들을 하나씩 리버트하면서 이슈 재현 여부를 확인했다.</p><hr><h2 class="relative group">원인: Parquet Footer 최적화와 레거시 pyarrow<div id=원인-parquet-footer-최적화와-레거시-pyarrow class=anchor></div><span class="absolute top-0 w-6 transition-opacity opacity-0 -start-6 not-prose group-hover:opacity-100 select-none"><a class="text-primary-300 dark:text-neutral-700 !no-underline" href=#%ec%9b%90%ec%9d%b8-parquet-footer-%ec%b5%9c%ec%a0%81%ed%99%94%ec%99%80-%eb%a0%88%ea%b1%b0%ec%8b%9c-pyarrow aria-label=앵커>#</a></span></h2><p>원인은 v469에 머지된 Parquet footer 파싱 최적화 PR이었다. 이 PR은 Parquet 파일의 footer 메타데이터를 읽을 때 <code>RowGroup.getFile_offset</code> 값을 신뢰하고 그 값을 기반으로 읽기 범위를 최적화하는 로직을 추가했다.</p><p>문제는 모든 Parquet 파일의 row group 오프셋이 정확하지는 않다는 점이었다. 이슈가 된 파일은 pandas를 통해 pyarrow v5.0.0(parquet-cpp-arrow v5.0.0)으로 작성된 Parquet 파일이었다. 이 레거시 버전에서 기록한 row group 오프셋에 오류가 있었다.</p><p>추가 테스트로 확인한 사항:</p><ul><li>최신 pyarrow 버전으로 작성한 파일에서는 재현되지 않는다</li><li>row group의 크기가 일정 규모 이상이 되어야만 오프셋 오류가 발생한다. 작은 파일에서는 재현되지 않았다</li><li>v469 이전 버전에서는 <code>getFile_offset</code> 값을 사용하지 않았기 때문에 오프셋이 부정확해도 문제가 없었다</li></ul><hr><h2 class="relative group">커뮤니티 이슈 제보와 하루 만의 픽스<div id=커뮤니티-이슈-제보와-하루-만의-픽스 class=anchor></div><span class="absolute top-0 w-6 transition-opacity opacity-0 -start-6 not-prose group-hover:opacity-100 select-none"><a class="text-primary-300 dark:text-neutral-700 !no-underline" href=#%ec%bb%a4%eb%ae%a4%eb%8b%88%ed%8b%b0-%ec%9d%b4%ec%8a%88-%ec%a0%9c%eb%b3%b4%ec%99%80-%ed%95%98%eb%a3%a8-%eb%a7%8c%ec%9d%98-%ed%94%bd%ec%8a%a4 aria-label=앵커>#</a></span></h2><p>원인 PR과 재현 방법을 정리해서 Trino 커뮤니티 Slack에 공유했다. &ldquo;Incorrect results on parquet files written by parquet-cpp-arrow version 5.0.0"이라는 제목으로 이슈도 올렸다.</p><p>원래 최적화 PR의 작성자가 바로 근본 원인을 파악했다. 원인은 명확했다. 최적화 로직이 <code>RowGroup.getFile_offset</code> 값이 항상 정확하다고 가정하고 있었는데, 레거시 라이터가 부정확한 값을 기록하는 경우가 있었다.</p><p>픽스는 <code>RowGroup.getFile_offset</code> 대신 <code>ColumnChunk</code>의 first page offset을 사용하도록 변경하는 내용이었다. 방어 로직을 추가해서 오프셋 정보가 부정확한 파일에서도 정상 동작하도록 했다. 이슈 공유 후 하루 만에 픽스 PR이 올라왔고 v477 마일스톤에 머지됐다.</p><p>해당 픽스 커밋을 포크 레포에 체리피킹해서 스테이지에 배포하고 이슈 해소를 확인한 뒤, 운영에 반영했다.</p><hr><h2 class="relative group">재배포 및 결과<div id=재배포-및-결과 class=anchor></div><span class="absolute top-0 w-6 transition-opacity opacity-0 -start-6 not-prose group-hover:opacity-100 select-none"><a class="text-primary-300 dark:text-neutral-700 !no-underline" href=#%ec%9e%ac%eb%b0%b0%ed%8f%ac-%eb%b0%8f-%ea%b2%b0%ea%b3%bc aria-label=앵커>#</a></span></h2><p>두 이슈를 모두 해결한 뒤 배포를 재개했다.</p><table><thead><tr><th>날짜</th><th>클러스터</th><th>작업</th></tr></thead><tbody><tr><td>6월 23일</td><td>OLAP-Green</td><td>v476 최초 배포 → 이슈 발견, 롤백</td></tr><tr><td>6월 26일 오전</td><td>OLAP-Green</td><td>픽스 반영 후 재배포</td></tr><tr><td>6월 26일 오후</td><td>OLAP-Blue</td><td>v476 배포</td></tr></tbody></table><p>BI 클러스터 그룹은 금요일에 배포할 경우 주말 간 이슈 대응이 어렵다고 판단해서 별도 티켓으로 분리하고 다음 주 초에 진행했다.</p><p>배포 후 모니터링에서 클러스터 상태와 쿼리 실패 지표에 이상은 없었다. 사용자로부터 추가 이슈 제보도 없었다.</p><p>아직 충분한 기간은 아니지만, v476이 선배포된 클러스터의 쿼리 스루풋이 상대적으로 높은 양상이 확인됐다. 두 클러스터의 워커 수가 거의 동일한 상태에서 게이트웨이가 실행 쿼리 수 기반으로 라우팅한다는 점을 감안하면, v476 쪽이 더 많은 쿼리를 처리하면서도 부하가 낮았다는 뜻이다. 반대쪽에 헤비 쿼리가 몰린 영향일 수 있지만, 신규 버전의 전반적인 쿼리 성능이 개선됐다고 볼 여지가 있다.</p><hr><h2 class="relative group">배운 것<div id=배운-것 class=anchor></div><span class="absolute top-0 w-6 transition-opacity opacity-0 -start-6 not-prose group-hover:opacity-100 select-none"><a class="text-primary-300 dark:text-neutral-700 !no-underline" href=#%eb%b0%b0%ec%9a%b4-%ea%b2%83 aria-label=앵커>#</a></span></h2><p><strong>Blue/Green 배포가 아니었으면 운영 장애가 됐다.</strong> 한쪽 클러스터에 먼저 배포했기 때문에 리그레션을 발견해도 즉시 롤백하고 다른 쪽으로 트래픽을 돌릴 수 있었다. 25개 버전을 한 번에 올리는 메이저 업그레이드에서 Blue/Green은 선택이 아니라 필수다.</p><p><strong>바이너리 서치는 리그레션 디버깅의 정석이다.</strong> 25개 버전 사이의 변경사항을 하나씩 확인하는 건 비현실적이다. 중간 버전에서 재현 여부를 확인하면서 범위를 절반씩 좁히면 5~6번의 테스트로 원인 버전을 특정할 수 있다. 원인 버전을 특정한 뒤에는 해당 버전의 관련 커밋을 하나씩 리버트하면서 원인 PR을 찾았다.</p><p><strong>잘 정리된 이슈 리포트는 빠른 해결로 이어진다.</strong> 원인 PR, 재현 방법, 문제가 되는 파일의 특성(pyarrow 레거시 버전, row group 크기 조건)을 함께 공유하니까 원래 PR 작성자가 하루 만에 근본 원인을 파악하고 픽스를 작성해줬다. 이슈만 올리고 &ldquo;안 돼요"라고 쓰는 것과 원인 분석까지 해서 공유하는 건 응답 속도에서 큰 차이가 난다.</p><p><strong>실험적 기능이 디폴트 활성화되는 걸 경계하자.</strong> <code>ThreadPerDriverTaskExecutor</code>는 v451 때도 문제가 됐고 v476에서도 여전히 디폴트 활성화 상태였다. 커뮤니티 이슈가 열려 있는데도 해결이 안 되고 있다. 업그레이드 시 릴리즈 노트의 실험적 기능 관련 변경사항을 반드시 확인해야 한다.</p><p><strong>이전 업그레이드의 교훈을 체크리스트로 남겨두자.</strong> v451 때 발생한 두 이슈(워커 stuck, 파티션 프루닝 리그레션)에 대한 대응 방안을 미리 준비해뒀기 때문에 이번에는 빠르게 대응할 수 있었다. 업그레이드마다 겪은 이슈와 대응 방안을 기록해두면 다음 업그레이드가 수월해진다.</p><p><strong>참고 자료:</strong></p><ul><li><a href=https://trino.io/docs/current/release/release-475.html target=_blank rel=noreferrer>Trino v475 Release Notes</a></li><li><a href=https://trino.io/docs/current/release/release-476.html target=_blank rel=noreferrer>Trino v476 Release Notes</a></li><li><a href=https://github.com/trinodb/trino/pull/25815 target=_blank rel=noreferrer>Require Java 24 (v476)</a></li><li><a href=https://github.com/trinodb/trino/pull/23432 target=_blank rel=noreferrer>Add partitioning push down (v468)</a></li><li><a href=https://github.com/trinodb/trino/pull/22675 target=_blank rel=noreferrer>Add Apache Ranger authorizer plugin</a></li><li><a href=https://trino.io/docs/current/object-storage/alluxio.html target=_blank rel=noreferrer>Alluxio file system support</a></li><li><a href=https://github.com/trinodb/trino/pull/24815 target=_blank rel=noreferrer>Add read support for S3 Tables in Iceberg (v471)</a></li><li><a href=https://github.com/trinodb/trino/issues/21512 target=_blank rel=noreferrer>ThreadPerDriverTaskExecutor issue</a></li><li><a href=https://github.com/trinodb/trino/issues/22268 target=_blank rel=noreferrer>Partition pruning regression</a></li><li><a href=https://github.com/trinodb/trino/pull/22987 target=_blank rel=noreferrer>Escape hatch for unsafe pushdowns</a></li><li><a href=https://github.com/trinodb/trino/pull/26051 target=_blank rel=noreferrer>MV refresh revert PR</a></li><li><a href=https://github.com/trinodb/trino/pull/24618 target=_blank rel=noreferrer>Parquet footer optimization (v469, regression cause)</a></li><li><a href=https://github.com/trinodb/trino/issues/26058 target=_blank rel=noreferrer>Parquet file_offset issue report</a></li><li><a href=https://github.com/trinodb/trino/pull/26064 target=_blank rel=noreferrer>Parquet fix PR (v477)</a></li></ul></div><section class="flex flex-row flex-wrap justify-center pt-4 text-xl"><a target=_blank class="m-1 rounded bg-neutral-300 p-1.5 text-neutral-700 hover:bg-primary-500 hover:text-neutral dark:bg-neutral-700 dark:text-neutral-300 dark:hover:bg-primary-400 dark:hover:text-neutral-800" href="https://www.linkedin.com/shareArticle?mini=true&amp;url=https://nanta-data.dev/posts/trino-v476-upgrade/&amp;title=Trino%20v451%ec%97%90%ec%84%9c%20v476%ec%9c%bc%eb%a1%9c:%2025%ea%b0%9c%20%eb%b2%84%ec%a0%84%ec%9d%84%20%ea%b1%b4%eb%84%88%eb%9b%b4%20%ec%9a%b4%ec%98%81%20%ed%81%b4%eb%9f%ac%ec%8a%a4%ed%84%b0%20%ec%97%85%ea%b7%b8%eb%a0%88%ec%9d%b4%eb%93%9c" title="LinkedIn에서 공유" aria-label="LinkedIn에서 공유"><span class="relative block icon"><svg viewBox="0 0 448 512"><path fill="currentColor" d="M416 32H31.9C14.3 32 0 46.5.0 64.3v383.4C0 465.5 14.3 480 31.9 480H416c17.6.0 32-14.5 32-32.3V64.3c0-17.8-14.4-32.3-32-32.3zM135.4 416H69V202.2h66.5V416zm-33.2-243c-21.3.0-38.5-17.3-38.5-38.5S80.9 96 102.2 96c21.2.0 38.5 17.3 38.5 38.5.0 21.3-17.2 38.5-38.5 38.5zm282.1 243h-66.4V312c0-24.8-.5-56.7-34.5-56.7-34.6.0-39.9 27-39.9 54.9V416h-66.4V202.2h63.7v29.2h.9c8.9-16.8 30.6-34.5 62.9-34.5 67.2.0 79.7 44.3 79.7 101.9V416z"/></svg>
</span></a><a target=_blank class="m-1 rounded bg-neutral-300 p-1.5 text-neutral-700 hover:bg-primary-500 hover:text-neutral dark:bg-neutral-700 dark:text-neutral-300 dark:hover:bg-primary-400 dark:hover:text-neutral-800" href="https://reddit.com/submit/?url=https://nanta-data.dev/posts/trino-v476-upgrade/&amp;resubmit=true&amp;title=Trino%20v451%ec%97%90%ec%84%9c%20v476%ec%9c%bc%eb%a1%9c:%2025%ea%b0%9c%20%eb%b2%84%ec%a0%84%ec%9d%84%20%ea%b1%b4%eb%84%88%eb%9b%b4%20%ec%9a%b4%ec%98%81%20%ed%81%b4%eb%9f%ac%ec%8a%a4%ed%84%b0%20%ec%97%85%ea%b7%b8%eb%a0%88%ec%9d%b4%eb%93%9c" title="Reddit에 게시" aria-label="Reddit에 게시"><span class="relative block icon"><svg viewBox="0 0 512 512"><path fill="currentColor" d="M201.5 305.5c-13.8.0-24.9-11.1-24.9-24.6.0-13.8 11.1-24.9 24.9-24.9 13.6.0 24.6 11.1 24.6 24.9.0 13.6-11.1 24.6-24.6 24.6zM504 256c0 137-111 248-248 248S8 393 8 256 119 8 256 8s248 111 248 248zm-132.3-41.2c-9.4.0-17.7 3.9-23.8 10-22.4-15.5-52.6-25.5-86.1-26.6l17.4-78.3 55.4 12.5c0 13.6 11.1 24.6 24.6 24.6 13.8.0 24.9-11.3 24.9-24.9s-11.1-24.9-24.9-24.9c-9.7.0-18 5.8-22.1 13.8l-61.2-13.6c-3-.8-6.1 1.4-6.9 4.4l-19.1 86.4c-33.2 1.4-63.1 11.3-85.5 26.8-6.1-6.4-14.7-10.2-24.1-10.2-34.9.0-46.3 46.9-14.4 62.8-1.1 5-1.7 10.2-1.7 15.5.0 52.6 59.2 95.2 132 95.2 73.1.0 132.3-42.6 132.3-95.2.0-5.3-.6-10.8-1.9-15.8 31.3-16 19.8-62.5-14.9-62.5zM302.8 331c-18.2 18.2-76.1 17.9-93.6.0-2.2-2.2-6.1-2.2-8.3.0-2.5 2.5-2.5 6.4.0 8.6 22.8 22.8 87.3 22.8 110.2.0 2.5-2.2 2.5-6.1.0-8.6-2.2-2.2-6.1-2.2-8.3.0zm7.7-75c-13.6.0-24.6 11.1-24.6 24.9.0 13.6 11.1 24.6 24.6 24.6 13.8.0 24.9-11.1 24.9-24.6.0-13.8-11-24.9-24.9-24.9z"/></svg>
</span></a><a target=_blank class="m-1 rounded bg-neutral-300 p-1.5 text-neutral-700 hover:bg-primary-500 hover:text-neutral dark:bg-neutral-700 dark:text-neutral-300 dark:hover:bg-primary-400 dark:hover:text-neutral-800" href="mailto:?body=https://nanta-data.dev/posts/trino-v476-upgrade/&amp;subject=Trino%20v451%ec%97%90%ec%84%9c%20v476%ec%9c%bc%eb%a1%9c:%2025%ea%b0%9c%20%eb%b2%84%ec%a0%84%ec%9d%84%20%ea%b1%b4%eb%84%88%eb%9b%b4%20%ec%9a%b4%ec%98%81%20%ed%81%b4%eb%9f%ac%ec%8a%a4%ed%84%b0%20%ec%97%85%ea%b7%b8%eb%a0%88%ec%9d%b4%eb%93%9c" title="이메일로 전송" aria-label="이메일로 전송"><span class="relative block icon"><svg viewBox="0 0 512 512"><path fill="currentColor" d="M207.8 20.73c-93.45 18.32-168.7 93.66-187 187.1-27.64 140.9 68.65 266.2 199.1 285.1 19.01 2.888 36.17-12.26 36.17-31.49l1e-4-.6631c0-15.74-11.44-28.88-26.84-31.24-84.35-12.98-149.2-86.13-149.2-174.2.0-102.9 88.61-185.5 193.4-175.4 91.54 8.869 158.6 91.25 158.6 183.2v16.16c0 22.09-17.94 40.05-40 40.05s-40.01-17.96-40.01-40.05v-120.1c0-8.847-7.161-16.02-16.01-16.02l-31.98.0036c-7.299.0-13.2 4.992-15.12 11.68-24.85-12.15-54.24-16.38-86.06-5.106-38.75 13.73-68.12 48.91-73.72 89.64-9.483 69.01 43.81 128 110.9 128 26.44.0 50.43-9.544 69.59-24.88 24 31.3 65.23 48.69 109.4 37.49C465.2 369.3 496 324.1 495.1 277.2V256.3c0-149.2-133.9-265.632-287.3-235.57zM239.1 304.3c-26.47.0-48-21.56-48-48.05s21.53-48.05 48-48.05 48 21.56 48 48.05-20.6 48.05-48 48.05z"/></svg></span></a></section></div></section><footer class="pt-8 max-w-prose print:hidden"><div class=pt-8><hr class="border-dotted border-neutral-300 dark:border-neutral-600"><div class="flex justify-between pt-3"><span class="flex flex-col"><a class="flex text-neutral-700 hover:text-primary-600 dark:text-neutral dark:hover:text-primary-400" href=/posts/alb-log-collection-system/><span class=leading-6><span class="inline-block rtl:rotate-180">&larr;</span>&ensp;ALB 로그를 Iceberg 테이블로 만들기까지
</span></a><span class="ms-6 mt-1 text-xs text-neutral-500 dark:text-neutral-400"><time datetime=2026-02-25T00:00:00+00:00>2026년 2월 25일</time>
</span></span><span class="flex flex-col items-end"><a class="flex text-right text-neutral-700 hover:text-primary-600 dark:text-neutral dark:hover:text-primary-400" href=/posts/trino-gateway-zero-downtime/><span class=leading-6>Trino Gateway 도입기: 제로 다운타임 배포와 멀티 클러스터 라우팅&ensp;<span class="inline-block rtl:rotate-180">&rarr;</span>
</span></a><span class="me-6 mt-1 text-xs text-neutral-500 dark:text-neutral-400"><time datetime=2026-02-27T00:00:00+00:00>2026년 2월 27일</time></span></span></div></div></footer></article><div id=scroll-to-top class="fixed bottom-6 end-6 z-50 transform translate-y-4 opacity-0 duration-200"><a href=#the-top class="pointer-events-auto flex h-12 w-12 items-center justify-center rounded-full bg-neutral/50 text-xl text-neutral-700 hover:text-primary-600 dark:bg-neutral-800/50 dark:text-neutral dark:hover:text-primary-400" aria-label="맨 위로 스크롤" title="맨 위로 스크롤">&uarr;</a></div></main><footer id=site-footer class="py-10 print:hidden"><div class="flex items-center justify-between text-sm text-neutral-500 dark:text-neutral-400"><nav><ul class="flex list-none flex-row"><li class="me-4 last:me-0"><a class="decoration-primary-500 hover:underline hover:decoration-2 hover:underline-offset-2 flex items-center" href=/privacy-policy/ title=개인정보처리방침>개인정보처리방침</a></li></ul></nav><p>&copy;
2026
nanta</p></div><script>mediumZoom(document.querySelectorAll("img:not(.nozoom)"),{margin:24,background:"rgba(0,0,0,0.5)",scrollOffset:0})</script></footer><div id=search-wrapper class="invisible fixed inset-0 flex h-screen w-screen cursor-default flex-col bg-neutral-500/50 p-4 backdrop-blur-sm dark:bg-neutral-900/50 sm:p-6 md:p-[10vh] lg:p-[12vh] z-500" data-url=https://nanta-data.dev/><div id=search-modal class="flex flex-col w-full max-w-3xl min-h-0 mx-auto border rounded-md shadow-lg top-20 border-neutral-200 bg-neutral dark:border-neutral-700 dark:bg-neutral-800"><header class="relative z-10 flex items-center justify-between flex-none px-2"><form class="flex items-center flex-auto min-w-0"><div class="flex items-center justify-center w-8 h-8 text-neutral-400"><span class="relative block icon"><svg aria-hidden="true" focusable="false" data-prefix="fas" data-icon="search" class="svg-inline--fa fa-search fa-w-16" role="img" viewBox="0 0 512 512"><path fill="currentColor" d="M505 442.7 405.3 343c-4.5-4.5-10.6-7-17-7H372c27.6-35.3 44-79.7 44-128C416 93.1 322.9.0 208 0S0 93.1.0 208s93.1 208 208 208c48.3.0 92.7-16.4 128-44v16.3c0 6.4 2.5 12.5 7 17l99.7 99.7c9.4 9.4 24.6 9.4 33.9.0l28.3-28.3c9.4-9.4 9.4-24.6.1-34zM208 336c-70.7.0-128-57.2-128-128 0-70.7 57.2-128 128-128 70.7.0 128 57.2 128 128 0 70.7-57.2 128-128 128z"/></svg></span></div><input type=search id=search-query class="flex flex-auto h-12 mx-1 bg-transparent appearance-none focus:outline-dotted focus:outline-2 focus:outline-transparent" placeholder=검색 tabindex=0></form><button id=close-search-button class="flex items-center justify-center w-8 h-8 text-neutral-700 hover:text-primary-600 dark:text-neutral dark:hover:text-primary-400" title="닫기 (Esc)">
<span class="relative block icon"><svg viewBox="0 0 320 512"><path fill="currentColor" d="M310.6 361.4c12.5 12.5 12.5 32.75.0 45.25C304.4 412.9 296.2 416 288 416s-16.38-3.125-22.62-9.375L160 301.3 54.63 406.6C48.38 412.9 40.19 416 32 416S15.63 412.9 9.375 406.6c-12.5-12.5-12.5-32.75.0-45.25l105.4-105.4L9.375 150.6c-12.5-12.5-12.5-32.75.0-45.25s32.75-12.5 45.25.0L160 210.8l105.4-105.4c12.5-12.5 32.75-12.5 45.25.0s12.5 32.75.0 45.25l-105.4 105.4L310.6 361.4z"/></svg></span></button></header><section class="flex-auto px-2 overflow-auto"><ul id=search-results></ul></section></div></div></div></body></html>